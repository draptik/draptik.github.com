
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>draptik</title>
  <meta name="author" content="Patrick Drechsler">

  
  <meta name="description" content="This post describes how I created my first customized docker image(s). I have been watching the docker space for a while and finally found a private &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://draptik.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="draptik" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-65991503-1']);
	_gaq.push(['_setDomainName','github.io']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">draptik</a></h1>
  
    <h2>mostly tech stuff</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:draptik.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/04/04/docker-and-octopress/">Docker and Octopress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-04-04T18:41:51+00:00" pubdate data-updated="true">Apr 4<span>th</span>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This post describes how I created my first customized docker image(s).</p>

<p>I have been watching the <a href="https://www.docker.com/">docker</a> space for a while and finally found a private use-case: This blog uses <a href="http://octopress.org/">Octopress</a>, which is a ruby-based convenience-wrapper around Jekyll.
<a href="https://jekyllrb.com/">Jekyll</a> is a static web-site generator provided by <a href="https://github.com/jekyll/jekyll">GitHub</a>.
Octopress requires some old libs: Ruby 1.9.3, Python 2.7, and nodejs.</p>

<p>So, to use Octopress on any machine, I have to either:</p>

<ul>
<li>configure the machine to use specific versions of Ruby, Python and NodeJs. Works.

<ul>
<li>Drawback: Other projects using different versions of Ruby, Python, NodeJs won&rsquo;t work out of the box.</li>
</ul>
</li>
<li>use version managers for Ruby, Python and NodeJs (f.ex. <a href="https://rvm.io/"><code>rvm</code></a>, <a href="http://fgimian.github.io/blog/2012/12/08/setting-up-virtual-development-environments-for-python/"><code>virtualenv</code></a>, <a href="https://github.com/creationix/nvm"><code>nvm</code></a>). Works.

<ul>
<li>Drawback: Tedious setup which differs between OSes.</li>
</ul>
</li>
<li>use a virtual machine. Works.

<ul>
<li>Drawback: Not easily portable due to size of virtual machine image.</li>
</ul>
</li>
<li>Or, I could use docker.</li>
</ul>


<p>I decided to give docker a spin.</p>

<p><strong>My primary goal was to be able to blog from any (linux) machine running docker.</strong></p>

<p>From a birds-eye view my goal is to:</p>

<ul>
<li>install a docker image on any machine</li>
<li>and run a docker container with my blog mounted as shared folder (so I can edit the content on the host system, but compilation, preview and publishing is accomplished from within the docker container)</li>
</ul>


<p><strong>My secondary goal was to get my hands dirty with docker :&ndash;)</strong></p>

<p>Obviously docker also has potential usage for other development setups (i.e. testing application code in local docker container before pushing to CI to reduce roundtrip time).</p>

<h2>Overview</h2>

<p>I created 3 docker images, which build upon each other:</p>

<ul>
<li>Docker 00: base image including Ruby, Python and NodeJs</li>
<li>Docker 01: image with docker <code>ENTRYPOINT</code></li>
<li>Docker 02: image optimized for octopress usage</li>
</ul>


<p>Here is the folder structure:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>├── 00_ruby_base
</span><span class='line'>│   ├── build-image.sh
</span><span class='line'>│   └── Dockerfile
</span><span class='line'>├── 01_user
</span><span class='line'>│   ├── build-image.sh
</span><span class='line'>│   ├── Dockerfile
</span><span class='line'>│   └── entrypoint.sh
</span><span class='line'>├── 02_octopress
</span><span class='line'>│   ├── build-image.sh
</span><span class='line'>│   ├── Dockerfile
</span><span class='line'>│   ├── post-install.sh
</span><span class='line'>│   └── run-container.sh
</span><span class='line'>└── share
</span><span class='line'>    └── octopress
</span></code></pre></td></tr></table></div></figure>


<p>Each image (<code>00*</code>, <code>01*</code>, <code>02*</code>) contains a <code>Dockerfile</code> and a <code>build-image.sh</code> file. Only the last image (<code>02*</code>) contains a <code>run-container.sh</code> file.</p>

<ul>
<li><code>Dockerfile</code>s contain the instructions for building a docker image.</li>
<li><code>build-image.sh</code> files invoke the <code>Dockerfile</code>.</li>
</ul>


<h2>Docker 00: base image</h2>

<p>Since I couldn&rsquo;t find a simple Ruby image of 1.9.3 at docker hub I decided to create my own.</p>

<p>Knowing my use-case (Octopress), I also installed Python2.7 and NodeJs for my <a href="https://hub.docker.com/r/draptik/ruby1.9.3-python2.7-nodejs/">base docker image</a>. This image is the only one that takes quite some time to build.</p>

<h3>Dockerfile</h3>

<figure class='code'><figcaption><span>Dockerfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>FROM debian:jessie
</span><span class='line'>
</span><span class='line'><span class="c"># Get the dependencies for Octopress page generation</span>
</span><span class='line'><span class="c">##</span>
</span><span class='line'><span class="c">## Notes:</span>
</span><span class='line'><span class="c">##</span>
</span><span class='line'><span class="c">## - Python 2.7 is required for using pygments gem.</span>
</span><span class='line'><span class="c">## - NodeJs is required for execjs Gem</span>
</span><span class='line'><span class="c">##</span>
</span><span class='line'>RUN apt-get update <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    apt-get --no-install-recommends -y install <span class="se">\</span>
</span><span class='line'>    autoconf <span class="se">\</span>
</span><span class='line'>    bison <span class="se">\</span>
</span><span class='line'>    build-essential <span class="se">\</span>
</span><span class='line'>    libssl-dev <span class="se">\</span>
</span><span class='line'>    libyaml-dev <span class="se">\</span>
</span><span class='line'>    locales <span class="se">\</span>
</span><span class='line'>    libreadline6-dev <span class="se">\</span>
</span><span class='line'>    zlib1g-dev <span class="se">\</span>
</span><span class='line'>    libncurses5-dev <span class="se">\</span>
</span><span class='line'>    libffi-dev <span class="se">\</span>
</span><span class='line'>    libgdbm3 <span class="se">\</span>
</span><span class='line'>    libgdbm-dev <span class="se">\</span>
</span><span class='line'>    nodejs <span class="se">\</span>
</span><span class='line'>    python2.7 <span class="se">\</span>
</span><span class='line'>    wget <span class="se">\</span>
</span><span class='line'>    ca-certificates <span class="se">\</span>
</span><span class='line'>    curl <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    apt-get clean <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
</span><span class='line'>
</span><span class='line'><span class="c"># Set LOCALE to UTF8</span>
</span><span class='line'>RUN <span class="nb">echo</span> <span class="s2">&quot;en_US.UTF-8 UTF-8&quot;</span> &gt; /etc/locale.gen <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    locale-gen en_US.UTF-8 <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    dpkg-reconfigure --frontend<span class="o">=</span>noninteractive locales <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    /usr/sbin/update-locale <span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8
</span><span class='line'>ENV LANG en_US.UTF-8
</span><span class='line'>ENV LC_ALL en_US.UTF-8
</span><span class='line'>
</span><span class='line'><span class="c"># Install ruby (adopted from https://hub.docker.com/r/liaisonintl/ruby-1.9.3/~/dockerfile/)</span>
</span><span class='line'>ENV <span class="nv">RUBY_MAJOR</span><span class="o">=</span>1.9 <span class="se">\</span>
</span><span class='line'>    <span class="nv">RUBY_VERSION</span><span class="o">=</span>1.9.3-p551 <span class="se">\</span>
</span><span class='line'>    <span class="nv">RUBY_DOWNLOAD_SHA256</span><span class="o">=</span>bb5be55cd1f49c95bb05b6f587701376b53d310eb1bb7c76fbd445a1c75b51e8 <span class="se">\</span>
</span><span class='line'>    <span class="nv">RUBYGEMS_VERSION</span><span class="o">=</span>2.6.6 <span class="se">\</span>
</span><span class='line'>    <span class="nv">PATH</span><span class="o">=</span>/usr/local/bundle/bin:<span class="nv">$PATH</span>
</span><span class='line'>RUN <span class="nb">set</span> -ex <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    curl -SL -o ruby.tar.gz <span class="s2">&quot;http://cache.ruby-lang.org/pub/ruby/$RUBY_MAJOR/ruby-$RUBY_VERSION.tar.gz&quot;</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="s2">&quot;$RUBY_DOWNLOAD_SHA256 ruby.tar.gz&quot;</span> | sha256sum -c - <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    mkdir -p /usr/src/ruby <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    tar -xzf ruby.tar.gz -C /usr/src/ruby --strip-components<span class="o">=</span>1 <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    rm -f ruby.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    <span class="nb">cd</span> /usr/src/ruby <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    autoconf <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    ./configure --disable-install-doc --sysconfdir<span class="o">=</span>/etc/ <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    make <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    make install <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    gem update --system <span class="nv">$RUBYGEMS_VERSION</span> <span class="o">&amp;&amp;</span> <span class="se">\</span>
</span><span class='line'>    rm -rf /usr/src/ruby
</span><span class='line'>
</span><span class='line'><span class="c"># Create soft link for python</span>
</span><span class='line'>RUN ln -s /usr/bin/python2.7 /usr/bin/python
</span></code></pre></td></tr></table></div></figure>


<p>Here is a short description of what happens in this <code>Dockerfile</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>RUN apt-get ...
</span></code></pre></td></tr></table></div></figure>


<p>&hellip;retrieves required packages from the debian package repository.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>RUN <span class="nb">echo</span> <span class="s2">&quot;en_US.UTF-8 UTF-8&quot;</span> &gt; /etc/locale.gen ...
</span></code></pre></td></tr></table></div></figure>


<p>&hellip;ensures the default system language uses UTF8 (required by some packages).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>RUN <span class="nb">set</span> -ex <span class="o">&amp;&amp;</span> curl... <span class="o">&amp;&amp;</span> make ...
</span></code></pre></td></tr></table></div></figure>


<p>&hellip;downloads, compiles and installs Ruby from scratch (this step takes some time!).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>RUN ln -s /usr/bin/python2.7 /usr/bin/python
</span></code></pre></td></tr></table></div></figure>


<p>&hellip;creates a soft link to Python2.7.</p>

<h3>Docker build</h3>

<p>To execute the previous <code>Dockerfile</code>, run <code>./build-image.sh</code>.</p>

<figure class='code'><figcaption><span>build-image.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>docker build -t draptik/ruby1.9.3-python2.7-nodejs:0.1 .
</span></code></pre></td></tr></table></div></figure>


<p>Make the file executable (<code>chmod 744 build-image.sh</code>).</p>

<p>Ensure to replace <code>draptik</code> with some other string (f.ex. your name, initials or company) to build your own image. F.ex. <code>docker build -t homersimpson/ruby1.9.3-python2.7-nodejs:0.1 .</code></p>

<p><strong>Since this image is going to be the base image for the next step, ensure to always use the same name (f.ex. <code>homersimpson</code>)</strong>.</p>

<p>You can verify that the docker build step worked as expected by listing all docker images using <code>docker images</code>. The output should be similar to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>docker images
</span><span class='line'>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span><span class='line'>homersimpson/ruby1.9.3-python2.7-nodejs:0.1   0.1                 641ca1a59e87        8 days ago          486 MB
</span><span class='line'>debian              jessie              e5599115b6a6        4 weeks ago         123 MB
</span></code></pre></td></tr></table></div></figure>


<h2>Docker 01: user</h2>

<p>Here is where things start getting difficult. Sharing a folder from the host system with docker. And keeking permissions/users in sync&hellip;</p>

<h3>Some things to know about sharing a volume in docker</h3>

<p>Sharing data between host and docker container is normally accomplished by <code>docker run -v host-location/folder:container-location/folder</code>.</p>

<p>Be aware, though:</p>

<ul>
<li>The volume will be owned by the container</li>
<li>The container&rsquo;s default user is root (UID/GID 1)!</li>
<li>The container will change the UID/GID on the host system!</li>
</ul>


<h3>My workaround</h3>

<p>I found this <a href="https://denibertovic.com/posts/handling-permissions-with-docker-volumes/">post by Deni Bertovic</a>. In short, the post proposes to use docker&rsquo;s <code>ENTRYPOINT</code> to pipe all <code>RUN</code> commands through the <code>ENTRYPOINT</code>. Which in turn is a bash script (<code>entrypoint.sh</code>, see below), creating a new user, and executing all docker commands as user. This is where I start walking on very thin ice&hellip; Nevertheless, I created another <a href="https://hub.docker.com/r/draptik/ruby1.9.3-python2.7-nodejs-user/">docker image</a> based on the base image from the previous step.</p>

<h3>Dockerfile</h3>

<p>Make sure to replace <code>draptik</code> in the <code>FROM</code> string&hellip;</p>

<figure class='code'><figcaption><span>Dockerfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>FROM draptik/ruby1.9.3-python2.7-nodejs:0.1
</span><span class='line'>
</span><span class='line'><span class="c"># For details see https://denibertovic.com/posts/handling-permissions-with-docker-volumes/</span>
</span><span class='line'>
</span><span class='line'>RUN apt-get update <span class="o">&amp;&amp;</span> apt-get -y --no-install-recommends install <span class="se">\</span>
</span><span class='line'>    ca-certificates <span class="se">\</span>
</span><span class='line'>    curl
</span><span class='line'>
</span><span class='line'>RUN gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4
</span><span class='line'>RUN curl -o /usr/local/bin/gosu -SL <span class="s2">&quot;https://github.com/tianon/gosu/releases/download/1.10/gosu-$(dpkg --print-architecture)&quot;</span> <span class="se">\</span>
</span><span class='line'>    <span class="o">&amp;&amp;</span> curl -o /usr/local/bin/gosu.asc -SL <span class="s2">&quot;https://github.com/tianon/gosu/releases/download/1.10/gosu-$(dpkg --print-architecture).asc&quot;</span> <span class="se">\</span>
</span><span class='line'>    <span class="o">&amp;&amp;</span> gpg --verify /usr/local/bin/gosu.asc <span class="se">\</span>
</span><span class='line'>    <span class="o">&amp;&amp;</span> rm /usr/local/bin/gosu.asc <span class="se">\</span>
</span><span class='line'>    <span class="o">&amp;&amp;</span> chmod +x /usr/local/bin/gosu
</span><span class='line'>
</span><span class='line'>COPY entrypoint.sh /usr/local/bin/entrypoint.sh
</span><span class='line'>
</span><span class='line'>ENTRYPOINT <span class="o">[</span><span class="s2">&quot;/usr/local/bin/entrypoint.sh&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>For further details about the above <code>Dockerfile</code> refer to aforementioned <a href="https://denibertovic.com/posts/handling-permissions-with-docker-volumes/">post by Deni</a>.</p>

<p>The <code>entrypoint.sh</code> file should be located beside the <code>Dockerfile</code>:</p>

<figure class='code'><figcaption><span>entrypoint.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Add local user</span>
</span><span class='line'><span class="c"># Either use the LOCAL_USER_ID if passed in at runtime or</span>
</span><span class='line'><span class="c"># fallback</span>
</span><span class='line'>
</span><span class='line'><span class="nv">USER_ID</span><span class="o">=</span><span class="k">${</span><span class="nv">LOCAL_USER_ID</span><span class="k">:-</span><span class="nv">9001</span><span class="k">}</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;Starting with UID : $USER_ID&quot;</span>
</span><span class='line'>useradd --shell /bin/bash -u <span class="nv">$USER_ID</span> -o -c <span class="s2">&quot;&quot;</span> -m user
</span><span class='line'><span class="nb">export </span><span class="nv">HOME</span><span class="o">=</span>/home/user
</span><span class='line'>
</span><span class='line'><span class="nb">exec</span> /usr/local/bin/gosu user <span class="s2">&quot;$@&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Docker build</h3>

<p>&hellip;and the corresponding <code>docker build</code> command (again, wrapped in a file):</p>

<figure class='code'><figcaption><span>build-image.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>docker build -t draptik/ruby1.9.3-python2.7-nodejs-user:0.1 .
</span></code></pre></td></tr></table></div></figure>


<p>&hellip;again, make sure to replace <code>draptik</code>&hellip;</p>

<h2>Docker 02: octopress</h2>

<p>Because, in addition to mounting the content of my blog, I also mount the blog-engine itself (using <code>docker run -v &lt;orig-location&gt;:&lt;container-location&gt;</code>)
I also have to execute an initial script within the mounted folder to setup the blog-engine. To prepare the environment for this script I create a customized <code>~/.gemrc</code> and <code>~/.bashrc</code> file in the <code>Dockerfile</code>.
For this purpose I mount another file from the <code>docker run</code> script (<code>post-install.sh</code>), which must be executed from within the container.</p>

<h3>Dockerfile</h3>

<p>(Make sure to replace <code>draptik</code> in the <code>FROM</code> string&hellip;)</p>

<figure class='code'><figcaption><span>Dockerfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>FROM draptik/ruby1.9.3-python2.7-nodejs-user:0.1
</span><span class='line'>
</span><span class='line'><span class="c"># I am not really sure why this is needed, because we have an ENTRYPOINT in the parent image.</span>
</span><span class='line'>RUN useradd -ms /bin/bash user
</span><span class='line'>
</span><span class='line'><span class="c"># Setup ruby/bundler to work with non-admin user</span>
</span><span class='line'>RUN <span class="nb">echo</span> <span class="s2">&quot;gem: --user-install&quot;</span> &gt; /home/user/.gemrc <span class="o">&amp;&amp;</span> chown user:user /home/user/.gemrc
</span><span class='line'>RUN <span class="nb">echo</span> <span class="s2">&quot;PATH=\&quot;/home/user/.gem/ruby/1.9.1/bin:$PATH\&quot;&quot;</span> &gt;&gt; /home/user/.bashrc <span class="o">&amp;&amp;</span> chown user:user /home/user/.bashrc
</span><span class='line'>
</span><span class='line'>WORKDIR /octopress
</span></code></pre></td></tr></table></div></figure>


<p>You might be wondering why I am explicitly creating a new user (<code>RUN useradd -ms /bin/bash user</code>). Valid question. In the next 2 lines I write some config values to files which are located in the <code>/home/user/</code> folder. I was not able to do this without first explicitly creating the user. Probably not best practice, but it works. I would be very grateful for feedback on this issue.</p>

<h3>Docker build</h3>

<p>(&hellip;again, make sure to replace <code>draptik</code>&hellip;)</p>

<figure class='code'><figcaption><span>build-image.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>docker build -t draptik/octopress:0.1 .
</span></code></pre></td></tr></table></div></figure>


<h3>Starting the final image as docker container</h3>

<p>The following script starts the docker container:</p>

<figure class='code'><figcaption><span>run-container.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>docker run <span class="se">\</span>
</span><span class='line'>    --rm <span class="se">\</span>
</span><span class='line'>    -it <span class="se">\</span>
</span><span class='line'>    -e <span class="nv">LOCAL_USER_ID</span><span class="o">=</span><span class="sb">`</span>id -u <span class="nv">$USER</span><span class="sb">`</span> <span class="se">\</span>
</span><span class='line'>    -p 4001:4001 <span class="se">\</span>
</span><span class='line'>    -v <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>/../share/octopress:/octopress <span class="se">\</span>
</span><span class='line'>    -v <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>/post-install.sh:/home/user/post-install.sh <span class="se">\</span>
</span><span class='line'>    draptik/octopress:0.1 <span class="se">\</span>
</span><span class='line'>    /bin/bash
</span></code></pre></td></tr></table></div></figure>


<p>Some notes about the <code>docker run</code> options:</p>

<ul>
<li><code>--rm</code> ensures that the docker container is removed once exited</li>
<li><code>-it</code> runs an interactive terminal as soon as the container starts</li>
<li><code>-e LOCAL_USER...</code> sets the host user&rsquo;s ID within the docker container</li>
<li><code>-p ...</code> maps the port numbers</li>
<li><code>-v ${PWD}/../share/octopress:/octopress</code> mounts the blog volume</li>
<li><code>-v ${PWD}/post-install.sh:/home/user/post-install.sh</code> mounts the post install script</li>
</ul>


<p>Mounting volumes in docker using <code>docker-machine</code> or <code>Docker for Windows</code> on windows requires some extra path-tweaking. I intend to add these tweaks in the future&hellip;</p>

<h4>post-install</h4>

<p>Yet another step&hellip; After docker mounted the external volumes from the host, they have to be configured (including our blogging engine).</p>

<p>That is the reason for the <code>post-install.sh</code> script. It must be run from within the container!</p>

<p>IMPORTANT: Ensure to replace the git user name/email in <code>post-install.sh</code>. Otherwhise you will not be able to deploy!</p>

<figure class='code'><figcaption><span>post-install.sh</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c">#</span>
</span><span class='line'><span class="c"># This script must be executed in ~ folder (not in /octopress)!</span>
</span><span class='line'>gem install --no-ri --no-rdoc <span class="se">\</span>
</span><span class='line'>  bundler <span class="se">\</span>
</span><span class='line'>  execjs
</span><span class='line'>
</span><span class='line'><span class="nb">cd</span> /octopress
</span><span class='line'><span class="c"># Important: use `--path...`!</span>
</span><span class='line'>bundle install --path <span class="nv">$HOME</span>/.gem
</span><span class='line'>
</span><span class='line'>git config --global user.name <span class="s2">&quot;FirstName LastName&quot;</span>
</span><span class='line'>git config --global user.email <span class="s2">&quot;your@mail.com&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Final usage for Octopress users</h2>

<p>All images are published to <a href="https://hub.docker.com/u/draptik/">docker hub</a>.</p>

<p>Just run <code>docker pull draptik/octopress:0.1</code>.</p>

<ul>
<li>Create a folder for your blog: <code>mkdir blog &amp;&amp; cd blog</code></li>
<li>Create a folder for the blog content: <code>mkdir share &amp;&amp; cd share</code></li>
</ul>


<p>Initially clone octopress in <code>share</code> folder:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git clone -b <span class="nb">source</span> &lt;octopress-git-repo&gt; octopress
</span><span class='line'><span class="nb">cd </span>octopress
</span><span class='line'>git clone -b master &lt;octopress-git-repo&gt; _deploy
</span></code></pre></td></tr></table></div></figure>


<p>Then, run the <code>run-container.sh</code> script.</p>

<p>From within the newly created docker container, follow the steps from the post-install section above.</p>

<p>You should now be able to use Octopress from within the docker container (i.e. <code>rake new_post["test"]</code>, <code>rake generate</code>, <code>rake preview</code>, <code>rake deploy</code>, etc.) while being able to edit your posts on the host machine.</p>

<h2>Summary</h2>

<p>It helps if you have a linux background, since all docker images are linux based. Setting up a customized docker image can be a bit tedious (especially configuring user privileges and mounting host folders), but once the image works you have an automated and reproducable environment. I think this makes it worth the effort.</p>

<p>Obviously I am just starting with docker, so take my example above with a grain of salt. But maybe the example gives you a starting point for your own docker experiments.</p>

<p>As always: Thankful for feedback!</p>

<h2>Sources at Github</h2>

<p>You can find the complete source code at Github here: <a href="https://github.com/draptik/octopress-docker">https://github.com/draptik/octopress-docker</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/03/30/learning/">Learning by Meeting People</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-03-30T17:01:33+00:00" pubdate data-updated="true">Mar 30<span>th</span>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In my day job I&rsquo;m a full-stack .NET developer. In the past I mainly learned new concepts in programming by reading books, blog posts, watching video tutorials (i.e. Pluralsight), listening to podcasts and visiting conferences. Lately I started to expand my horizon by meeting people face to face. This turned out to be very rewarding.</p>

<p>These kind of meetups, which often take place in your spare time, are a very efficient way of learning to think outside the box. Meeting other developers in person &mdash; in an informal setting &mdash; enables me to interact directly: Asking questions, as soon as they pop into my mind (everything from &ldquo;what was that keyboard shortcut?&rdquo; to &ldquo;Stop, I did not understand what a monad is&rdquo;).</p>

<p>Here is a short resume of some the meetings I&rsquo;ve been to in the last couple of weeks.</p>

<h3>Softwerkskammer &ndash; Mocking Frameworks</h3>

<p><a href="https://www.softwerkskammer.org/">https://www.softwerkskammer.org/</a></p>

<ul>
<li>Open for all: yes</li>
<li>Audience: Software developers (PHP, Java, .NET, Ruby, Python, etc)</li>
<li>Audience size: 10-15</li>
<li>Time: 3h</li>
<li>Action: Code Kata</li>
</ul>


<p>I learned: <a href="https://gist.github.com/bobuss/6534934">Object Calistenics</a>; cool and simple kata; Cool croud!</p>

<h3>Make Night &ndash; Arduino 101</h3>

<p><a href="https://www.meetup.com/de-DE/HealthhackersER/">Health Hackers Erlangen</a></p>

<ul>
<li>Open for all: yes</li>
<li>Audience: Nice mix of medical researchers, a few physicists, some software developers</li>
<li>Audience size: ~20</li>
<li>Time: 3h</li>
<li>Action: Arduino basics with different sensors, organizer provided kits for everybody</li>
</ul>


<p>I learned: The organizers want to accomplish something. Real medical research supported by &ldquo;hackers&rdquo; (RPi, Arduino, etc). Very interdisciplinary!</p>

<h3>JUG Nuernberg &ndash; Dropwizard</h3>

<p><a href="http://www.jug-n.de/">JUG Nuernberg</a></p>

<ul>
<li>Open for all: yes</li>
<li>Audience: Software developers</li>
<li>Audience size: ~10</li>
<li>Time: 2h</li>
<li>Action: presentation &amp; discussion</li>
</ul>


<p>I learned:  Wow, very impressive framework. I was really fascinated by the so called devops features (healthchecks, logging, etc)! Wish there was something similar in .NET!</p>

<h3>Hackerkegeln DATEV &ndash; Scala Kata</h3>

<ul>
<li>Open for all: no (internal company event)</li>
<li>Audience: Software developers (C/C++, JS, Java, .NET, COBOL, etc)</li>
<li>Audience size: ~10</li>
<li>Time: 4h</li>
<li>Action: interactive Kata in Scala</li>
</ul>


<p>I learned: Scala is a cool language! Learned pattern matching (now also available in <a href="https://blogs.msdn.microsoft.com/dotnet/2016/08/24/whats-new-in-csharp-7-0/">C# 7</a>). Very relaxed audience ;&ndash;)</p>

<p>Thanks to Latti for the invitation!</p>

<h3>MATHEMA Freitag &ndash; Microservices</h3>

<ul>
<li>Open for all: no (internal company event)</li>
<li>Audience: Software developers</li>
<li>Audience size: ~20</li>
<li>Time: 6h</li>
<li>Action: presentations, discussions, interactive microservice setup</li>
</ul>


<p>I learned: incredible cool tooling: Consul, Ribbon, Hystrix, Graphite, ELK</p>

<h2>What to expect?</h2>

<p>First time at such an event? Ask a lot of questions. It might be that you are the expert! If not: you are likely to find an expert. Or somebody will point you to a local expert.</p>

<p>One of the main differences between these local user group meetings and big conferences is that the audience size is a lot smaller. Everybody wants to share and/or gain knowledge at these meetings. The format is often very open: Sometimes there is no official topic for the event. Instead, people decide on the spot: &ldquo;I have no idea how X works. Can somedody explain it?&rdquo; &mdash; &ldquo;Sure&rdquo;. And then the knowledge transfer starts&hellip;</p>

<h2>How to find meetings in your area</h2>

<ul>
<li>google <code>&lt;your technology&gt;</code> <code>user group &lt;your town&gt;</code> for example <code>java</code> <code>user group london</code></li>
<li>Meetup is a plattform for meeting people face to face. Try it: <a href="https://www.meetup.com/">https://www.meetup.com/</a></li>
<li>google <code>Software Craftsmanship &lt;your town&gt;</code></li>
<li>Germany: <a href="https://www.softwerkskammer.org/">Softwerkskammer</a></li>
<li>google <code>Unconference</code> or <code>BarCamp</code> in <code>&lt;your town&gt;</code></li>
</ul>


<p>What do you do to learn new technologies and stay up-to-date?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/01/10/pi-hole-simple-ad-blocker-for-your-network/">Pi Hole - Simple Ad Blocker for Your Network</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-01-10T23:01:24+00:00" pubdate data-updated="true">Jan 10<span>th</span>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Advertisements in web pages can be a nuisance. But they are a necessary evil because companies/bloggers producing high quality content have to earn a living. <a href="https://en.wikipedia.org/wiki/Troy_Hunt">Troy Hunt</a> recently wrote a <a href="https://www.troyhunt.com/ad-blockers-are-part-of-the-problem/">nice post on the subject</a>.</p>

<p>Most <strong>desktop browsers</strong> provide &ldquo;ad blockers&rdquo; as plugins. These plugins normally also have configurable whitelists (whitelist: a list of sites exluded from being blocked) &#8212; which you should use for those sites which (a) provide high quality content and (b) rely on advertisements for a living.</p>

<p>Other devices in our home network also communicate with the web:</p>

<ul>
<li>cell/smart phones (f.ex. iPhone, Android)</li>
<li>smart TVs (f.ex. <a href="https://www.cnet.com/news/samsungs-warning-our-smart-tvs-record-your-living-room-chatter/">Samsung</a>)</li>
<li>and all those new IoT devices (IoT: Internet of Things): those &ldquo;smart&rdquo; home automation devices that communicate with &ldquo;the cloud&rdquo; and your &ldquo;smart phone&rdquo;</li>
</ul>


<p>We can&rsquo;t install &ldquo;ad blockers&rdquo; on these devices.</p>

<p>Here is where <a href="https://github.com/pi-hole/pi-hole">Pi Hole</a> comes into play: We can plug a Raspberry Pi straight into our router!</p>

<p>My experience:</p>

<p>On my phone (an old Galaxy-S4) web pages load a <strong>hell of a lot faster</strong> when I&rsquo;m in my home network compared to outside of my home network.</p>

<p>The Pi Hole web interface looks like this:</p>

<p><img src="/images/posts/pi-hole/screenshot-pi-hole-25-percent-blocked-requests.png"></p>

<p>As you can see in the screenshot: ~20% traffic is blocked (!) and you can configure whitelists just like with those browser plugins. <strong>Nobody in my household noticed that 20% traffic was blocked</strong>.</p>

<p>Installing the software on your Raspberry Pi is straightforward: Just follow the instructions on the <a href="https://github.com/pi-hole/pi-hole">Pi Hole</a> website.</p>

<p>Configuring your router is another beast: OpenWRT and DD-WRT router instructions are available (<a href="https://www.youtube.com/watch?v=TzFLJqUeirA">example &ndash; short youtube promo</a>).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/01/09/bash-tricks/">Bash Tricks</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-01-09T23:22:02+00:00" pubdate data-updated="true">Jan 9<span>th</span>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Over the holidays I stumbled across 2 neat bash tricks to simplify navigation between folders:</p>

<ul>
<li><code>autocd</code></li>
<li><code>autojump</code></li>
</ul>


<p>Neither of these features is new.</p>

<h2>autocd</h2>

<p><code>autocd</code> is very simple: It&rsquo;s a built-in bash feature which prepends <code>cd</code> in case you enter a valid path.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /etc
</span><span class='line'><span class="nv">$ </span>/etc <span class="c"># the same</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Setup</h3>

<p>Add this to your <code>~/.bashrc</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">shopt</span> -s autocd
</span></code></pre></td></tr></table></div></figure>


<h2>autojump</h2>

<blockquote><p>A cd command that learns &ndash; easily navigate directories from the command line</p></blockquote>

<p>Directly from the source at <a href="https://github.com/wting/autojump">autojump</a>:</p>

<p>Usage:</p>

<p><code>j</code> is a convenience wrapper function around <code>autojump</code>. Any option that can be used with <code>autojump</code> can be used with <code>j</code> and vice versa.</p>

<p>Jump To A Directory That Contains <code>foo</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>j foo
</span></code></pre></td></tr></table></div></figure>


<p>Jump To A Child Directory:</p>

<p>Sometimes it&rsquo;s convenient to jump to a child directory (sub-directory of current directory) rather than typing out the full name.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>jc bar
</span></code></pre></td></tr></table></div></figure>


<p>Open File Manager To Directories (instead of jumping):</p>

<p>Instead of jumping to a directory, you can open a file explorer window (Mac Finder, Windows Explorer, GNOME Nautilus, etc.) to the directory instead.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>jo music
</span></code></pre></td></tr></table></div></figure>


<p>Opening a file manager to a child directory is also supported:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>jco images
</span></code></pre></td></tr></table></div></figure>


<p>Using Multiple Arguments:</p>

<p>Let&rsquo;s assume the following database:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>30   /home/user/mail/inbox
</span><span class='line'>10   /home/user/work/inbox
</span></code></pre></td></tr></table></div></figure>


<p><code>j</code> in would jump into <code>/home/user/mail/inbox</code> as the higher weighted entry. However you can pass multiple arguments to <code>autojump</code> to prefer a different entry. In the above example, <code>j w in</code> would then change directory to <code>/home/user/work/inbox</code>.</p>

<p>For more options refer to help:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>autojump --help
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/09/testing-objects-have-same-properties/">Testing That Different Objects Have the Same Properties</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-05-09T17:25:17+00:00" pubdate data-updated="true">May 9<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Sometimes you want to ensure that 2 unrelated objects share a set of properties &mdash; without using an interface.</p>

<p>Here is an example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">namespace</span> <span class="nn">Demo</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Customer</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>First thought for C# developers: <a href="http://automapper.org/">AutoMapper</a></p>

<p>Let&rsquo;s do that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">AutoMapper</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">Demo</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">MyMapping</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="n">IMapper</span> <span class="n">Mapper</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">cfg</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MapperConfiguration</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">x</span><span class="p">.</span><span class="n">CreateMap</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span> <span class="n">Person</span><span class="p">&gt;();</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>            <span class="n">Mapper</span> <span class="p">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">CreateMapper</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can write a unit test to see if we can convert a Customer to a Person:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">Xunit</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">Demo</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">SomeTests</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'><span class="na">        [Fact]</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">void</span> <span class="nf">Given_Customer_Should_ConvertTo_Person</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Arrange</span>
</span><span class='line'>            <span class="k">const</span> <span class="kt">string</span> <span class="n">firstname</span> <span class="p">=</span> <span class="s">&quot;foo&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">const</span> <span class="kt">string</span> <span class="n">lastname</span> <span class="p">=</span> <span class="s">&quot;bar&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="kt">var</span> <span class="n">customer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Customer</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">FirstName</span> <span class="p">=</span> <span class="n">firstname</span><span class="p">,</span>
</span><span class='line'>                <span class="n">LastName</span> <span class="p">=</span> <span class="n">lastname</span>
</span><span class='line'>            <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">MyMapping</span><span class="p">.</span><span class="n">Init</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Act</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">person</span> <span class="p">=</span> <span class="n">MyMapping</span><span class="p">.</span><span class="n">Mapper</span><span class="p">.</span><span class="n">Map</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span> <span class="n">Person</span><span class="p">&gt;(</span><span class="n">customer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Assert</span>
</span><span class='line'>            <span class="n">person</span><span class="p">.</span><span class="n">FirstName</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Be</span><span class="p">(</span><span class="n">firstname</span><span class="p">);</span>
</span><span class='line'>            <span class="n">person</span><span class="p">.</span><span class="n">LastName</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Be</span><span class="p">(</span><span class="n">lastname</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>  
</span></code></pre></td></tr></table></div></figure>


<p>This test passes.</p>

<p>But what happens when we want to ensure that a new Customer property (for example <code>Email</code>) is reflected in the Person object?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">namespace</span> <span class="nn">Demo</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Customer</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">Email</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="c1">// &lt;-- new property</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our unit test still passes. &#9785;</p>

<p><strong>Wouldn&rsquo;t it be nice to have our unit test fail if the classes are not in sync?</strong></p>

<p>Here is where <a href="http://www.fluentassertions.com/">FluentAssertions</a> <code>ShouldBeEquivalentTo</code> comes in handy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">FluentAssertions</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Xunit</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="na">[Fact]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">Given_Customer_Should_ConvertTo_Person_With_CurrentProperties</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//Arrange</span>
</span><span class='line'>    <span class="k">const</span> <span class="kt">string</span> <span class="n">firstname</span> <span class="p">=</span> <span class="s">&quot;foo&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">const</span> <span class="kt">string</span> <span class="n">lastname</span> <span class="p">=</span> <span class="s">&quot;bar&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">customer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Customer</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">FirstName</span> <span class="p">=</span> <span class="n">firstname</span><span class="p">,</span>
</span><span class='line'>        <span class="n">LastName</span> <span class="p">=</span> <span class="n">lastname</span><span class="p">,</span>
</span><span class='line'>        <span class="n">Email</span> <span class="p">=</span> <span class="s">&quot;foo@bar.com&quot;</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">MyMapping</span><span class="p">.</span><span class="n">Init</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Act</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">person</span> <span class="p">=</span> <span class="n">MyMapping</span><span class="p">.</span><span class="n">Mapper</span><span class="p">.</span><span class="n">Map</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span> <span class="n">Person</span><span class="p">&gt;(</span><span class="n">customer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Assert</span>
</span><span class='line'>    <span class="n">customer</span><span class="p">.</span><span class="n">ShouldBeEquivalentTo</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/posts/dotnet/equivalentto_result.png"></p>

<p><code>Subject has a member  Email that the other object does not have.</code></p>

<p>Cool: This is the kind of message I want to have from a unit test!</p>

<p><code>ShouldBeEquivalentTo</code> also takes an optional Lambda expression in case you need more fine grained control which properties are included in the comparison. Here is an example where we exlude the <code>Email</code> property on purpose:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">FluentAssertions</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Xunit</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="na">[Fact]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">Given_Customer_Should_ConvertTo_Person_With_CurrentProperties_Excluding_Email</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//Arrange</span>
</span><span class='line'>    <span class="k">const</span> <span class="kt">string</span> <span class="n">firstname</span> <span class="p">=</span> <span class="s">&quot;foo&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">const</span> <span class="kt">string</span> <span class="n">lastname</span> <span class="p">=</span> <span class="s">&quot;bar&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">customer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Customer</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">FirstName</span> <span class="p">=</span> <span class="n">firstname</span><span class="p">,</span>
</span><span class='line'>        <span class="n">LastName</span> <span class="p">=</span> <span class="n">lastname</span><span class="p">,</span>
</span><span class='line'>        <span class="n">Email</span> <span class="p">=</span> <span class="s">&quot;foo@bar.com&quot;</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">MyMapping</span><span class="p">.</span><span class="n">Init</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Act</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">person</span> <span class="p">=</span> <span class="n">MyMapping</span><span class="p">.</span><span class="n">Mapper</span><span class="p">.</span><span class="n">Map</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span> <span class="n">Person</span><span class="p">&gt;(</span><span class="n">customer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Assert</span>
</span><span class='line'>    <span class="n">customer</span><span class="p">.</span><span class="n">ShouldBeEquivalentTo</span><span class="p">(</span><span class="n">person</span><span class="p">,</span>
</span><span class='line'>        <span class="n">options</span> <span class="p">=&gt;</span>
</span><span class='line'>            <span class="n">options</span><span class="p">.</span><span class="n">Excluding</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Email</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This test passes.</p>

<p>The complete documentation for FluentAssertions&#8217; <code>ShouldBeEquivalentTo</code> method can be found <a href="https://github.com/dennisdoomen/fluentassertions/wiki#object-graph-comparison">here</a>.</p>

<h2>Source code for this post</h2>

<p>You can clone a copy of this project here: <a href="https://github.com/draptik/blog-demo-shouldbeequivalentto">https://github.com/draptik/blog-demo-shouldbeequivalentto</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git clone https://github.com/draptik/blog-demo-shouldbeequivalentto.git
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/29/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-3-ui/">Remotly Measuring Temperatures With a Raspberry Pi Using Radio Frequency Modules From Ciseco (Part 3: UI)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-29T22:07:12+00:00" pubdate data-updated="true">Jul 29<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="/blog/2015/07/10/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-1-hardware/">Part 1</a> describes how to setup the hardware, <a href="/blog/2015/07/10/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-2-software/">part 2</a> describes how to to record/persist the sensor information.</p>

<p>In this post I&rsquo;ll describe how to display the data.</p>

<h2>TL;DR</h2>

<ul>
<li>Download and unzip the source code from <a href="https://github.com/draptik/rpi-temperature-website/archive/v1.0.zip">https://github.com/draptik/rpi-temperature-website/archive/v1.0.zip</a></li>
<li><code>npm install</code></li>
<li><code>bower install</code></li>
<li>(for deployment in LAN: Configure <code>baseUrl</code> in <code>app.js</code>)</li>
<li>(for deployment in LAN: Configure <code>dbLocation</code> in <code>app_api/models/db.js</code>)</li>
<li>(for deployment in LAN: <code>export SET_ENV=production</code>)</li>
<li><code>npm start</code></li>
</ul>


<p>Should be similar to <a href="http://rpi-temperatures-website-demo.firebaseapp.com/">http://rpi-temperatures-website-demo.firebaseapp.com/</a>.</p>

<h2>Choosing the right technology stack</h2>

<p>This really depends on your individual needs. Here are some points to consider:</p>

<ul>
<li>How many people will be accessing the site?</li>
<li>Do you have to access the site from outside of your LAN? Do you need a login mechanism?</li>
<li>Which technology stack are you comfortable with? Which technology stack is supported on the server?</li>
<li>Database interaction possible (this demo uses SQLite3)?</li>
</ul>


<p>If you know that you&rsquo;ll have many requests I would discourage you from using the Raspberry Pi (RPi) as a web server.</p>

<p>Otherwhise, the RPi is a good choice for a web server.</p>

<p>Some of the technology stacks available on the RPi are:</p>

<ul>
<li>JVM: Java, Scala</li>
<li>.NET/Mono: C#, F#</li>
<li>Python</li>
<li>JS: <a href="https://nodejs.org/">Node.js</a></li>
</ul>


<p>Since I only want to display data in my LAN I decided to use Javascript: <a href="https://nodejs.org/">Node.js</a> in combination with the <a href="http://expressjs.com/">Express framework</a> provides all possible features and is very lightweight.</p>

<p>No matter which stack you choose:
Running the web site on the same RPi as the temperature recording from the previous posts saves you the hassle of installing software on a different machine. And it obviously saves energy, since the RPi is running 24/7 anyway recording temperature data.</p>

<h2>User Interface</h2>

<p>My primary goal was <em>explorative data visualization</em>. For this purpose I decided to show 2 plots:</p>

<ul>
<li>an overview plot showing the past 14 days</li>
<li>and a detail plot, showing the selection of the overview plot</li>
</ul>


<p>You can test the website with some sample data at
<a href="http://rpi-temperatures-website-demo.firebaseapp.com/">http://rpi-temperatures-website-demo.firebaseapp.com/</a></p>

<p><img src="/images/posts/rpi_temperatures/screenshot-demo.png"></p>

<p>Some of the UI features:</p>

<ul>
<li>The detail plot can be dragged and the overview plot has a selection region which can be resized and dragged.</li>
<li>Changes to either plot are reflected in the other.</li>
<li>Mouse movement in the detail plot updates the legend.</li>
</ul>


<p>All charting features are implemented using <a href="http://www.flotcharts.org/">Flot</a>.</p>

<h2>Prerequisites: Node.js</h2>

<p>Here is a very concise manual on how to install Node.js on the RPi (this
gives you a more up to date version of Node.js than default Raspbian does):
<a href="http://weworkweplay.com/play/raspberry-pi-nodejs/">http://weworkweplay.com/play/raspberry-pi-nodejs/</a></p>

<h2>Installation</h2>

<p>All further instructions are expected to be executed on the RPi.</p>

<p>Download and unzip the source code from</p>

<p><a href="https://github.com/draptik/rpi-temperature-website/archive/v1.0.zip">https://github.com/draptik/rpi-temperature-website/archive/v1.0.zip</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd ~
</span><span class='line'>mkdir website && cd website
</span><span class='line'>wget https://github.com/draptik/rpi-temperature-website/archive/v1.0.zip
</span><span class='line'>unzip *.zip
</span><span class='line'>cd rpi*</span></code></pre></td></tr></table></div></figure>


<p>Install backend packages (node packages are defined in <code>packages.json</code>):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>npm install</span></code></pre></td></tr></table></div></figure>


<p>Node.js packages are installed to folder <code>node_modules</code>.</p>

<ul>
<li>the folder <code>app_server</code> contains the basic web site.</li>
<li>the folder <code>app_api</code> provides the REST backend.</li>
</ul>


<p>Install frontend packages (bower packages are defined in <code>bower.json</code>):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bower install</span></code></pre></td></tr></table></div></figure>


<p>Bower packages are installed to folder <code>public/vendor/bower</code>.</p>

<p>You should now be able to start the application (using the provided sample data in folder <code>sample_data</code>):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>npm start</span></code></pre></td></tr></table></div></figure>


<h2>Configuration (development vs production)</h2>

<p>The application uses a single switch between development mode and production mode:</p>

<p><code>NODE_ENV</code></p>

<p>This information is currently used in the following places in the application:</p>

<h3>REST URL</h3>

<p>Setting the URL for the REST service (in <code>app.js</code>):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var url = process.env.NODE_ENV === 'production' ? 'http://camel:3000' : 'http://localhost:3000';</span></code></pre></td></tr></table></div></figure>


<p>Within my LAN the RPi is named <code>camel</code>&hellip;</p>

<p>And in case you&rsquo;re not familiar with the syntax</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var result = someCondition ? 'string1' : 'string2';</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s just a shorthand for</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var result;
</span><span class='line'>if (someCondition) {
</span><span class='line'>  result = 'string1';
</span><span class='line'>} else {
</span><span class='line'>  result = 'string2';
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>Database location</h3>

<p>Setting the database location (in <code>app_api/models/db.js</code>):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var dbLocation = process.env.NODE_ENV === 'production' ? '/var/www/templog.db' : 'sample_data/templog.db';</span></code></pre></td></tr></table></div></figure>


<h3>Usage</h3>

<p>Once you&rsquo;ve configured the LAN URL and the database location, you can set the environment variable <code>NODE_ENV</code> to <code>production</code> and start the application:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export NODE_ENV=production
</span><span class='line'>npm start</span></code></pre></td></tr></table></div></figure>


<h3>Customizing</h3>

<p>You will probably want to customize the UI, as my design skills are limited at best. ;&ndash;)</p>

<p>Here&rsquo;s an overview of the project, so you know where to change things:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>├── app_api                     //  REST API
</span><span class='line'>│   ├── controllers
</span><span class='line'>│   │   └── temperatures.js
</span><span class='line'>│   ├── models
</span><span class='line'>│   │   ├── db.js               //  DATABASE
</span><span class='line'>│   └── routes
</span><span class='line'>│       └── index.js
</span><span class='line'>├── app.js                      //  MAIN ENTRY POINT FOR THE APPLICATION
</span><span class='line'>├── app_server                  //  web server (express.js)
</span><span class='line'>│   ├── controllers
</span><span class='line'>│   │   ├── main.js
</span><span class='line'>│   │   └── temperatures.js
</span><span class='line'>│   ├── models
</span><span class='line'>│   ├── routes
</span><span class='line'>│   │   ├── index.js
</span><span class='line'>│   │   ├── temperatures.js
</span><span class='line'>│   └── views
</span><span class='line'>│       ├── error.jade
</span><span class='line'>│       ├── index.jade
</span><span class='line'>│       ├── layout.jade
</span><span class='line'>│       └── temperatures-list.jade
</span><span class='line'>├── bower.json                  //  Bower configuration (frontend)
</span><span class='line'>├── node_modules                //  Location of node modules
</span><span class='line'>├── nodemon.json                //  nodemon configuration
</span><span class='line'>├── package.json                //  node configuration
</span><span class='line'>├── public                      //  frontend stuff...
</span><span class='line'>│   ├── images                  //  images
</span><span class='line'>│   ├── scripts                 //  Javascript code
</span><span class='line'>│   │   ├── chart.js            //  This file includes all charting code
</span><span class='line'>│   │   ├── rest.js             //  wrapper code to access REST API
</span><span class='line'>│   │   └── suncalc.js          //  calc sunrise/sunset on the fly
</span><span class='line'>│   ├── stylesheets             //  ...
</span><span class='line'>│   │   ├── app.css
</span><span class='line'>│   │   ├── chart.css
</span><span class='line'>│   └── vendor                  //  3rd party libraries
</span><span class='line'>│       ├── bower               //  ...installed via bower
</span><span class='line'>│       └── custom              //  ...other 3rd party libraries
</span><span class='line'>├── sample_data                 //  sample data
</span><span class='line'>│   └── templog.db              //  sqlite3 sample data set</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it. Have fun!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/09/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-2-software/">Remotly Measuring Temperatures With a Raspberry Pi Using Radio Frequency Modules From Ciseco (Part 2: Software)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-09T22:13:12+00:00" pubdate data-updated="true">Jul 9<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In the <a href="/blog/2015/07/10/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-1-hardware/">previous post</a> I described how to setup the hardware for measuring temperatures at home.
This post will use a small python program to save the recorded temperatures to a database.</p>

<p>For simplicity&rsquo;s sake we&rsquo;ll be using SQLite3 as our database.</p>

<p>Aside from our (indoor) temperature sensors, we&rsquo;ll also retrieve outdoor temperatures using the free service <a href="http://www.wunderground.com/">weather underground</a> (registration required).</p>

<p>Note: In case your Raspberry Pi does not have access to the internet you can just exlude the weather underground parts in the code below.</p>

<p>All following code is intended to run on the Raspberry Pi receiving the data.</p>

<h3>Create database (SQLite3)</h3>

<p>The database schema is simple. We need one table to store the temperatures, and another to store sensor information.</p>

<p>Create a new file called <code>templog.db</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>touch templog.db
</span></code></pre></td></tr></table></div></figure>


<p>There are different ways to interact with SQLite3 (cli (=interactive), script, api).</p>

<p>The goal is to execute the following sql statements:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">sensors</span>
</span><span class='line'><span class="p">(</span>
</span><span class='line'>    <span class="n">name</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="n">id</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="n">baudrate</span> <span class="nb">INTEGER</span><span class="p">,</span>
</span><span class='line'>    <span class="n">port</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="n">active</span> <span class="nb">INTEGER</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">temps</span>
</span><span class='line'><span class="p">(</span>
</span><span class='line'>    <span class="k">timestamp</span> <span class="nb">TEXT</span><span class="p">,</span>
</span><span class='line'>    <span class="n">temp</span> <span class="nb">REAL</span><span class="p">,</span>
</span><span class='line'>    <span class="n">ID</span> <span class="nb">TEXT</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Simplest solution is to open the newly created file <code>templog.db</code> with <code>sqlite3</code> (cli/interactive) &hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">sqlite3</span> <span class="n">templog</span><span class="p">.</span><span class="n">db</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip;and past the previous code block. Should look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="err">$</span> <span class="n">sqlite3</span> <span class="n">demo</span><span class="p">.</span><span class="n">db</span>
</span><span class='line'><span class="n">SQLite</span> <span class="k">version</span> <span class="mi">3</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">2</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span> <span class="mi">18</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">19</span>
</span><span class='line'><span class="n">Enter</span> <span class="ss">&quot;.help&quot;</span> <span class="k">for</span> <span class="k">usage</span> <span class="n">hints</span><span class="p">.</span>
</span><span class='line'><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">sensors</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span> <span class="p">(</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">name</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">id</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">baudrate</span> <span class="nb">INTEGER</span><span class="p">,</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">port</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">active</span> <span class="nb">INTEGER</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span> <span class="p">);</span>
</span><span class='line'><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">temps</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span> <span class="p">(</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">timestamp</span> <span class="nb">TEXT</span><span class="p">,</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">temp</span> <span class="nb">REAL</span><span class="p">,</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">ID</span> <span class="nb">TEXT</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve created a database.</p>

<p>The important table is <code>temps</code>: It will contain the measurements.</p>

<p>The other table (<code>sensors</code>) contains informations about the sensors, which are currently only needed for the weather underground &lsquo;sensor&rsquo;. And yes: the column names/types are not optimal.</p>

<p>Note: <code>timestamp TEXT</code> will bite us in the ass, but SQLite3 does NOT have any date type.</p>

<h3>Monitor script</h3>

<p>I found this nice script somewhere on <a href="https://github.com/kal001/temperature">Github</a>. So Thank You <a href="https://github.com/kal001">kal001</a>!</p>

<p>Here&rsquo;s my <a href="https://gist.github.com/draptik/36834b68b7b4d6366f38">gist link for the script below</a>.</p>

<p>Place this script side-by-side to <code>temps.log</code>.</p>

<p>Save it as <code>monitor.py</code>.</p>

<p>You will probably want to modify the values for <code>dbname</code>, <code>TIMEOUT</code>, <code>debug.txt</code>, etc.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">sqlite3</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">threading</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">sleep</span><span class="p">,</span> <span class="n">gmtime</span><span class="p">,</span> <span class="n">strftime</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">serial</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">requests</span>
</span><span class='line'>
</span><span class='line'><span class="c"># global variales</span>
</span><span class='line'>
</span><span class='line'><span class="c"># sqlite database location</span>
</span><span class='line'><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;templog.db&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># serial device</span>
</span><span class='line'><span class="n">DEVICE</span> <span class="o">=</span> <span class="s">&#39;/dev/ttyAMA0&#39;</span>
</span><span class='line'><span class="n">BAUD</span> <span class="o">=</span> <span class="mi">9600</span>
</span><span class='line'>
</span><span class='line'><span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">,</span> <span class="n">BAUD</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># timeout in seconds for waiting to read temperature from sensors</span>
</span><span class='line'><span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">30</span>
</span><span class='line'>
</span><span class='line'><span class="c"># weather underground data</span>
</span><span class='line'><span class="n">WUKEY</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class='line'><span class="n">STATION</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class='line'><span class="c"># time between weather underground samples in seconds</span>
</span><span class='line'><span class="n">SAMPLE</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">log_temperature</span><span class="p">(</span><span class="n">temp</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Store the temperature in the database.</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
</span><span class='line'>    <span class="n">curs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;INSERT INTO temps values(datetime(&#39;now&#39;, &#39;localtime&#39;), &#39;{0}&#39;, &#39;{1}&#39; )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">temp</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span class='line'>    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">get_temp</span><span class="p">():</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Retrieves the temperature from the sensor.</span>
</span><span class='line'>
</span><span class='line'><span class="sd">    Returns -100 on error, or the temperature as a float.</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">global</span> <span class="n">ser</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">tempvalue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span class='line'>    <span class="n">deviceid</span> <span class="o">=</span> <span class="s">&#39;??&#39;</span>
</span><span class='line'>    <span class="n">voltage</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">fim</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">TIMEOUT</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">fim</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tempvalue</span> <span class="o">==</span> <span class="o">-</span><span class="mi">100</span><span class="p">):</span>
</span><span class='line'>        <span class="n">n</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">()</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>            <span class="n">data</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span class='line'>            <span class="n">nb_msg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_msg</span><span class="p">):</span>
</span><span class='line'>                <span class="n">msg</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">12</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">]</span>
</span><span class='line'>                <span class="n">deviceid</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;TMPA&quot;</span><span class="p">:</span>
</span><span class='line'>                    <span class="n">tempvalue</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;BATT&quot;</span><span class="p">:</span>
</span><span class='line'>                    <span class="n">voltage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span>
</span><span class='line'>                    <span class="k">if</span> <span class="n">voltage</span> <span class="o">==</span> <span class="s">&quot;LOW&quot;</span><span class="p">:</span>
</span><span class='line'>                        <span class="n">voltage</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;temperature&#39;</span><span class="p">:</span><span class="n">tempvalue</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">:</span><span class="n">deviceid</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">get_temp_wu</span><span class="p">():</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Retrieves temperature(s) from weather underground (wu) and stores it to the database</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
</span><span class='line'>        <span class="n">curs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class='line'>        <span class="n">query</span> <span class="o">=</span> <span class="s">&quot;SELECT baudrate, port, id, active FROM sensors WHERE id like &#39;W_&#39;&quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>        <span class="n">rows</span> <span class="o">=</span> <span class="n">curs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">#print(rows)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">rows</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">[:]:</span>
</span><span class='line'>                <span class="n">WUKEY</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>                <span class="n">STATION</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>                    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>                        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://api.wunderground.com/api/{0}/conditions/q/{1}.json&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">WUKEY</span><span class="p">,</span> <span class="n">STATION</span><span class="p">)</span>
</span><span class='line'>                        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>                        <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span class='line'>                        <span class="n">log_temperature</span><span class="p">({</span><span class="s">&#39;temperature&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;current_observation&#39;</span><span class="p">][</span><span class="s">&#39;temp_c&#39;</span><span class="p">],</span> <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]})</span>
</span><span class='line'>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>                        <span class="k">raise</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>        <span class="n">text_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;debug.txt&quot;</span><span class="p">,</span> <span class="s">&quot;a+&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{0} ERROR:</span><span class="se">\n</span><span class="s">{1}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">gmtime</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</span><span class='line'>        <span class="n">text_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Program starts here.</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">get_temp_wu</span><span class="p">()</span>
</span><span class='line'>    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">SAMPLE</span><span class="p">,</span> <span class="n">get_temp_wu</span><span class="p">)</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
</span><span class='line'>        <span class="n">temperature</span> <span class="o">=</span> <span class="n">get_temp</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">temperature</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">:</span>
</span><span class='line'>            <span class="n">log_temperature</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
</span><span class='line'>            <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">SAMPLE</span><span class="p">,</span> <span class="n">get_temp_wu</span><span class="p">)</span>
</span><span class='line'>            <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the script. Open another shell, take a look inside the database (new data arriving once an hour?).</p>

<p>Don&rsquo;t forget to start the script after turning off the Raspberry Pi. Or include the script in your boot process (init, systemd).</p>

<p><a href="/blog/2015/07/30/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-3-ui/">Part 3</a> will provide a UI for the collected data.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/09/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-1-hardware/">Remotly Measuring Temperatures With a Raspberry Pi Using Radio Frequency Modules From Ciseco (Part 1: Hardware)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-09T22:11:00+00:00" pubdate data-updated="true">Jul 9<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since I&rsquo;m a software developer, I&rsquo;ve always been wanting to do some hardware stuff (including some soldering) with my Raspberry Pi.
So, for starters, I picked something that was useful and only involved sensors (no actors &ndash; yet):</p>

<p>Measuring temperatures at home.</p>

<p>Neither rocket science nor cool IoT &ldquo;coffe is ready when I get out of the shower in the morning&rdquo;, I know.</p>

<p>The sensor(s) should send a signal once an hour, without cable, and run on battery.</p>

<p>As the whole IoT thing is still relatively new, there are no standards yet. I picked the product line from <a href="http://shop.ciseco.co.uk/">Ciseco</a> (<a href="http://shop.ciseco.co.uk/about-us/">currently being rebranded to Wireless Things (www.wirelessthings.com)</a>). Affordable and good documentation. And, more important: These people are passionate about their product!</p>

<p>Before we get started here is a quick preview of what we want to accomplish (for details about the UI see <a href="/blog/2015/07/30/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-3-ui/">part3</a>): <a href="http://rpi-temperatures-website-demo.firebaseapp.com/">http://rpi-temperatures-website-demo.firebaseapp.com/</a></p>

<p><img src="/images/posts/rpi_temperatures/screenshot-demo.png"></p>

<p>So let&rsquo;s get started:</p>

<ul>
<li>2 battery powered sensors transmitting temperature data once per hour via radio frequency.</li>
<li>Raspberry Pi is powered 24/7 and records signals from sensors.</li>
</ul>


<h2>Parts &amp; Costs</h2>

<ul>
<li>1x &pound;3.90 Slice of Pi <a href="http://shop.ciseco.co.uk/slice-of-pi-add-on-for-raspberry-pi/">http://shop.ciseco.co.uk/slice-of-pi-add-on-for-raspberry-pi/</a></li>
<li>2x &pound;8.50 Sensor THERMISTOR <a href="http://shop.ciseco.co.uk/temperature-xrf-development-sensor-thermistor/">http://shop.ciseco.co.uk/temperature-xrf-development-sensor-thermistor/</a></li>
<li>3x &pound;11.88 XRF wireless RF radio UART serial data module <a href="http://shop.ciseco.co.uk/xrf-wireless-rf-radio-uart-serial-data-module-xbee-shaped/">http://shop.ciseco.co.uk/xrf-wireless-rf-radio-uart-serial-data-module-xbee-shaped/</a></li>
</ul>


<p>Total: &pound;56.54</p>

<p>If you only want a single sensor (1 Slice of Pi, 1 Sensor, 2 XRF modules): &pound;36.16</p>

<h2>Setup overview</h2>

<p><img src="/images/posts/rpi_temperatures/overview.png"></p>

<ul>
<li>On the left is the Raspberry Pi with an XRF module mounted to the Slice of Pi.

<ul>
<li>The Slice of Pi acts as a breakout board.</li>
<li>The XRF module will receive data.</li>
<li>The Raspberry Pi will be continously monitoring input and storing the information locally to an SQLite3 database. See <a href="(/blog/2015/07/10/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-2-software/">part 2</a> for details.</li>
</ul>
</li>
<li>On the right are two sensors with XRF modules.

<ul>
<li>These modules will send temperature data once per hour to the Raspberry Pi.</li>
<li>These modules run on battery power.</li>
<li>You can have as many of these sensors as you want.</li>
</ul>
</li>
</ul>


<p>Each XRF module requires a unique id (&lsquo;XRF ID&rsquo; in the image above).</p>

<h2>Hardware: Fitting the pieces &amp; soldering</h2>

<p>The official documentation is pretty good. If you know what you&rsquo;re doing.</p>

<ul>
<li>For the Slice of Pi: <a href="http://openmicros.org/GSG/Slice%20of%20Pi%20-%20v1-1%20getting%20started%20guide.pdf">http://openmicros.org/GSG/Slice%20of%20Pi%20-%20v1-1%20getting%20started%20guide.pdf</a></li>
<li>For the sensor module(s): <a href="http://openmicros.org/index.php/articles/88-ciseco-product-documentation/211-ccb-coin-cell-board-pictorial-build-guide">http://openmicros.org/index.php/articles/88-ciseco-product-documentation/211-ccb-coin-cell-board-pictorial-build-guide</a></li>
</ul>


<p>In case you are not really sure what you are doing with the soldering iron: Keep calm. There is a lot of information on the internet. I found the following step-by-step instruction useful:</p>

<p><a href="http://www.pihomeserver.fr/en/2013/07/11/raspberry-pi-assembler-un-emetteur-radio-pour-votre-sonde-de-temperature/">Raspberry Pi &ndash; Assemble your temperature THERMISTOR with an XRF transmitter probe</a></p>

<p>Here is what the assembled sensor looks like:
<img src="/images/posts/rpi_temperatures/assembled_sensor_notes.jpg"></p>

<p>Here is a picture of the sensor in the box. You have to create the holes in the top of the box yourself. I just used the soldering iron to melt both holes, which is probably not considered best practice ;&ndash;)</p>

<p><img src="/images/posts/rpi_temperatures/boxed_sensor_notes.jpg"></p>

<p>And here is a picture of the Raspberry Pi with an XRF module mounted on the Slice of Pi:
<img src="/images/posts/rpi_temperatures/rpi_notes.jpg"></p>

<p>Note: The sensor comes with a box. In case you want to place the sensor inside the box make sure <strong>not to solder the thermistor to close to the board</strong>. You will want to make a hole in the box and have the thermistor stick out. Otherwise the thermistor will be inside the closed box and measure the temperature inside the box (instead of outside the box). Here is a picture illustrating the issue:</p>

<p><img src="/images/posts/rpi_temperatures/sensor.png"></p>

<h2>OS</h2>

<p>This is one of the reasons I picked Ciseco for my simple project: They provide a standard Linux distribution (Raspbian) including their drivers.</p>

<p>This means the &ldquo;Slice of Pi&rdquo; works out of the box.</p>

<p>And the rest of the system behaves like a normal Raspbian system. There is no vendor &ldquo;lock-in&rdquo;.</p>

<p>Ciseco&rsquo;s patched version of Raspbian <a href="http://openmicros.org/Download/">here</a>.
Currently this is <a href="http://openmicros.org/Download/2015-05-05-raspbain-wheezy-raswik-shrunk.img.zip">http://openmicros.org/Download/2015-05-05-raspbain-wheezy-raswik-shrunk.img.zip</a>.
I used the slightly older version <a href="http://openmicros.org/Download/2014-12-24-wheezy-raspbian-ciseco-shrunk.img.zip">http://openmicros.org/Download/2014-12-24-wheezy-raspbian-ciseco-shrunk.img.zip</a>.</p>

<h2>Software (well, actually Firmware)</h2>

<p>All parts are soldered and the RPi has the correct operating system.</p>

<p>Our next steps (from a bird&rsquo;s eye perspective) are:</p>

<ul>
<li>uploading the correct firmware onto the sensors&#8217; XRF module</li>
<li>configuring the sensors&#8217; XRF module</li>
</ul>


<p>The following instructions are mostly taken from <a href="http://www.seanlandsman.com/2013/02/the-raspberry-pi-and-wireless-rf-xrf.html">Sean Landsman&rsquo;s excellent tutorial</a>.</p>

<h3>Upload firmware to sensor(s)&lsquo; XRF module</h3>

<p>Why do we have to do this?</p>

<p>The sensor board is generic and can be configured for working with different types of sensors. We&rsquo;re using a thermistor, in case you forgot&hellip; The thing with the antenna is the XRF module. We have 3 XRF modules: 1 for receiving data, 2 for sending data. We&rsquo;ll take care of the sending modules first.</p>

<p>The tool for uploading the appropriate firmware to XRF modules is called <code>xrf_uploader</code>.</p>

<p>Download the <code>xrf_uploader</code> source code from Ciseco&rsquo;s Github page at <a href="https://github.com/CisecoPlc/XRF-Uploader">https://github.com/CisecoPlc/XRF-Uploader</a> to the Raspberry Pi.</p>

<p>Then compile the file <code>xrf_uploader.cpp</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>g++ xfr_uploader.cpp -o xrf_uploader
</span><span class='line'>chmod +x xrf_uploader
</span></code></pre></td></tr></table></div></figure>


<p>Next, get a copy of the thermistor firmware from Ciseco&rsquo;s Github page at <a href="https://github.com/CisecoPlc/XRF-Firmware-downloads/tree/master/XRFV2%20ARF%20SRF%20-%20LLAP">https://github.com/CisecoPlc/XRF-Firmware-downloads/tree/master/XRFV2%20ARF%20SRF%20-%20LLAP</a>.
At the time of writing, the most current version of the termistor firmware was <a href="https://github.com/CisecoPlc/XRF-Firmware-downloads/blob/master/XRFV2%20ARF%20SRF%20-%20LLAP/llapThermistor-V0.73-24MHz.bin">llapThermistor-V0.73-24MHz.bin</a>.</p>

<ul>
<li>Shutdown the Raspberry Pi (<code>sudo init 0</code>)</li>
<li>Connect the first XRF &lsquo;sensor&rsquo; module with the Slice of Pi</li>
<li>Start the Raspberry Pi again</li>
</ul>


<p>Copy the thermistor firmware into the same folder as the <code>xrf_uploader</code> and upload the firmware to the newly connected XRF module:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>./xrf_uploader -d /dev/ttyAMA0 -f llapThermistor-V0.73-24MHz.bin
</span></code></pre></td></tr></table></div></figure>


<p>Note: <code>/dev/ttyAMA0</code> is the Raspberry Pi&rsquo;s location of the <a href="http://en.wikipedia.org/wiki/Universal_asynchronous_receiver/transmitter">UART</a>.</p>

<p>The upload should look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>pi@raspberrypi ~/xrf_loader <span class="nv">$ </span>./xrf_uploader -d /dev/ttyAMA0 -f llapThermistor-V0.73-24MHz.bin
</span><span class='line'>Writing new firmware file llapThermistor-V0.50-24MHz.bin to device /dev/ttyAMA0 with baud rate 9600...
</span><span class='line'>Reading firmware file...
</span><span class='line'>Read 1300 lines from firmware file
</span><span class='line'>Opening device...
</span><span class='line'>Setting serial parameters...
</span><span class='line'>Waiting <span class="k">for </span>device to settle...
</span><span class='line'>
</span><span class='line'>&lt;&gt; Entering <span class="nb">command </span>modus
</span><span class='line'>&lt;- OK
</span><span class='line'>-&gt; ATVR
</span><span class='line'>&lt;- 0.63B XRF
</span><span class='line'>&lt;- OK
</span><span class='line'>-&gt; ATPG
</span><span class='line'>&lt;- OK
</span><span class='line'>&lt;&gt; Sent 1300 of 1300 lines...
</span><span class='line'>
</span><span class='line'>All OK, XRF successfully reprogrammed!
</span><span class='line'>
</span><span class='line'>Waiting <span class="k">for </span>device to settle...
</span><span class='line'>
</span><span class='line'>&lt;&gt; Entering <span class="nb">command </span>modus
</span><span class='line'>&lt;- OK
</span><span class='line'>-&gt; ATVR
</span><span class='line'>&lt;- 0.50B APTHERM
</span><span class='line'>&lt;- OK
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Shutdown the Raspberry Pi</li>
<li>Detach the freshly configured XRF &lsquo;sensor&rsquo; module and replace it with the XRF module which will be receiving temperature information (this XRF module is called the &lsquo;pass-through&rsquo;).</li>
<li>Connect the the &lsquo;sensor&rsquo; XRF module used for temperature measurement with thermistor board.</li>
<li>Do not insert the battery yet!</li>
<li>Start the Raspberry Pi again.</li>
</ul>


<h3>Configure sensors (XRF modules)</h3>

<p>We now have</p>

<ul>
<li>fully equipped sensor(s) without battery power</li>
<li>Raspberry Pi with receiving sensor</li>
</ul>


<p>Again: Do not insert batteries into the sensors yet.</p>

<p>We first have to install a protocol to communicate between the &lsquo;sensor&rsquo; and the &lsquo;pass-through&rsquo; (aka &lsquo;receiving&rsquo;) XRF device.</p>

<p>Download <a href="http://sourceforge.net/projects/pyserial/files/pyserial/2.5/pyserial-2.5.tar.gz/download">pySerial</a> to the Raspberry Pi.</p>

<p>Unpack and install pySerial:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>tar xvzf pyserial-2.5.tar.gz
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>pyserial-2.5
</span><span class='line'><span class="nv">$ </span>sudo python setup.py install
</span></code></pre></td></tr></table></div></figure>


<h4>Using pySerial/miniterm</h4>

<p>pySerial comes with <code>miniterm.py</code>, a small serial terminal. Attach to the terminal:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>python ~/pyserial-2.5/examples/miniterm.py /dev/ttyAMA0
</span></code></pre></td></tr></table></div></figure>


<p>Press Ctrl+T, followed by Ctrl+E to enable the echo area. This helps during debugging.</p>

<p>Note: The terminal is not intended for <em>typing</em> commands: Always <em>paste</em> the commands from somewhere else.</p>

<p>Note: Once the battery is inserted it will drain very quickly during debugging. Ensure to unplug the battery if it&rsquo;s not needed.</p>

<h5>miniterm: First contact</h5>

<p>While miniterm is running, insert the battery. The output should look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>a--STARTED--a--STARTED--a--STARTED--a--STARTED--a--STARTED--a--STARTED--
</span></code></pre></td></tr></table></div></figure>


<p>What we are seeing is an example of LLAP (Ciseco&rsquo;s lightweight local automation protocol). A complete documentation of the protocol can be found <a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/112-llap">here</a> and <a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/297-llap-reference">here</a>.</p>

<p>From Ciseco&rsquo;s documentation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>The message structure
</span><span class='line'>
</span><span class='line'><span class="o">[</span>...<span class="o">]</span> the message is 12 characters long and in 3 distinct sections. To illustrate the 3 separate parts to the message, see this example:
</span><span class='line'>
</span><span class='line'>aXXDDDDDDDD
</span><span class='line'>1.     <span class="s2">&quot;a&quot;</span> is lower <span class="k">case </span>and shows the start of the message
</span><span class='line'>
</span><span class='line'>2.     XX is the device identifier <span class="o">(</span>address A-Z &amp; A-Z<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>3.      DDDDDDDDDD is the data being exchanged.
</span><span class='line'>
</span><span class='line'>Note: Only the first <span class="s2">&quot;a&quot;</span> character is lowercase, the remaining message always uses uppercase.
</span></code></pre></td></tr></table></div></figure>


<p>Paste <code>a--HELLO----</code> into the miniterm. In case your wondering: The default identifier is <code>--</code>. We&rsquo;ll change that later.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>python ~/pyserial-2.5/examples/miniterm.py /dev/ttyAMA0
</span><span class='line'>--- Miniterm on /dev/ttyAMA0: 9600,8,N,1 ---
</span><span class='line'>--- Quit: Ctrl+<span class="o">]</span>  |  Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
</span><span class='line'>--- <span class="nb">local echo </span>active ---
</span><span class='line'>a--HELLO----
</span></code></pre></td></tr></table></div></figure>


<p>If the remote device is running and configured correctly the output should immediatly change to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>python ~/pyserial-2.5/examples/miniterm.py /dev/ttyAMA0
</span><span class='line'>--- Miniterm on /dev/ttyAMA0: 9600,8,N,1 ---
</span><span class='line'>--- Quit: Ctrl+<span class="o">]</span>  |  Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
</span><span class='line'>--- <span class="nb">local echo </span>active ---
</span><span class='line'>a--HELLO----a--HELLO----
</span></code></pre></td></tr></table></div></figure>


<p>Note the duplicate <code>a--HELLO----</code> in the last line. The second <code>a--HELLO----</code> is the answer from the remote device.</p>

<h5>miniterm: Change device ID</h5>

<p>Since all devices have the same initial ID, it is a good idea to change the device ID in case you intend to use more than one remote device.</p>

<p>The following code changes the device ID to <code>ZZ</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>a--CHDEVIDZZ
</span><span class='line'>a--REBOOT---
</span></code></pre></td></tr></table></div></figure>


<p>The terminal output should look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>python ~/pyserial-2.5/examples/miniterm.py /dev/ttyAMA0
</span><span class='line'>--- Miniterm on /dev/ttyAMA0: 9600,8,N,1 ---
</span><span class='line'>--- Quit: Ctrl+<span class="o">]</span>  |  Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
</span><span class='line'>--- <span class="nb">local echo </span>active ---
</span><span class='line'>a--CHDEVIDZZ
</span><span class='line'>a--REBOOT---aZZSTARTED--aZZSTARTED--aZZSTARTED--aZZSTARTED--aZZSTARTED--aZZSTARTED--
</span></code></pre></td></tr></table></div></figure>


<h5>miniterm: Read temperature</h5>

<p>Assuming the device ID is <code>ZZ</code> reading the temperature is accomplished by <code>aZZTEMP-----</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>python ~/pyserial-2.5/examples/miniterm.py /dev/ttyAMA0
</span><span class='line'>--- Miniterm on /dev/ttyAMA0: 9600,8,N,1 ---
</span><span class='line'>--- Quit: Ctrl+<span class="o">]</span>  |  Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
</span><span class='line'>--- <span class="nb">local echo </span>active ---
</span><span class='line'>aZZTEMP-----aZZTMPA24.21
</span></code></pre></td></tr></table></div></figure>


<p>In the above answer from the remote device the temperature is 24.21 degrees Celsius.</p>

<h5>miniterm: Configure measurement interval</h5>

<p>Currently the remote device is contiously sending information. And draining the battery. To preserve battery power the interval can be configured to send information periodically using the command <code>a--INTVL</code>. The interval is defined with a 3 digit number followed by the time period: S(seconds), M(minutes), H(hours), D(days). For example the command <code>aZZINTVL005S</code> would set the interval of the remote device to 5 seconds.</p>

<p>Additionally the device should be sent to sleep in between cylces by issuing the command <code>aZZCYCLE----</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>python ~/pyserial-2.5/examples/miniterm.py /dev/ttyAMA0
</span><span class='line'>--- Miniterm on /dev/ttyAMA0: 9600,8,N,1 ---
</span><span class='line'>--- Quit: Ctrl+<span class="o">]</span>  |  Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
</span><span class='line'>--- <span class="nb">local echo </span>active ---
</span><span class='line'>aZZINTVL001H
</span><span class='line'>aZZCYCLE----
</span></code></pre></td></tr></table></div></figure>


<p>The above example sets the interval to one hour (<code>001H</code>).</p>

<p>Repeat the sensor setup and configuration for each sensor which needs to send data. The &lsquo;pass-through&rsquo; (aka receiving) sensor does not have to be configured.</p>

<p><a href="/blog/2015/07/10/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-2-software/">Part 2</a> describes a simple program to monitor the data being produced by this setup.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/18/dot-net-backend-providing-rest/">.NET Backend Providing REST</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-18T16:46:33+00:00" pubdate data-updated="true">Jul 18<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>TL;DR</h2>

<p>My <a href="https://github.com/draptik/angulardemorestful">AngularJS demo app</a> has a new backend implementation using <a href="http://www.asp.net/web-api">.NET Web API</a>.</p>

<h1>&hellip;</h1>

<h2>Recap</h2>

<p>Our goals:</p>

<ul>
<li>server side: minimal working REST API providing

<ul>
<li>GET <code>dummy</code></li>
<li>CRUD <code>users</code></li>
</ul>
</li>
<li>client side (angular): communicate with server side</li>
</ul>


<h2>Setup</h2>

<p>Creating a Web API project is straightforward: Just follow the instructions at</p>

<ul>
<li><a href="http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/tutorial-your-first-web-api">Getting Started with ASP.NET Web API 2</a></li>
<li><a href="http://www.asp.net/web-api/overview/security/enabling-cross-origin-requests-in-web-api">Enabling Cross-Origin Requests in ASP.NET Web API</a></li>
<li><a href="http://www.asp.net/web-api/overview/extensibility/using-the-web-api-dependency-resolver">Dependency Injection for Web API Controllers</a></li>
</ul>


<p>The final project structure will look like this:</p>

<p><img src="/images/posts/dotnet/dotnet-project-structure.PNG"></p>

<h2>Adding Models</h2>

<p>Create two new POCOs for <code>User</code> and <code>Dummy</code>:</p>

<figure class='code'><figcaption><span>Models/Dummy.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">namespace</span> <span class="nn">WebService.Models</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Models/User.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">namespace</span> <span class="nn">WebService.Models</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">User</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Adding Service Layer</h2>

<p>Create a new folder <code>Service</code> and add a <code>UserService</code> with corresponding interface <code>IUserService</code>.</p>

<figure class='code'><figcaption><span>Service/IUserService.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.Models</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService.Service</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">interface</span> <span class="n">IUserService</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">GetAllUsers</span><span class="p">();</span>
</span><span class='line'>        <span class="n">User</span> <span class="nf">GetById</span><span class="p">(</span><span class="kt">int</span> <span class="n">userId</span><span class="p">);</span>
</span><span class='line'>        <span class="n">User</span> <span class="nf">UpdateUser</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">);</span>
</span><span class='line'>        <span class="n">User</span> <span class="nf">CreateNewUser</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">);</span>
</span><span class='line'>        <span class="k">void</span> <span class="nf">RemoveUserById</span><span class="p">(</span><span class="kt">int</span> <span class="n">userId</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Service/UserService.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Collections.ObjectModel</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.Models</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService.Service</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">UserService</span> <span class="p">:</span> <span class="n">IUserService</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="nf">UserService</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">Users</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Collection</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;();</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">CreateUsers</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">Users</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">GetAllUsers</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span> <span class="nf">GetById</span><span class="p">(</span><span class="kt">int</span> <span class="n">userId</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">SingleOrDefault</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">userId</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span> <span class="nf">UpdateUser</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">u</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">SingleOrDefault</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">Id</span><span class="p">));</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">u</span><span class="p">.</span><span class="n">FirstName</span> <span class="p">=</span> <span class="n">user</span><span class="p">.</span><span class="n">FirstName</span><span class="p">;</span>
</span><span class='line'>                <span class="n">u</span><span class="p">.</span><span class="n">LastName</span> <span class="p">=</span> <span class="n">user</span><span class="p">.</span><span class="n">LastName</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">u</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span> <span class="nf">CreateNewUser</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">newUser</span> <span class="p">=</span> <span class="k">new</span> <span class="n">User</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">Id</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">Max</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span> <span class="p">+</span> <span class="m">1</span><span class="p">,</span>
</span><span class='line'>                <span class="n">FirstName</span> <span class="p">=</span> <span class="n">user</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span>
</span><span class='line'>                <span class="n">LastName</span> <span class="p">=</span> <span class="n">user</span><span class="p">.</span><span class="n">LastName</span>
</span><span class='line'>            <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">newUser</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">return</span> <span class="n">newUser</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">void</span> <span class="nf">RemoveUserById</span><span class="p">(</span><span class="kt">int</span> <span class="n">userId</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">SingleOrDefault</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">userId</span><span class="p">)));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="k">void</span> <span class="nf">CreateUsers</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">const</span> <span class="kt">int</span> <span class="n">numberOfUsers</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
</span><span class='line'>            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">id</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="n">id</span> <span class="p">&lt;=</span> <span class="n">numberOfUsers</span><span class="p">;</span> <span class="n">id</span><span class="p">++)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">User</span> <span class="p">{</span><span class="n">Id</span> <span class="p">=</span> <span class="n">id</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;Foo&quot;</span> <span class="p">+</span> <span class="n">id</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">&quot;Bar&quot;</span> <span class="p">+</span> <span class="n">id</span><span class="p">});</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note: This is just a quick and dirty setup to get a working REST API without much overhead. In a real application the service will probably be a bit more fine grained. For example: In this demo app the users are simply stored in memory and not persisted to a database.</p>

<h2>Adding IoC for Web API</h2>

<p>Add inversion of control (IoC) to Web API:</p>

<figure class='code'><figcaption><span>IoC/UnityResolver.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http.Dependencies</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Microsoft.Practices.Unity</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService.IoC</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">/// &lt;summary&gt;</span>
</span><span class='line'>    <span class="c1">/// http://www.asp.net/web-api/overview/extensibility/using-the-web-api-dependency-resolver</span>
</span><span class='line'>    <span class="c1">/// &lt;/summary&gt;</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">UnityResolver</span> <span class="p">:</span> <span class="n">IDependencyResolver</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IUnityContainer</span> <span class="n">container</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="nf">UnityResolver</span><span class="p">(</span><span class="n">IUnityContainer</span> <span class="n">container</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">container</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentNullException</span><span class="p">(</span><span class="s">&quot;container&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">container</span> <span class="p">=</span> <span class="n">container</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">Dispose</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="kt">object</span> <span class="nf">GetService</span><span class="p">(</span><span class="n">Type</span> <span class="n">serviceType</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">Resolve</span><span class="p">(</span><span class="n">serviceType</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">catch</span> <span class="p">(</span><span class="n">ResolutionFailedException</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">GetServices</span><span class="p">(</span><span class="n">Type</span> <span class="n">serviceType</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">ResolveAll</span><span class="p">(</span><span class="n">serviceType</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">catch</span> <span class="p">(</span><span class="n">ResolutionFailedException</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;();</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">IDependencyScope</span> <span class="nf">BeginScope</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">child</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">CreateChildContainer</span><span class="p">();</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">new</span> <span class="nf">UnityResolver</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Adding Controllers</h2>

<p>Create controllers <code>UsersController</code> and <code>DummyController</code>:</p>

<figure class='code'><figcaption><span>Controllers/Dummy.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http.Cors</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.Models</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService.Controllers</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na">    [EnableCors(origins: &quot;http://localhost:9000&quot;, headers: &quot;*&quot;, methods: &quot;*&quot;)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">DummyController</span> <span class="p">:</span> <span class="n">ApiController</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="n">Dummy</span> <span class="nf">Get</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">new</span> <span class="n">Dummy</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">Id</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
</span><span class='line'>                <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;JonFromREST&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">LastName</span> <span class="p">=</span> <span class="s">&quot;Doe&quot;</span>
</span><span class='line'>            <span class="p">};</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Controllers/UsersController.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http.Cors</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.Models</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.Service</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService.Controllers</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na">    [EnableCors(origins: &quot;http://localhost:9000&quot;, headers: &quot;*&quot;, methods: &quot;*&quot;)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">UsersController</span> <span class="p">:</span> <span class="n">ApiController</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IUserService</span> <span class="n">userService</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="nf">UsersController</span><span class="p">(</span><span class="n">IUserService</span> <span class="n">userService</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">userService</span> <span class="p">=</span> <span class="n">userService</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">Get</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">userService</span><span class="p">.</span><span class="n">GetAllUsers</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span> <span class="nf">Get</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">userService</span><span class="p">.</span><span class="n">GetById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span> <span class="nf">Put</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">userService</span><span class="p">.</span><span class="n">UpdateUser</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span> <span class="nf">Post</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">userService</span><span class="p">.</span><span class="n">CreateNewUser</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">void</span> <span class="nf">Delete</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">userService</span><span class="p">.</span><span class="n">RemoveUserById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Putting the pieces together</h3>

<p>Within <code>WebApiConfig.cs</code>:</p>

<ul>
<li>configure the IoC container</li>
<li>activate CORS</li>
<li>return JSON</li>
<li>configure routes</li>
</ul>


<figure class='code'><figcaption><span>App_Start/WebApiConfig.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Net.Http.Headers</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Microsoft.Practices.Unity</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.IoC</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.Service</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">WebApiConfig</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Register</span><span class="p">(</span><span class="n">HttpConfiguration</span> <span class="n">config</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="c1">// IoC container</span>
</span><span class='line'>            <span class="c1">//</span>
</span><span class='line'>            <span class="c1">// http://www.asp.net/web-api/overview/extensibility/using-the-web-api-dependency-resolver</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="k">new</span> <span class="n">UnityContainer</span><span class="p">();</span>
</span><span class='line'>            <span class="c1">// Note: for this demo we want the user service to be a singleton (&#39;ContainerControlledLifetimeManager&#39; in Unity syntax)</span>
</span><span class='line'>            <span class="n">container</span><span class="p">.</span><span class="n">RegisterType</span><span class="p">&lt;</span><span class="n">IUserService</span><span class="p">,</span> <span class="n">UserService</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">ContainerControlledLifetimeManager</span><span class="p">());</span>
</span><span class='line'>            <span class="n">config</span><span class="p">.</span><span class="n">DependencyResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="n">UnityResolver</span><span class="p">(</span><span class="n">container</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Web API configuration and services</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">config</span><span class="p">.</span><span class="n">EnableCors</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Return JSON instead of XML http://stackoverflow.com/a/13277616/1062607</span>
</span><span class='line'>            <span class="n">config</span><span class="p">.</span><span class="n">Formatters</span><span class="p">.</span><span class="n">JsonFormatter</span><span class="p">.</span><span class="n">SupportedMediaTypes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">MediaTypeHeaderValue</span><span class="p">(</span><span class="s">&quot;text/html&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Web API routes</span>
</span><span class='line'>            <span class="n">config</span><span class="p">.</span><span class="n">MapHttpAttributeRoutes</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">const</span> <span class="kt">string</span> <span class="n">baseUrl</span> <span class="p">=</span> <span class="s">&quot;ngdemo/web&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">config</span><span class="p">.</span><span class="n">Routes</span><span class="p">.</span><span class="n">MapHttpRoute</span><span class="p">(</span>
</span><span class='line'>                <span class="n">name</span><span class="p">:</span> <span class="s">&quot;DefaultApi&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">routeTemplate</span><span class="p">:</span> <span class="n">baseUrl</span> <span class="p">+</span> <span class="s">&quot;/{controller}/{id}&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">defaults</span><span class="p">:</span> <span class="k">new</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="n">RouteParameter</span><span class="p">.</span><span class="n">Optional</span> <span class="p">}</span>
</span><span class='line'>            <span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Returning Lower Case JSON from .NET Web API</h2>

<p>C# uses upper case property names by default. JavaScript uses lower case property names by default.</p>

<p>To automatically convert between both worlds you can add a <code>ContractResolver</code> to your <code>Global.asax.cs</code>:</p>

<figure class='code'><figcaption><span>Global.asax.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">WebApiApplication</span> <span class="p">:</span> <span class="n">HttpApplication</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">protected</span> <span class="k">void</span> <span class="nf">Application_Start</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">GlobalConfiguration</span><span class="p">.</span><span class="n">Configure</span><span class="p">(</span><span class="n">WebApiConfig</span><span class="p">.</span><span class="n">Register</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// lower case property names in serialized JSON: http://stackoverflow.com/a/22130487/1062607</span>
</span><span class='line'>            <span class="n">GlobalConfiguration</span><span class="p">.</span><span class="n">Configuration</span>
</span><span class='line'>                <span class="p">.</span><span class="n">Formatters</span>
</span><span class='line'>                <span class="p">.</span><span class="n">JsonFormatter</span>
</span><span class='line'>                <span class="p">.</span><span class="n">SerializerSettings</span>
</span><span class='line'>                <span class="p">.</span><span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CamelCasePropertyNamesContractResolver</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Done?</h2>

<p>Almost: For the ASP.NET backend to be reachable by the same URL as the other backends (<a href="http://draptik.github.io/blog/2013/10/01/node-dot-js-backend-providing-rest/">NodeJs backend</a> and <a href="http://draptik.github.io/blog/2013/07/13/angularjs-example-using-a-java-restful-web-service/">Java backend</a>) we have to change the default port of the application to 8080:</p>

<p><img src="/images/posts/dotnet/dotnet-project-url.PNG"></p>

<p>Now we can start the Web API backend from Visual Studio (F5).</p>

<p>In the newly openend browser, check the URL <a href="http:localhost:8080/nodedemo/web/dummy/">http:localhost:8080/nodedemo/web/dummy/</a>. The dummy JSON object should be visible:</p>

<p><img src="/images/posts/dotnet/dotnet-project-browser00.PNG"></p>

<h2>Check the API</h2>

<h3>Start the backend</h3>

<p>Start the Web API backend from Visual Studio.</p>

<h3>Start the frontend</h3>

<p>Note: For setting up the frontend, you will need to install <a href="http://nodejs.org/">NodeJS</a> and <a href="http://gruntjs.com/">Grunt</a>. Please have a look at the <a href="https://github.com/draptik/angulardemorestful/blob/master/frontend/README.md">README.md file in the frontend folder</a> for further details.</p>

<p>Open a command prompt and navigate to the <code>frontend</code> folder.</p>

<p>Run <code>grunt server</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&gt;grunt server
</span><span class='line'>Running <span class="s2">&quot;server&quot;</span> task
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;clean:server&quot;</span> <span class="o">(</span>clean<span class="o">)</span> task
</span><span class='line'>Cleaning .tmp...OK
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;concurrent:server&quot;</span> <span class="o">(</span>concurrent<span class="o">)</span> task
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;coffee:dist&quot;</span> <span class="o">(</span>coffee<span class="o">)</span> task
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;copy:styles&quot;</span> <span class="o">(</span>copy<span class="o">)</span> task
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;compass:server&quot;</span> <span class="o">(</span>compass<span class="o">)</span> task
</span><span class='line'>directory .tmp/styles/
</span><span class='line'>       create .tmp/styles/main.css <span class="o">(</span>1.718s<span class="o">)</span>
</span><span class='line'>    Compilation took 1.802s
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;autoprefixer:dist&quot;</span> <span class="o">(</span>autoprefixer<span class="o">)</span> task
</span><span class='line'>File <span class="s2">&quot;.tmp/styles/main.css&quot;</span> created.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;connect:livereload&quot;</span> <span class="o">(</span>connect<span class="o">)</span> task
</span><span class='line'>Started connect web server on localhost:9000.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;open:server&quot;</span> <span class="o">(</span>open<span class="o">)</span> task
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;watch&quot;</span> task
</span><span class='line'>Waiting...
</span></code></pre></td></tr></table></div></figure>


<p>Visit URL <a href="http://localhost:9000/#/dummy">http://localhost:9000/#/dummy</a>:</p>

<p><img src="/images/posts/dotnet/dotnet-project-browser01.PNG"></p>

<p>That&rsquo;s it.</p>

<h2>Source code for this post</h2>

<p>You can clone a copy of this project here: <a href="https://github.com/draptik/angulardemorestful">https://github.com/draptik/angulardemorestful</a>.</p>

<p>To checkout the correct version for this demo, use the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git clone git@github.com:draptik/angulardemorestful.git
</span><span class='line'><span class="nb">cd </span>angulardemorestful
</span><span class='line'>git checkout -f step7-aspnet-webapi-backend
</span></code></pre></td></tr></table></div></figure>


<p>In case you are not using git you can also download the project as ZIP or tar.gz file here: <a href="https://github.com/draptik/angulardemorestful/releases/tag/step7-aspnet-webapi-backend">https://github.com/draptik/angulardemorestful/releases/tag/step7-aspnet-webapi-backend</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/21/link-collection-number-4/">Link Collection #4</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-21T01:24:32+00:00" pubdate data-updated="true">Apr 21<span>st</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;m a bit behind on this section, I know. Here&rsquo;s the first batch:</p>

<p>currently reading:</p>

<ul>
<li><a href="http://www.amazon.com/Growing-Object-Oriented-Software-Guided-Tests/dp/0321503627/ref=la_B002O21DQW_1_1?s=books&amp;ie=UTF8&amp;qid=1398046597&amp;sr=1-1">Growing Object-Oriented Software, Guided by Tests</a></li>
<li><a href="http://www.amazon.com/Implementing-Domain-Driven-Design-Vaughn-Vernon-ebook/dp/B00BCLEBN8/ref=la_B0096T71SA_1_1?s=books&amp;ie=UTF8&amp;qid=1398046585&amp;sr=1-1">Implementing Domain-Driven Design</a></li>
</ul>


<p>c# stuff:</p>

<ul>
<li><a href="http://stackoverflow.com/questions/21389283/mark-seemanns-conflicting-statements-about-bastard-injection-need-some-clarifi/21428909?stw=2#21428909">Mark Seemann&rsquo;s on Bastard Injection</a></li>
<li><a href="http://blogs.msdn.com/b/ericlippert/archive/2009/05/18/foreach-vs-foreach.aspx">foreach vs ForEach</a></li>
</ul>


<p>sql stuff:</p>

<ul>
<li><a href="http://blog.codinghorror.com/a-visual-explanation-of-sql-joins/?utm_content=bufferaf1ce&amp;utm_medium=social&amp;utm_source=twitter.com&amp;utm_campaign=buffer">SQL Joins explained</a></li>
<li><a href="http://security.stackexchange.com/questions/25684/how-can-i-explain-sql-injection-without-technical-jargon/25710#25710">SQL explained</a></li>
</ul>


<p>meta:</p>

<ul>
<li><a href="http://highscalability.com/blog/2014/3/17/intuitively-showing-how-to-scale-a-web-application-using-a-c.html">scaling web apps (decribed as comic)</a></li>
<li><a href="http://carnotaurus.philipcarney.com/post/3010984357/classes-versus-prototypes-some-philosophical-and">Classes versus Prototypes: A &lsquo;nerd&rsquo; paper from 1997</a></li>
</ul>


<p>&lsquo;Important&rsquo; images/quotes:</p>

<ul>
<li><a href="http://pbs.twimg.com/media/BhWAOVoIgAA_Tjb.jpg">Askhole</a></li>
<li><a href="http://pbs.twimg.com/media/BhFyrJbIQAAt2Wb.png">Bugfixing</a></li>
<li><a href="http://cultureby.com/2011/05/douglas-adams-on-generational-rhythms-in-the-adoption-of-tech.html">Douglas Adams on generations and technology</a></li>
</ul>


<p>other fun stuff:</p>

<ul>
<li><a href="http://www.mymodernmet.com/profiles/blogs/3d-gifs">Incredible 3D GIFs Created with a Simple Visual Effect</a></li>
</ul>


<p>not so fun:</p>

<ul>
<li><a href="http://pando.com/2013/10/26/i-challenged-hackers-to-investigate-me-and-what-they-found-out-is-chilling/?utm_content=buffer3a5a4&amp;utm_medium=social&amp;utm_source=twitter.com&amp;utm_campaign=buffer">I challenged hackers to investigate me and what they found out is chilling</a></li>
</ul>


<p>And the best tv show I&rsquo;ve seen in ages is called <a href="http://www.imdb.com/title/tt2356777/">True Detective</a>.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/04/04/docker-and-octopress/">Docker and Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/30/learning/">Learning by Meeting People</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/10/pi-hole-simple-ad-blocker-for-your-network/">Pi Hole - Simple Ad Blocker for Your Network</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/09/bash-tricks/">Bash Tricks</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/09/testing-objects-have-same-properties/">Testing That Different Objects Have the Same Properties</a>
      </li>
    
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2009 - 2017 - Patrick Drechsler  
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'draptik';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
