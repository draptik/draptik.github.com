
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>draptik</title>
  <meta name="author" content="Patrick Drechsler">

  
  <meta name="description" content="Sometimes you want to ensure that 2 unrelated objects share a set of properties &mdash; without using an interface. Here is an example: 1
2
3
4
5
6
7 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://draptik.github.io/blog/page/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="draptik" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-65991503-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">draptik</a></h1>
  
    <h2>mostly tech stuff</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:draptik.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/talks">Talks</a></li>
  <li><a href="/about">About Me</a></li>
  <li><a href="/impressum">Impressum</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/05/09/testing-objects-have-same-properties/">Testing That Different Objects Have the Same Properties</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-05-09T17:25:17+00:00" pubdate data-updated="true">May 9<span>th</span>, 2016</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Sometimes you want to ensure that 2 unrelated objects share a set of properties &mdash; without using an interface.</p>

<p>Here is an example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">namespace</span> <span class="nn">Demo</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Customer</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>First thought for C# developers: <a href="http://automapper.org/">AutoMapper</a></p>

<p>Let&rsquo;s do that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">AutoMapper</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">Demo</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">MyMapping</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="n">IMapper</span> <span class="n">Mapper</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Init</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">cfg</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MapperConfiguration</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">x</span><span class="p">.</span><span class="n">CreateMap</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span> <span class="n">Person</span><span class="p">&gt;();</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>            <span class="n">Mapper</span> <span class="p">=</span> <span class="n">cfg</span><span class="p">.</span><span class="n">CreateMapper</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can write a unit test to see if we can convert a Customer to a Person:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">Xunit</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">Demo</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">SomeTests</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'><span class="na">        [Fact]</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">void</span> <span class="nf">Given_Customer_Should_ConvertTo_Person</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Arrange</span>
</span><span class='line'>            <span class="k">const</span> <span class="kt">string</span> <span class="n">firstname</span> <span class="p">=</span> <span class="s">&quot;foo&quot;</span><span class="p">;</span>
</span><span class='line'>            <span class="k">const</span> <span class="kt">string</span> <span class="n">lastname</span> <span class="p">=</span> <span class="s">&quot;bar&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="kt">var</span> <span class="n">customer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Customer</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">FirstName</span> <span class="p">=</span> <span class="n">firstname</span><span class="p">,</span>
</span><span class='line'>                <span class="n">LastName</span> <span class="p">=</span> <span class="n">lastname</span>
</span><span class='line'>            <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">MyMapping</span><span class="p">.</span><span class="n">Init</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Act</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">person</span> <span class="p">=</span> <span class="n">MyMapping</span><span class="p">.</span><span class="n">Mapper</span><span class="p">.</span><span class="n">Map</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span> <span class="n">Person</span><span class="p">&gt;(</span><span class="n">customer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Assert</span>
</span><span class='line'>            <span class="n">person</span><span class="p">.</span><span class="n">FirstName</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Be</span><span class="p">(</span><span class="n">firstname</span><span class="p">);</span>
</span><span class='line'>            <span class="n">person</span><span class="p">.</span><span class="n">LastName</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Be</span><span class="p">(</span><span class="n">lastname</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>  
</span></code></pre></td></tr></table></div></figure>


<p>This test passes.</p>

<p>But what happens when we want to ensure that a new Customer property (for example <code>Email</code>) is reflected in the Person object?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">namespace</span> <span class="nn">Demo</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Customer</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">Email</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="c1">// &lt;-- new property</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our unit test still passes. &#9785;</p>

<p><strong>Wouldn&rsquo;t it be nice to have our unit test fail if the classes are not in sync?</strong></p>

<p>Here is where <a href="http://www.fluentassertions.com/">FluentAssertions</a> <code>ShouldBeEquivalentTo</code> comes in handy:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">FluentAssertions</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Xunit</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="na">[Fact]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">Given_Customer_Should_ConvertTo_Person_With_CurrentProperties</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//Arrange</span>
</span><span class='line'>    <span class="k">const</span> <span class="kt">string</span> <span class="n">firstname</span> <span class="p">=</span> <span class="s">&quot;foo&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">const</span> <span class="kt">string</span> <span class="n">lastname</span> <span class="p">=</span> <span class="s">&quot;bar&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">customer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Customer</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">FirstName</span> <span class="p">=</span> <span class="n">firstname</span><span class="p">,</span>
</span><span class='line'>        <span class="n">LastName</span> <span class="p">=</span> <span class="n">lastname</span><span class="p">,</span>
</span><span class='line'>        <span class="n">Email</span> <span class="p">=</span> <span class="s">&quot;foo@bar.com&quot;</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">MyMapping</span><span class="p">.</span><span class="n">Init</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Act</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">person</span> <span class="p">=</span> <span class="n">MyMapping</span><span class="p">.</span><span class="n">Mapper</span><span class="p">.</span><span class="n">Map</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span> <span class="n">Person</span><span class="p">&gt;(</span><span class="n">customer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Assert</span>
</span><span class='line'>    <span class="n">customer</span><span class="p">.</span><span class="n">ShouldBeEquivalentTo</span><span class="p">(</span><span class="n">person</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/posts/dotnet/equivalentto_result.png"></p>

<p><code>Subject has a member  Email that the other object does not have.</code></p>

<p>Cool: This is the kind of message I want to have from a unit test!</p>

<p><code>ShouldBeEquivalentTo</code> also takes an optional Lambda expression in case you need more fine grained control which properties are included in the comparison. Here is an example where we exlude the <code>Email</code> property on purpose:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">FluentAssertions</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Xunit</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="na">[Fact]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">Given_Customer_Should_ConvertTo_Person_With_CurrentProperties_Excluding_Email</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">//Arrange</span>
</span><span class='line'>    <span class="k">const</span> <span class="kt">string</span> <span class="n">firstname</span> <span class="p">=</span> <span class="s">&quot;foo&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">const</span> <span class="kt">string</span> <span class="n">lastname</span> <span class="p">=</span> <span class="s">&quot;bar&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">customer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Customer</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">FirstName</span> <span class="p">=</span> <span class="n">firstname</span><span class="p">,</span>
</span><span class='line'>        <span class="n">LastName</span> <span class="p">=</span> <span class="n">lastname</span><span class="p">,</span>
</span><span class='line'>        <span class="n">Email</span> <span class="p">=</span> <span class="s">&quot;foo@bar.com&quot;</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">MyMapping</span><span class="p">.</span><span class="n">Init</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Act</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">person</span> <span class="p">=</span> <span class="n">MyMapping</span><span class="p">.</span><span class="n">Mapper</span><span class="p">.</span><span class="n">Map</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span> <span class="n">Person</span><span class="p">&gt;(</span><span class="n">customer</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Assert</span>
</span><span class='line'>    <span class="n">customer</span><span class="p">.</span><span class="n">ShouldBeEquivalentTo</span><span class="p">(</span><span class="n">person</span><span class="p">,</span>
</span><span class='line'>        <span class="n">options</span> <span class="p">=&gt;</span>
</span><span class='line'>            <span class="n">options</span><span class="p">.</span><span class="n">Excluding</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Email</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This test passes.</p>

<p>The complete documentation for FluentAssertions&#8217; <code>ShouldBeEquivalentTo</code> method can be found <a href="https://github.com/dennisdoomen/fluentassertions/wiki#object-graph-comparison">here</a>.</p>

<h2>Source code for this post</h2>

<p>You can clone a copy of this project here: <a href="https://github.com/draptik/blog-demo-shouldbeequivalentto">https://github.com/draptik/blog-demo-shouldbeequivalentto</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git clone https://github.com/draptik/blog-demo-shouldbeequivalentto.git
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/29/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-3-ui/">Remotly Measuring Temperatures With a Raspberry Pi Using Radio Frequency Modules From Ciseco (Part 3: UI)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-29T22:07:12+00:00" pubdate data-updated="true">Jul 29<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="/blog/2015/07/10/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-1-hardware/">Part 1</a> describes how to setup the hardware, <a href="/blog/2015/07/10/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-2-software/">part 2</a> describes how to to record/persist the sensor information.</p>

<p>In this post I&rsquo;ll describe how to display the data.</p>

<h2>TL;DR</h2>

<ul>
<li>Download and unzip the source code from <a href="https://github.com/draptik/rpi-temperature-website/archive/v1.0.zip">https://github.com/draptik/rpi-temperature-website/archive/v1.0.zip</a></li>
<li><code>npm install</code></li>
<li><code>bower install</code></li>
<li>(for deployment in LAN: Configure <code>baseUrl</code> in <code>app.js</code>)</li>
<li>(for deployment in LAN: Configure <code>dbLocation</code> in <code>app_api/models/db.js</code>)</li>
<li>(for deployment in LAN: <code>export SET_ENV=production</code>)</li>
<li><code>npm start</code></li>
</ul>


<p>Should be similar to <a href="http://rpi-temperatures-website-demo.firebaseapp.com/">http://rpi-temperatures-website-demo.firebaseapp.com/</a>.</p>

<h2>Choosing the right technology stack</h2>

<p>This really depends on your individual needs. Here are some points to consider:</p>

<ul>
<li>How many people will be accessing the site?</li>
<li>Do you have to access the site from outside of your LAN? Do you need a login mechanism?</li>
<li>Which technology stack are you comfortable with? Which technology stack is supported on the server?</li>
<li>Database interaction possible (this demo uses SQLite3)?</li>
</ul>


<p>If you know that you&rsquo;ll have many requests I would discourage you from using the Raspberry Pi (RPi) as a web server.</p>

<p>Otherwhise, the RPi is a good choice for a web server.</p>

<p>Some of the technology stacks available on the RPi are:</p>

<ul>
<li>JVM: Java, Scala</li>
<li>.NET/Mono: C#, F#</li>
<li>Python</li>
<li>JS: <a href="https://nodejs.org/">Node.js</a></li>
</ul>


<p>Since I only want to display data in my LAN I decided to use Javascript: <a href="https://nodejs.org/">Node.js</a> in combination with the <a href="http://expressjs.com/">Express framework</a> provides all possible features and is very lightweight.</p>

<p>No matter which stack you choose:
Running the web site on the same RPi as the temperature recording from the previous posts saves you the hassle of installing software on a different machine. And it obviously saves energy, since the RPi is running 24/7 anyway recording temperature data.</p>

<h2>User Interface</h2>

<p>My primary goal was <em>explorative data visualization</em>. For this purpose I decided to show 2 plots:</p>

<ul>
<li>an overview plot showing the past 14 days</li>
<li>and a detail plot, showing the selection of the overview plot</li>
</ul>


<p>You can test the website with some sample data at
<a href="http://rpi-temperatures-website-demo.firebaseapp.com/">http://rpi-temperatures-website-demo.firebaseapp.com/</a></p>

<p><img src="/images/posts/rpi_temperatures/screenshot-demo.png"></p>

<p>Some of the UI features:</p>

<ul>
<li>The detail plot can be dragged and the overview plot has a selection region which can be resized and dragged.</li>
<li>Changes to either plot are reflected in the other.</li>
<li>Mouse movement in the detail plot updates the legend.</li>
</ul>


<p>All charting features are implemented using <a href="http://www.flotcharts.org/">Flot</a>.</p>

<h2>Prerequisites: Node.js</h2>

<p>Here is a very concise manual on how to install Node.js on the RPi (this
gives you a more up to date version of Node.js than default Raspbian does):
<a href="http://weworkweplay.com/play/raspberry-pi-nodejs/">http://weworkweplay.com/play/raspberry-pi-nodejs/</a></p>

<h2>Installation</h2>

<p>All further instructions are expected to be executed on the RPi.</p>

<p>Download and unzip the source code from</p>

<p><a href="https://github.com/draptik/rpi-temperature-website/archive/v1.0.zip">https://github.com/draptik/rpi-temperature-website/archive/v1.0.zip</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd ~
</span><span class='line'>mkdir website && cd website
</span><span class='line'>wget https://github.com/draptik/rpi-temperature-website/archive/v1.0.zip
</span><span class='line'>unzip *.zip
</span><span class='line'>cd rpi*</span></code></pre></td></tr></table></div></figure>


<p>Install backend packages (node packages are defined in <code>packages.json</code>):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>npm install</span></code></pre></td></tr></table></div></figure>


<p>Node.js packages are installed to folder <code>node_modules</code>.</p>

<ul>
<li>the folder <code>app_server</code> contains the basic web site.</li>
<li>the folder <code>app_api</code> provides the REST backend.</li>
</ul>


<p>Install frontend packages (bower packages are defined in <code>bower.json</code>):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bower install</span></code></pre></td></tr></table></div></figure>


<p>Bower packages are installed to folder <code>public/vendor/bower</code>.</p>

<p>You should now be able to start the application (using the provided sample data in folder <code>sample_data</code>):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>npm start</span></code></pre></td></tr></table></div></figure>


<h2>Configuration (development vs production)</h2>

<p>The application uses a single switch between development mode and production mode:</p>

<p><code>NODE_ENV</code></p>

<p>This information is currently used in the following places in the application:</p>

<h3>REST URL</h3>

<p>Setting the URL for the REST service (in <code>app.js</code>):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var url = process.env.NODE_ENV === 'production' ? 'http://camel:3000' : 'http://localhost:3000';</span></code></pre></td></tr></table></div></figure>


<p>Within my LAN the RPi is named <code>camel</code>&hellip;</p>

<p>And in case you&rsquo;re not familiar with the syntax</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var result = someCondition ? 'string1' : 'string2';</span></code></pre></td></tr></table></div></figure>


<p>It&rsquo;s just a shorthand for</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var result;
</span><span class='line'>if (someCondition) {
</span><span class='line'>  result = 'string1';
</span><span class='line'>} else {
</span><span class='line'>  result = 'string2';
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>Database location</h3>

<p>Setting the database location (in <code>app_api/models/db.js</code>):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>var dbLocation = process.env.NODE_ENV === 'production' ? '/var/www/templog.db' : 'sample_data/templog.db';</span></code></pre></td></tr></table></div></figure>


<h3>Usage</h3>

<p>Once you&rsquo;ve configured the LAN URL and the database location, you can set the environment variable <code>NODE_ENV</code> to <code>production</code> and start the application:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export NODE_ENV=production
</span><span class='line'>npm start</span></code></pre></td></tr></table></div></figure>


<h3>Customizing</h3>

<p>You will probably want to customize the UI, as my design skills are limited at best. ;&ndash;)</p>

<p>Here&rsquo;s an overview of the project, so you know where to change things:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>├── app_api                     //  REST API
</span><span class='line'>│   ├── controllers
</span><span class='line'>│   │   └── temperatures.js
</span><span class='line'>│   ├── models
</span><span class='line'>│   │   ├── db.js               //  DATABASE
</span><span class='line'>│   └── routes
</span><span class='line'>│       └── index.js
</span><span class='line'>├── app.js                      //  MAIN ENTRY POINT FOR THE APPLICATION
</span><span class='line'>├── app_server                  //  web server (express.js)
</span><span class='line'>│   ├── controllers
</span><span class='line'>│   │   ├── main.js
</span><span class='line'>│   │   └── temperatures.js
</span><span class='line'>│   ├── models
</span><span class='line'>│   ├── routes
</span><span class='line'>│   │   ├── index.js
</span><span class='line'>│   │   ├── temperatures.js
</span><span class='line'>│   └── views
</span><span class='line'>│       ├── error.jade
</span><span class='line'>│       ├── index.jade
</span><span class='line'>│       ├── layout.jade
</span><span class='line'>│       └── temperatures-list.jade
</span><span class='line'>├── bower.json                  //  Bower configuration (frontend)
</span><span class='line'>├── node_modules                //  Location of node modules
</span><span class='line'>├── nodemon.json                //  nodemon configuration
</span><span class='line'>├── package.json                //  node configuration
</span><span class='line'>├── public                      //  frontend stuff...
</span><span class='line'>│   ├── images                  //  images
</span><span class='line'>│   ├── scripts                 //  Javascript code
</span><span class='line'>│   │   ├── chart.js            //  This file includes all charting code
</span><span class='line'>│   │   ├── rest.js             //  wrapper code to access REST API
</span><span class='line'>│   │   └── suncalc.js          //  calc sunrise/sunset on the fly
</span><span class='line'>│   ├── stylesheets             //  ...
</span><span class='line'>│   │   ├── app.css
</span><span class='line'>│   │   ├── chart.css
</span><span class='line'>│   └── vendor                  //  3rd party libraries
</span><span class='line'>│       ├── bower               //  ...installed via bower
</span><span class='line'>│       └── custom              //  ...other 3rd party libraries
</span><span class='line'>├── sample_data                 //  sample data
</span><span class='line'>│   └── templog.db              //  sqlite3 sample data set</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it. Have fun!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/09/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-2-software/">Remotly Measuring Temperatures With a Raspberry Pi Using Radio Frequency Modules From Ciseco (Part 2: Software)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-09T22:13:12+00:00" pubdate data-updated="true">Jul 9<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In the <a href="/blog/2015/07/10/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-1-hardware/">previous post</a> I described how to setup the hardware for measuring temperatures at home.
This post will use a small python program to save the recorded temperatures to a database.</p>

<p>For simplicity&rsquo;s sake we&rsquo;ll be using SQLite3 as our database.</p>

<p>Aside from our (indoor) temperature sensors, we&rsquo;ll also retrieve outdoor temperatures using the free service <a href="http://www.wunderground.com/">weather underground</a> (registration required).</p>

<p>Note: In case your Raspberry Pi does not have access to the internet you can just exlude the weather underground parts in the code below.</p>

<p>All following code is intended to run on the Raspberry Pi receiving the data.</p>

<h3>Create database (SQLite3)</h3>

<p>The database schema is simple. We need one table to store the temperatures, and another to store sensor information.</p>

<p>Create a new file called <code>templog.db</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>touch templog.db
</span></code></pre></td></tr></table></div></figure>


<p>There are different ways to interact with SQLite3 (cli (=interactive), script, api).</p>

<p>The goal is to execute the following sql statements:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">sensors</span>
</span><span class='line'><span class="p">(</span>
</span><span class='line'>    <span class="n">name</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="n">id</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="n">baudrate</span> <span class="nb">INTEGER</span><span class="p">,</span>
</span><span class='line'>    <span class="n">port</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>    <span class="n">active</span> <span class="nb">INTEGER</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">temps</span>
</span><span class='line'><span class="p">(</span>
</span><span class='line'>    <span class="k">timestamp</span> <span class="nb">TEXT</span><span class="p">,</span>
</span><span class='line'>    <span class="n">temp</span> <span class="nb">REAL</span><span class="p">,</span>
</span><span class='line'>    <span class="n">ID</span> <span class="nb">TEXT</span>
</span><span class='line'><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Simplest solution is to open the newly created file <code>templog.db</code> with <code>sqlite3</code> (cli/interactive) &hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="n">sqlite3</span> <span class="n">templog</span><span class="p">.</span><span class="n">db</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip;and past the previous code block. Should look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="err">$</span> <span class="n">sqlite3</span> <span class="n">demo</span><span class="p">.</span><span class="n">db</span>
</span><span class='line'><span class="n">SQLite</span> <span class="k">version</span> <span class="mi">3</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">2</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">20</span> <span class="mi">18</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">19</span>
</span><span class='line'><span class="n">Enter</span> <span class="ss">&quot;.help&quot;</span> <span class="k">for</span> <span class="k">usage</span> <span class="n">hints</span><span class="p">.</span>
</span><span class='line'><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">sensors</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span> <span class="p">(</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">name</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">id</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">baudrate</span> <span class="nb">INTEGER</span><span class="p">,</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">port</span> <span class="nb">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">active</span> <span class="nb">INTEGER</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span> <span class="p">);</span>
</span><span class='line'><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">temps</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span> <span class="p">(</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="k">timestamp</span> <span class="nb">TEXT</span><span class="p">,</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">temp</span> <span class="nb">REAL</span><span class="p">,</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span>     <span class="n">ID</span> <span class="nb">TEXT</span>
</span><span class='line'>   <span class="p">...</span><span class="o">&gt;</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>We&rsquo;ve created a database.</p>

<p>The important table is <code>temps</code>: It will contain the measurements.</p>

<p>The other table (<code>sensors</code>) contains informations about the sensors, which are currently only needed for the weather underground &lsquo;sensor&rsquo;. And yes: the column names/types are not optimal.</p>

<p>Note: <code>timestamp TEXT</code> will bite us in the ass, but SQLite3 does NOT have any date type.</p>

<h3>Monitor script</h3>

<p>I found this nice script somewhere on <a href="https://github.com/kal001/temperature">Github</a>. So Thank You <a href="https://github.com/kal001">kal001</a>!</p>

<p>Here&rsquo;s my <a href="https://gist.github.com/draptik/36834b68b7b4d6366f38">gist link for the script below</a>.</p>

<p>Place this script side-by-side to <code>temps.log</code>.</p>

<p>Save it as <code>monitor.py</code>.</p>

<p>You will probably want to modify the values for <code>dbname</code>, <code>TIMEOUT</code>, <code>debug.txt</code>, etc.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">sqlite3</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">threading</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">sleep</span><span class="p">,</span> <span class="n">gmtime</span><span class="p">,</span> <span class="n">strftime</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">serial</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">requests</span>
</span><span class='line'>
</span><span class='line'><span class="c"># global variales</span>
</span><span class='line'>
</span><span class='line'><span class="c"># sqlite database location</span>
</span><span class='line'><span class="n">dbname</span> <span class="o">=</span> <span class="s">&#39;templog.db&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># serial device</span>
</span><span class='line'><span class="n">DEVICE</span> <span class="o">=</span> <span class="s">&#39;/dev/ttyAMA0&#39;</span>
</span><span class='line'><span class="n">BAUD</span> <span class="o">=</span> <span class="mi">9600</span>
</span><span class='line'>
</span><span class='line'><span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="n">DEVICE</span><span class="p">,</span> <span class="n">BAUD</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># timeout in seconds for waiting to read temperature from sensors</span>
</span><span class='line'><span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">30</span>
</span><span class='line'>
</span><span class='line'><span class="c"># weather underground data</span>
</span><span class='line'><span class="n">WUKEY</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class='line'><span class="n">STATION</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</span><span class='line'><span class="c"># time between weather underground samples in seconds</span>
</span><span class='line'><span class="n">SAMPLE</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">log_temperature</span><span class="p">(</span><span class="n">temp</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Store the temperature in the database.</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
</span><span class='line'>    <span class="n">curs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;INSERT INTO temps values(datetime(&#39;now&#39;, &#39;localtime&#39;), &#39;{0}&#39;, &#39;{1}&#39; )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">temp</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]))</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span class='line'>    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">get_temp</span><span class="p">():</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Retrieves the temperature from the sensor.</span>
</span><span class='line'>
</span><span class='line'><span class="sd">    Returns -100 on error, or the temperature as a float.</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">global</span> <span class="n">ser</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">tempvalue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</span><span class='line'>    <span class="n">deviceid</span> <span class="o">=</span> <span class="s">&#39;??&#39;</span>
</span><span class='line'>    <span class="n">voltage</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">fim</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">TIMEOUT</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">fim</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tempvalue</span> <span class="o">==</span> <span class="o">-</span><span class="mi">100</span><span class="p">):</span>
</span><span class='line'>        <span class="n">n</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">()</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>            <span class="n">data</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span class='line'>            <span class="n">nb_msg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_msg</span><span class="p">):</span>
</span><span class='line'>                <span class="n">msg</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">12</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">]</span>
</span><span class='line'>                <span class="n">deviceid</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;TMPA&quot;</span><span class="p">:</span>
</span><span class='line'>                    <span class="n">tempvalue</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;BATT&quot;</span><span class="p">:</span>
</span><span class='line'>                    <span class="n">voltage</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span>
</span><span class='line'>                    <span class="k">if</span> <span class="n">voltage</span> <span class="o">==</span> <span class="s">&quot;LOW&quot;</span><span class="p">:</span>
</span><span class='line'>                        <span class="n">voltage</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;temperature&#39;</span><span class="p">:</span><span class="n">tempvalue</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">:</span><span class="n">deviceid</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">get_temp_wu</span><span class="p">():</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Retrieves temperature(s) from weather underground (wu) and stores it to the database</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>        <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dbname</span><span class="p">)</span>
</span><span class='line'>        <span class="n">curs</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class='line'>        <span class="n">query</span> <span class="o">=</span> <span class="s">&quot;SELECT baudrate, port, id, active FROM sensors WHERE id like &#39;W_&#39;&quot;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">curs</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class='line'>        <span class="n">rows</span> <span class="o">=</span> <span class="n">curs</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="c">#print(rows)</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">rows</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">[:]:</span>
</span><span class='line'>                <span class="n">WUKEY</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>                <span class="n">STATION</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>                    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>                        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://api.wunderground.com/api/{0}/conditions/q/{1}.json&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">WUKEY</span><span class="p">,</span> <span class="n">STATION</span><span class="p">)</span>
</span><span class='line'>                        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>                        <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span class='line'>                        <span class="n">log_temperature</span><span class="p">({</span><span class="s">&#39;temperature&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;current_observation&#39;</span><span class="p">][</span><span class="s">&#39;temp_c&#39;</span><span class="p">],</span> <span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]})</span>
</span><span class='line'>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>                        <span class="k">raise</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>        <span class="n">text_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;debug.txt&quot;</span><span class="p">,</span> <span class="s">&quot;a+&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{0} ERROR:</span><span class="se">\n</span><span class="s">{1}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">gmtime</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
</span><span class='line'>        <span class="n">text_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">    Program starts here.</span>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">get_temp_wu</span><span class="p">()</span>
</span><span class='line'>    <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">SAMPLE</span><span class="p">,</span> <span class="n">get_temp_wu</span><span class="p">)</span>
</span><span class='line'>    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
</span><span class='line'>        <span class="n">temperature</span> <span class="o">=</span> <span class="n">get_temp</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">temperature</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span><span class="p">:</span>
</span><span class='line'>            <span class="n">log_temperature</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
</span><span class='line'>            <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="n">SAMPLE</span><span class="p">,</span> <span class="n">get_temp_wu</span><span class="p">)</span>
</span><span class='line'>            <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the script. Open another shell, take a look inside the database (new data arriving once an hour?).</p>

<p>Don&rsquo;t forget to start the script after turning off the Raspberry Pi. Or include the script in your boot process (init, systemd).</p>

<p><a href="/blog/2015/07/30/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-3-ui/">Part 3</a> will provide a UI for the collected data.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/07/09/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-1-hardware/">Remotly Measuring Temperatures With a Raspberry Pi Using Radio Frequency Modules From Ciseco (Part 1: Hardware)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-09T22:11:00+00:00" pubdate data-updated="true">Jul 9<span>th</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since I&rsquo;m a software developer, I&rsquo;ve always been wanting to do some hardware stuff (including some soldering) with my Raspberry Pi.
So, for starters, I picked something that was useful and only involved sensors (no actors &ndash; yet):</p>

<p>Measuring temperatures at home.</p>

<p>Neither rocket science nor cool IoT &ldquo;coffe is ready when I get out of the shower in the morning&rdquo;, I know.</p>

<p>The sensor(s) should send a signal once an hour, without cable, and run on battery.</p>

<p>As the whole IoT thing is still relatively new, there are no standards yet. I picked the product line from <a href="http://shop.ciseco.co.uk/">Ciseco</a> (<a href="http://shop.ciseco.co.uk/about-us/">currently being rebranded to Wireless Things (www.wirelessthings.com)</a>). Affordable and good documentation. And, more important: These people are passionate about their product!</p>

<p>Before we get started here is a quick preview of what we want to accomplish (for details about the UI see <a href="/blog/2015/07/30/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-3-ui/">part3</a>): <a href="http://rpi-temperatures-website-demo.firebaseapp.com/">http://rpi-temperatures-website-demo.firebaseapp.com/</a></p>

<p><img src="/images/posts/rpi_temperatures/screenshot-demo.png"></p>

<p>So let&rsquo;s get started:</p>

<ul>
<li>2 battery powered sensors transmitting temperature data once per hour via radio frequency.</li>
<li>Raspberry Pi is powered 24/7 and records signals from sensors.</li>
</ul>


<h2>Parts &amp; Costs</h2>

<ul>
<li>1x &pound;3.90 Slice of Pi <a href="http://shop.ciseco.co.uk/slice-of-pi-add-on-for-raspberry-pi/">http://shop.ciseco.co.uk/slice-of-pi-add-on-for-raspberry-pi/</a></li>
<li>2x &pound;8.50 Sensor THERMISTOR <a href="http://shop.ciseco.co.uk/temperature-xrf-development-sensor-thermistor/">http://shop.ciseco.co.uk/temperature-xrf-development-sensor-thermistor/</a></li>
<li>3x &pound;11.88 XRF wireless RF radio UART serial data module <a href="http://shop.ciseco.co.uk/xrf-wireless-rf-radio-uart-serial-data-module-xbee-shaped/">http://shop.ciseco.co.uk/xrf-wireless-rf-radio-uart-serial-data-module-xbee-shaped/</a></li>
</ul>


<p>Total: &pound;56.54</p>

<p>If you only want a single sensor (1 Slice of Pi, 1 Sensor, 2 XRF modules): &pound;36.16</p>

<h2>Setup overview</h2>

<p><img src="/images/posts/rpi_temperatures/overview.png"></p>

<ul>
<li>On the left is the Raspberry Pi with an XRF module mounted to the Slice of Pi.

<ul>
<li>The Slice of Pi acts as a breakout board.</li>
<li>The XRF module will receive data.</li>
<li>The Raspberry Pi will be continously monitoring input and storing the information locally to an SQLite3 database. See <a href="(/blog/2015/07/10/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-2-software/">part 2</a> for details.</li>
</ul>
</li>
<li>On the right are two sensors with XRF modules.

<ul>
<li>These modules will send temperature data once per hour to the Raspberry Pi.</li>
<li>These modules run on battery power.</li>
<li>You can have as many of these sensors as you want.</li>
</ul>
</li>
</ul>


<p>Each XRF module requires a unique id (&lsquo;XRF ID&rsquo; in the image above).</p>

<h2>Hardware: Fitting the pieces &amp; soldering</h2>

<p>The official documentation is pretty good. If you know what you&rsquo;re doing.</p>

<ul>
<li>For the Slice of Pi: <a href="http://openmicros.org/GSG/Slice%20of%20Pi%20-%20v1-1%20getting%20started%20guide.pdf">http://openmicros.org/GSG/Slice%20of%20Pi%20-%20v1-1%20getting%20started%20guide.pdf</a></li>
<li>For the sensor module(s): <a href="http://openmicros.org/index.php/articles/88-ciseco-product-documentation/211-ccb-coin-cell-board-pictorial-build-guide">http://openmicros.org/index.php/articles/88-ciseco-product-documentation/211-ccb-coin-cell-board-pictorial-build-guide</a></li>
</ul>


<p>In case you are not really sure what you are doing with the soldering iron: Keep calm. There is a lot of information on the internet. I found the following step-by-step instruction useful:</p>

<p><a href="http://www.pihomeserver.fr/en/2013/07/11/raspberry-pi-assembler-un-emetteur-radio-pour-votre-sonde-de-temperature/">Raspberry Pi &ndash; Assemble your temperature THERMISTOR with an XRF transmitter probe</a></p>

<p>Here is what the assembled sensor looks like:
<img src="/images/posts/rpi_temperatures/assembled_sensor_notes.jpg"></p>

<p>Here is a picture of the sensor in the box. You have to create the holes in the top of the box yourself. I just used the soldering iron to melt both holes, which is probably not considered best practice ;&ndash;)</p>

<p><img src="/images/posts/rpi_temperatures/boxed_sensor_notes.jpg"></p>

<p>And here is a picture of the Raspberry Pi with an XRF module mounted on the Slice of Pi:
<img src="/images/posts/rpi_temperatures/rpi_notes.jpg"></p>

<p>Note: The sensor comes with a box. In case you want to place the sensor inside the box make sure <strong>not to solder the thermistor to close to the board</strong>. You will want to make a hole in the box and have the thermistor stick out. Otherwise the thermistor will be inside the closed box and measure the temperature inside the box (instead of outside the box). Here is a picture illustrating the issue:</p>

<p><img src="/images/posts/rpi_temperatures/sensor.png"></p>

<h2>OS</h2>

<p>This is one of the reasons I picked Ciseco for my simple project: They provide a standard Linux distribution (Raspbian) including their drivers.</p>

<p>This means the &ldquo;Slice of Pi&rdquo; works out of the box.</p>

<p>And the rest of the system behaves like a normal Raspbian system. There is no vendor &ldquo;lock-in&rdquo;.</p>

<p>Ciseco&rsquo;s patched version of Raspbian <a href="http://openmicros.org/Download/">here</a>.
Currently this is <a href="http://openmicros.org/Download/2015-05-05-raspbain-wheezy-raswik-shrunk.img.zip">http://openmicros.org/Download/2015-05-05-raspbain-wheezy-raswik-shrunk.img.zip</a>.
I used the slightly older version <a href="http://openmicros.org/Download/2014-12-24-wheezy-raspbian-ciseco-shrunk.img.zip">http://openmicros.org/Download/2014-12-24-wheezy-raspbian-ciseco-shrunk.img.zip</a>.</p>

<h2>Software (well, actually Firmware)</h2>

<p>All parts are soldered and the RPi has the correct operating system.</p>

<p>Our next steps (from a bird&rsquo;s eye perspective) are:</p>

<ul>
<li>uploading the correct firmware onto the sensors&#8217; XRF module</li>
<li>configuring the sensors&#8217; XRF module</li>
</ul>


<p>The following instructions are mostly taken from <a href="http://www.seanlandsman.com/2013/02/the-raspberry-pi-and-wireless-rf-xrf.html">Sean Landsman&rsquo;s excellent tutorial</a>.</p>

<h3>Upload firmware to sensor(s)&lsquo; XRF module</h3>

<p>Why do we have to do this?</p>

<p>The sensor board is generic and can be configured for working with different types of sensors. We&rsquo;re using a thermistor, in case you forgot&hellip; The thing with the antenna is the XRF module. We have 3 XRF modules: 1 for receiving data, 2 for sending data. We&rsquo;ll take care of the sending modules first.</p>

<p>The tool for uploading the appropriate firmware to XRF modules is called <code>xrf_uploader</code>.</p>

<p>Download the <code>xrf_uploader</code> source code from Ciseco&rsquo;s Github page at <a href="https://github.com/CisecoPlc/XRF-Uploader">https://github.com/CisecoPlc/XRF-Uploader</a> to the Raspberry Pi.</p>

<p>Then compile the file <code>xrf_uploader.cpp</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>g++ xfr_uploader.cpp -o xrf_uploader
</span><span class='line'>chmod +x xrf_uploader
</span></code></pre></td></tr></table></div></figure>


<p>Next, get a copy of the thermistor firmware from Ciseco&rsquo;s Github page at <a href="https://github.com/CisecoPlc/XRF-Firmware-downloads/tree/master/XRFV2%20ARF%20SRF%20-%20LLAP">https://github.com/CisecoPlc/XRF-Firmware-downloads/tree/master/XRFV2%20ARF%20SRF%20-%20LLAP</a>.
At the time of writing, the most current version of the termistor firmware was <a href="https://github.com/CisecoPlc/XRF-Firmware-downloads/blob/master/XRFV2%20ARF%20SRF%20-%20LLAP/llapThermistor-V0.73-24MHz.bin">llapThermistor-V0.73-24MHz.bin</a>.</p>

<ul>
<li>Shutdown the Raspberry Pi (<code>sudo init 0</code>)</li>
<li>Connect the first XRF &lsquo;sensor&rsquo; module with the Slice of Pi</li>
<li>Start the Raspberry Pi again</li>
</ul>


<p>Copy the thermistor firmware into the same folder as the <code>xrf_uploader</code> and upload the firmware to the newly connected XRF module:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>./xrf_uploader -d /dev/ttyAMA0 -f llapThermistor-V0.73-24MHz.bin
</span></code></pre></td></tr></table></div></figure>


<p>Note: <code>/dev/ttyAMA0</code> is the Raspberry Pi&rsquo;s location of the <a href="http://en.wikipedia.org/wiki/Universal_asynchronous_receiver/transmitter">UART</a>.</p>

<p>The upload should look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>pi@raspberrypi ~/xrf_loader <span class="nv">$ </span>./xrf_uploader -d /dev/ttyAMA0 -f llapThermistor-V0.73-24MHz.bin
</span><span class='line'>Writing new firmware file llapThermistor-V0.50-24MHz.bin to device /dev/ttyAMA0 with baud rate 9600...
</span><span class='line'>Reading firmware file...
</span><span class='line'>Read 1300 lines from firmware file
</span><span class='line'>Opening device...
</span><span class='line'>Setting serial parameters...
</span><span class='line'>Waiting <span class="k">for </span>device to settle...
</span><span class='line'>
</span><span class='line'>&lt;&gt; Entering <span class="nb">command </span>modus
</span><span class='line'>&lt;- OK
</span><span class='line'>-&gt; ATVR
</span><span class='line'>&lt;- 0.63B XRF
</span><span class='line'>&lt;- OK
</span><span class='line'>-&gt; ATPG
</span><span class='line'>&lt;- OK
</span><span class='line'>&lt;&gt; Sent 1300 of 1300 lines...
</span><span class='line'>
</span><span class='line'>All OK, XRF successfully reprogrammed!
</span><span class='line'>
</span><span class='line'>Waiting <span class="k">for </span>device to settle...
</span><span class='line'>
</span><span class='line'>&lt;&gt; Entering <span class="nb">command </span>modus
</span><span class='line'>&lt;- OK
</span><span class='line'>-&gt; ATVR
</span><span class='line'>&lt;- 0.50B APTHERM
</span><span class='line'>&lt;- OK
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Shutdown the Raspberry Pi</li>
<li>Detach the freshly configured XRF &lsquo;sensor&rsquo; module and replace it with the XRF module which will be receiving temperature information (this XRF module is called the &lsquo;pass-through&rsquo;).</li>
<li>Connect the the &lsquo;sensor&rsquo; XRF module used for temperature measurement with thermistor board.</li>
<li>Do not insert the battery yet!</li>
<li>Start the Raspberry Pi again.</li>
</ul>


<h3>Configure sensors (XRF modules)</h3>

<p>We now have</p>

<ul>
<li>fully equipped sensor(s) without battery power</li>
<li>Raspberry Pi with receiving sensor</li>
</ul>


<p>Again: Do not insert batteries into the sensors yet.</p>

<p>We first have to install a protocol to communicate between the &lsquo;sensor&rsquo; and the &lsquo;pass-through&rsquo; (aka &lsquo;receiving&rsquo;) XRF device.</p>

<p>Download <a href="http://sourceforge.net/projects/pyserial/files/pyserial/2.5/pyserial-2.5.tar.gz/download">pySerial</a> to the Raspberry Pi.</p>

<p>Unpack and install pySerial:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>tar xvzf pyserial-2.5.tar.gz
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>pyserial-2.5
</span><span class='line'><span class="nv">$ </span>sudo python setup.py install
</span></code></pre></td></tr></table></div></figure>


<h4>Using pySerial/miniterm</h4>

<p>pySerial comes with <code>miniterm.py</code>, a small serial terminal. Attach to the terminal:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>python ~/pyserial-2.5/examples/miniterm.py /dev/ttyAMA0
</span></code></pre></td></tr></table></div></figure>


<p>Press Ctrl+T, followed by Ctrl+E to enable the echo area. This helps during debugging.</p>

<p>Note: The terminal is not intended for <em>typing</em> commands: Always <em>paste</em> the commands from somewhere else.</p>

<p>Note: Once the battery is inserted it will drain very quickly during debugging. Ensure to unplug the battery if it&rsquo;s not needed.</p>

<h5>miniterm: First contact</h5>

<p>While miniterm is running, insert the battery. The output should look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>a--STARTED--a--STARTED--a--STARTED--a--STARTED--a--STARTED--a--STARTED--
</span></code></pre></td></tr></table></div></figure>


<p>What we are seeing is an example of LLAP (Ciseco&rsquo;s lightweight local automation protocol). A complete documentation of the protocol can be found <a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/112-llap">here</a> and <a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/297-llap-reference">here</a>.</p>

<p>From Ciseco&rsquo;s documentation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>The message structure
</span><span class='line'>
</span><span class='line'><span class="o">[</span>...<span class="o">]</span> the message is 12 characters long and in 3 distinct sections. To illustrate the 3 separate parts to the message, see this example:
</span><span class='line'>
</span><span class='line'>aXXDDDDDDDD
</span><span class='line'>1.     <span class="s2">&quot;a&quot;</span> is lower <span class="k">case </span>and shows the start of the message
</span><span class='line'>
</span><span class='line'>2.     XX is the device identifier <span class="o">(</span>address A-Z &amp; A-Z<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>3.      DDDDDDDDDD is the data being exchanged.
</span><span class='line'>
</span><span class='line'>Note: Only the first <span class="s2">&quot;a&quot;</span> character is lowercase, the remaining message always uses uppercase.
</span></code></pre></td></tr></table></div></figure>


<p>Paste <code>a--HELLO----</code> into the miniterm. In case your wondering: The default identifier is <code>--</code>. We&rsquo;ll change that later.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>python ~/pyserial-2.5/examples/miniterm.py /dev/ttyAMA0
</span><span class='line'>--- Miniterm on /dev/ttyAMA0: 9600,8,N,1 ---
</span><span class='line'>--- Quit: Ctrl+<span class="o">]</span>  |  Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
</span><span class='line'>--- <span class="nb">local echo </span>active ---
</span><span class='line'>a--HELLO----
</span></code></pre></td></tr></table></div></figure>


<p>If the remote device is running and configured correctly the output should immediatly change to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>python ~/pyserial-2.5/examples/miniterm.py /dev/ttyAMA0
</span><span class='line'>--- Miniterm on /dev/ttyAMA0: 9600,8,N,1 ---
</span><span class='line'>--- Quit: Ctrl+<span class="o">]</span>  |  Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
</span><span class='line'>--- <span class="nb">local echo </span>active ---
</span><span class='line'>a--HELLO----a--HELLO----
</span></code></pre></td></tr></table></div></figure>


<p>Note the duplicate <code>a--HELLO----</code> in the last line. The second <code>a--HELLO----</code> is the answer from the remote device.</p>

<h5>miniterm: Change device ID</h5>

<p>Since all devices have the same initial ID, it is a good idea to change the device ID in case you intend to use more than one remote device.</p>

<p>The following code changes the device ID to <code>ZZ</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>a--CHDEVIDZZ
</span><span class='line'>a--REBOOT---
</span></code></pre></td></tr></table></div></figure>


<p>The terminal output should look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>python ~/pyserial-2.5/examples/miniterm.py /dev/ttyAMA0
</span><span class='line'>--- Miniterm on /dev/ttyAMA0: 9600,8,N,1 ---
</span><span class='line'>--- Quit: Ctrl+<span class="o">]</span>  |  Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
</span><span class='line'>--- <span class="nb">local echo </span>active ---
</span><span class='line'>a--CHDEVIDZZ
</span><span class='line'>a--REBOOT---aZZSTARTED--aZZSTARTED--aZZSTARTED--aZZSTARTED--aZZSTARTED--aZZSTARTED--
</span></code></pre></td></tr></table></div></figure>


<h5>miniterm: Read temperature</h5>

<p>Assuming the device ID is <code>ZZ</code> reading the temperature is accomplished by <code>aZZTEMP-----</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>python ~/pyserial-2.5/examples/miniterm.py /dev/ttyAMA0
</span><span class='line'>--- Miniterm on /dev/ttyAMA0: 9600,8,N,1 ---
</span><span class='line'>--- Quit: Ctrl+<span class="o">]</span>  |  Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
</span><span class='line'>--- <span class="nb">local echo </span>active ---
</span><span class='line'>aZZTEMP-----aZZTMPA24.21
</span></code></pre></td></tr></table></div></figure>


<p>In the above answer from the remote device the temperature is 24.21 degrees Celsius.</p>

<h5>miniterm: Configure measurement interval</h5>

<p>Currently the remote device is contiously sending information. And draining the battery. To preserve battery power the interval can be configured to send information periodically using the command <code>a--INTVL</code>. The interval is defined with a 3 digit number followed by the time period: S(seconds), M(minutes), H(hours), D(days). For example the command <code>aZZINTVL005S</code> would set the interval of the remote device to 5 seconds.</p>

<p>Additionally the device should be sent to sleep in between cylces by issuing the command <code>aZZCYCLE----</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>python ~/pyserial-2.5/examples/miniterm.py /dev/ttyAMA0
</span><span class='line'>--- Miniterm on /dev/ttyAMA0: 9600,8,N,1 ---
</span><span class='line'>--- Quit: Ctrl+<span class="o">]</span>  |  Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---
</span><span class='line'>--- <span class="nb">local echo </span>active ---
</span><span class='line'>aZZINTVL001H
</span><span class='line'>aZZCYCLE----
</span></code></pre></td></tr></table></div></figure>


<p>The above example sets the interval to one hour (<code>001H</code>).</p>

<p>Repeat the sensor setup and configuration for each sensor which needs to send data. The &lsquo;pass-through&rsquo; (aka receiving) sensor does not have to be configured.</p>

<p><a href="/blog/2015/07/10/remotly-measuring-temperatures-with-a-raspberry-pi-using-radio-frequency-modules-from-ciseco-part-2-software/">Part 2</a> describes a simple program to monitor the data being produced by this setup.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/18/dot-net-backend-providing-rest/">.NET Backend Providing REST</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-18T16:46:33+00:00" pubdate data-updated="true">Jul 18<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>TL;DR</h2>

<p>My <a href="https://github.com/draptik/angulardemorestful">AngularJS demo app</a> has a new backend implementation using <a href="http://www.asp.net/web-api">.NET Web API</a>.</p>

<h1>&hellip;</h1>

<h2>Recap</h2>

<p>Our goals:</p>

<ul>
<li>server side: minimal working REST API providing

<ul>
<li>GET <code>dummy</code></li>
<li>CRUD <code>users</code></li>
</ul>
</li>
<li>client side (angular): communicate with server side</li>
</ul>


<h2>Setup</h2>

<p>Creating a Web API project is straightforward: Just follow the instructions at</p>

<ul>
<li><a href="http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/tutorial-your-first-web-api">Getting Started with ASP.NET Web API 2</a></li>
<li><a href="http://www.asp.net/web-api/overview/security/enabling-cross-origin-requests-in-web-api">Enabling Cross-Origin Requests in ASP.NET Web API</a></li>
<li><a href="http://www.asp.net/web-api/overview/extensibility/using-the-web-api-dependency-resolver">Dependency Injection for Web API Controllers</a></li>
</ul>


<p>The final project structure will look like this:</p>

<p><img src="/images/posts/dotnet/dotnet-project-structure.PNG"></p>

<h2>Adding Models</h2>

<p>Create two new POCOs for <code>User</code> and <code>Dummy</code>:</p>

<figure class='code'><figcaption><span>Models/Dummy.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">namespace</span> <span class="nn">WebService.Models</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Dummy</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Models/User.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">namespace</span> <span class="nn">WebService.Models</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">User</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>        <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Adding Service Layer</h2>

<p>Create a new folder <code>Service</code> and add a <code>UserService</code> with corresponding interface <code>IUserService</code>.</p>

<figure class='code'><figcaption><span>Service/IUserService.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.Models</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService.Service</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">interface</span> <span class="n">IUserService</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">GetAllUsers</span><span class="p">();</span>
</span><span class='line'>        <span class="n">User</span> <span class="nf">GetById</span><span class="p">(</span><span class="kt">int</span> <span class="n">userId</span><span class="p">);</span>
</span><span class='line'>        <span class="n">User</span> <span class="nf">UpdateUser</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">);</span>
</span><span class='line'>        <span class="n">User</span> <span class="nf">CreateNewUser</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">);</span>
</span><span class='line'>        <span class="k">void</span> <span class="nf">RemoveUserById</span><span class="p">(</span><span class="kt">int</span> <span class="n">userId</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Service/UserService.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Collections.ObjectModel</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.Models</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService.Service</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">UserService</span> <span class="p">:</span> <span class="n">IUserService</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="nf">UserService</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">Users</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Collection</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;();</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">CreateUsers</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">Users</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">GetAllUsers</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span> <span class="nf">GetById</span><span class="p">(</span><span class="kt">int</span> <span class="n">userId</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">SingleOrDefault</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">userId</span><span class="p">));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span> <span class="nf">UpdateUser</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">u</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">SingleOrDefault</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">Id</span><span class="p">));</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">u</span><span class="p">.</span><span class="n">FirstName</span> <span class="p">=</span> <span class="n">user</span><span class="p">.</span><span class="n">FirstName</span><span class="p">;</span>
</span><span class='line'>                <span class="n">u</span><span class="p">.</span><span class="n">LastName</span> <span class="p">=</span> <span class="n">user</span><span class="p">.</span><span class="n">LastName</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">u</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span> <span class="nf">CreateNewUser</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">newUser</span> <span class="p">=</span> <span class="k">new</span> <span class="n">User</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">Id</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">Max</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span> <span class="p">+</span> <span class="m">1</span><span class="p">,</span>
</span><span class='line'>                <span class="n">FirstName</span> <span class="p">=</span> <span class="n">user</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span>
</span><span class='line'>                <span class="n">LastName</span> <span class="p">=</span> <span class="n">user</span><span class="p">.</span><span class="n">LastName</span>
</span><span class='line'>            <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">newUser</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">return</span> <span class="n">newUser</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">void</span> <span class="nf">RemoveUserById</span><span class="p">(</span><span class="kt">int</span> <span class="n">userId</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">SingleOrDefault</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">.</span><span class="n">Equals</span><span class="p">(</span><span class="n">userId</span><span class="p">)));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">private</span> <span class="k">void</span> <span class="nf">CreateUsers</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">const</span> <span class="kt">int</span> <span class="n">numberOfUsers</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
</span><span class='line'>            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">id</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="n">id</span> <span class="p">&lt;=</span> <span class="n">numberOfUsers</span><span class="p">;</span> <span class="n">id</span><span class="p">++)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">this</span><span class="p">.</span><span class="n">Users</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">User</span> <span class="p">{</span><span class="n">Id</span> <span class="p">=</span> <span class="n">id</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;Foo&quot;</span> <span class="p">+</span> <span class="n">id</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">&quot;Bar&quot;</span> <span class="p">+</span> <span class="n">id</span><span class="p">});</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note: This is just a quick and dirty setup to get a working REST API without much overhead. In a real application the service will probably be a bit more fine grained. For example: In this demo app the users are simply stored in memory and not persisted to a database.</p>

<h2>Adding IoC for Web API</h2>

<p>Add inversion of control (IoC) to Web API:</p>

<figure class='code'><figcaption><span>IoC/UnityResolver.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http.Dependencies</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Microsoft.Practices.Unity</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService.IoC</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="c1">/// &lt;summary&gt;</span>
</span><span class='line'>    <span class="c1">/// http://www.asp.net/web-api/overview/extensibility/using-the-web-api-dependency-resolver</span>
</span><span class='line'>    <span class="c1">/// &lt;/summary&gt;</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">UnityResolver</span> <span class="p">:</span> <span class="n">IDependencyResolver</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IUnityContainer</span> <span class="n">container</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="nf">UnityResolver</span><span class="p">(</span><span class="n">IUnityContainer</span> <span class="n">container</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">container</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentNullException</span><span class="p">(</span><span class="s">&quot;container&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">container</span> <span class="p">=</span> <span class="n">container</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">Dispose</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="kt">object</span> <span class="nf">GetService</span><span class="p">(</span><span class="n">Type</span> <span class="n">serviceType</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">Resolve</span><span class="p">(</span><span class="n">serviceType</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">catch</span> <span class="p">(</span><span class="n">ResolutionFailedException</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">GetServices</span><span class="p">(</span><span class="n">Type</span> <span class="n">serviceType</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">ResolveAll</span><span class="p">(</span><span class="n">serviceType</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">catch</span> <span class="p">(</span><span class="n">ResolutionFailedException</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;();</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">IDependencyScope</span> <span class="nf">BeginScope</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">child</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">CreateChildContainer</span><span class="p">();</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">new</span> <span class="nf">UnityResolver</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Adding Controllers</h2>

<p>Create controllers <code>UsersController</code> and <code>DummyController</code>:</p>

<figure class='code'><figcaption><span>Controllers/Dummy.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http.Cors</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.Models</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService.Controllers</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na">    [EnableCors(origins: &quot;http://localhost:9000&quot;, headers: &quot;*&quot;, methods: &quot;*&quot;)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">DummyController</span> <span class="p">:</span> <span class="n">ApiController</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="n">Dummy</span> <span class="nf">Get</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">new</span> <span class="n">Dummy</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">Id</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
</span><span class='line'>                <span class="n">FirstName</span> <span class="p">=</span> <span class="s">&quot;JonFromREST&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">LastName</span> <span class="p">=</span> <span class="s">&quot;Doe&quot;</span>
</span><span class='line'>            <span class="p">};</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Controllers/UsersController.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http.Cors</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.Models</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.Service</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService.Controllers</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na">    [EnableCors(origins: &quot;http://localhost:9000&quot;, headers: &quot;*&quot;, methods: &quot;*&quot;)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">UsersController</span> <span class="p">:</span> <span class="n">ApiController</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">private</span> <span class="k">readonly</span> <span class="n">IUserService</span> <span class="n">userService</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="nf">UsersController</span><span class="p">(</span><span class="n">IUserService</span> <span class="n">userService</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">userService</span> <span class="p">=</span> <span class="n">userService</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">ICollection</span><span class="p">&lt;</span><span class="n">User</span><span class="p">&gt;</span> <span class="n">Get</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">userService</span><span class="p">.</span><span class="n">GetAllUsers</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span> <span class="nf">Get</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">userService</span><span class="p">.</span><span class="n">GetById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span> <span class="nf">Put</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">userService</span><span class="p">.</span><span class="n">UpdateUser</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="n">User</span> <span class="nf">Post</span><span class="p">(</span><span class="n">User</span> <span class="n">user</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">userService</span><span class="p">.</span><span class="n">CreateNewUser</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">public</span> <span class="k">void</span> <span class="nf">Delete</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">this</span><span class="p">.</span><span class="n">userService</span><span class="p">.</span><span class="n">RemoveUserById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Putting the pieces together</h3>

<p>Within <code>WebApiConfig.cs</code>:</p>

<ul>
<li>configure the IoC container</li>
<li>activate CORS</li>
<li>return JSON</li>
<li>configure routes</li>
</ul>


<figure class='code'><figcaption><span>App_Start/WebApiConfig.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Net.Http.Headers</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Microsoft.Practices.Unity</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.IoC</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">WebService.Service</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">WebApiConfig</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Register</span><span class="p">(</span><span class="n">HttpConfiguration</span> <span class="n">config</span><span class="p">)</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="c1">// IoC container</span>
</span><span class='line'>            <span class="c1">//</span>
</span><span class='line'>            <span class="c1">// http://www.asp.net/web-api/overview/extensibility/using-the-web-api-dependency-resolver</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">container</span> <span class="p">=</span> <span class="k">new</span> <span class="n">UnityContainer</span><span class="p">();</span>
</span><span class='line'>            <span class="c1">// Note: for this demo we want the user service to be a singleton (&#39;ContainerControlledLifetimeManager&#39; in Unity syntax)</span>
</span><span class='line'>            <span class="n">container</span><span class="p">.</span><span class="n">RegisterType</span><span class="p">&lt;</span><span class="n">IUserService</span><span class="p">,</span> <span class="n">UserService</span><span class="p">&gt;(</span><span class="k">new</span> <span class="n">ContainerControlledLifetimeManager</span><span class="p">());</span>
</span><span class='line'>            <span class="n">config</span><span class="p">.</span><span class="n">DependencyResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="n">UnityResolver</span><span class="p">(</span><span class="n">container</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Web API configuration and services</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">config</span><span class="p">.</span><span class="n">EnableCors</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Return JSON instead of XML http://stackoverflow.com/a/13277616/1062607</span>
</span><span class='line'>            <span class="n">config</span><span class="p">.</span><span class="n">Formatters</span><span class="p">.</span><span class="n">JsonFormatter</span><span class="p">.</span><span class="n">SupportedMediaTypes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">MediaTypeHeaderValue</span><span class="p">(</span><span class="s">&quot;text/html&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// Web API routes</span>
</span><span class='line'>            <span class="n">config</span><span class="p">.</span><span class="n">MapHttpAttributeRoutes</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">const</span> <span class="kt">string</span> <span class="n">baseUrl</span> <span class="p">=</span> <span class="s">&quot;ngdemo/web&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">config</span><span class="p">.</span><span class="n">Routes</span><span class="p">.</span><span class="n">MapHttpRoute</span><span class="p">(</span>
</span><span class='line'>                <span class="n">name</span><span class="p">:</span> <span class="s">&quot;DefaultApi&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">routeTemplate</span><span class="p">:</span> <span class="n">baseUrl</span> <span class="p">+</span> <span class="s">&quot;/{controller}/{id}&quot;</span><span class="p">,</span>
</span><span class='line'>                <span class="n">defaults</span><span class="p">:</span> <span class="k">new</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="n">RouteParameter</span><span class="p">.</span><span class="n">Optional</span> <span class="p">}</span>
</span><span class='line'>            <span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Returning Lower Case JSON from .NET Web API</h2>

<p>C# uses upper case property names by default. JavaScript uses lower case property names by default.</p>

<p>To automatically convert between both worlds you can add a <code>ContractResolver</code> to your <code>Global.asax.cs</code>:</p>

<figure class='code'><figcaption><span>Global.asax.cs</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">namespace</span> <span class="nn">WebService</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">class</span> <span class="nc">WebApiApplication</span> <span class="p">:</span> <span class="n">HttpApplication</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">protected</span> <span class="k">void</span> <span class="nf">Application_Start</span><span class="p">()</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">GlobalConfiguration</span><span class="p">.</span><span class="n">Configure</span><span class="p">(</span><span class="n">WebApiConfig</span><span class="p">.</span><span class="n">Register</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// lower case property names in serialized JSON: http://stackoverflow.com/a/22130487/1062607</span>
</span><span class='line'>            <span class="n">GlobalConfiguration</span><span class="p">.</span><span class="n">Configuration</span>
</span><span class='line'>                <span class="p">.</span><span class="n">Formatters</span>
</span><span class='line'>                <span class="p">.</span><span class="n">JsonFormatter</span>
</span><span class='line'>                <span class="p">.</span><span class="n">SerializerSettings</span>
</span><span class='line'>                <span class="p">.</span><span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CamelCasePropertyNamesContractResolver</span><span class="p">();</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Done?</h2>

<p>Almost: For the ASP.NET backend to be reachable by the same URL as the other backends (<a href="http://draptik.github.io/blog/2013/10/01/node-dot-js-backend-providing-rest/">NodeJs backend</a> and <a href="http://draptik.github.io/blog/2013/07/13/angularjs-example-using-a-java-restful-web-service/">Java backend</a>) we have to change the default port of the application to 8080:</p>

<p><img src="/images/posts/dotnet/dotnet-project-url.PNG"></p>

<p>Now we can start the Web API backend from Visual Studio (F5).</p>

<p>In the newly openend browser, check the URL <a href="http:localhost:8080/nodedemo/web/dummy/">http:localhost:8080/nodedemo/web/dummy/</a>. The dummy JSON object should be visible:</p>

<p><img src="/images/posts/dotnet/dotnet-project-browser00.PNG"></p>

<h2>Check the API</h2>

<h3>Start the backend</h3>

<p>Start the Web API backend from Visual Studio.</p>

<h3>Start the frontend</h3>

<p>Note: For setting up the frontend, you will need to install <a href="http://nodejs.org/">NodeJS</a> and <a href="http://gruntjs.com/">Grunt</a>. Please have a look at the <a href="https://github.com/draptik/angulardemorestful/blob/master/frontend/README.md">README.md file in the frontend folder</a> for further details.</p>

<p>Open a command prompt and navigate to the <code>frontend</code> folder.</p>

<p>Run <code>grunt server</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>&gt;grunt server
</span><span class='line'>Running <span class="s2">&quot;server&quot;</span> task
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;clean:server&quot;</span> <span class="o">(</span>clean<span class="o">)</span> task
</span><span class='line'>Cleaning .tmp...OK
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;concurrent:server&quot;</span> <span class="o">(</span>concurrent<span class="o">)</span> task
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;coffee:dist&quot;</span> <span class="o">(</span>coffee<span class="o">)</span> task
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;copy:styles&quot;</span> <span class="o">(</span>copy<span class="o">)</span> task
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;compass:server&quot;</span> <span class="o">(</span>compass<span class="o">)</span> task
</span><span class='line'>directory .tmp/styles/
</span><span class='line'>       create .tmp/styles/main.css <span class="o">(</span>1.718s<span class="o">)</span>
</span><span class='line'>    Compilation took 1.802s
</span><span class='line'>
</span><span class='line'>Done, without errors.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;autoprefixer:dist&quot;</span> <span class="o">(</span>autoprefixer<span class="o">)</span> task
</span><span class='line'>File <span class="s2">&quot;.tmp/styles/main.css&quot;</span> created.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;connect:livereload&quot;</span> <span class="o">(</span>connect<span class="o">)</span> task
</span><span class='line'>Started connect web server on localhost:9000.
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;open:server&quot;</span> <span class="o">(</span>open<span class="o">)</span> task
</span><span class='line'>
</span><span class='line'>Running <span class="s2">&quot;watch&quot;</span> task
</span><span class='line'>Waiting...
</span></code></pre></td></tr></table></div></figure>


<p>Visit URL <a href="http://localhost:9000/#/dummy">http://localhost:9000/#/dummy</a>:</p>

<p><img src="/images/posts/dotnet/dotnet-project-browser01.PNG"></p>

<p>That&rsquo;s it.</p>

<h2>Source code for this post</h2>

<p>You can clone a copy of this project here: <a href="https://github.com/draptik/angulardemorestful">https://github.com/draptik/angulardemorestful</a>.</p>

<p>To checkout the correct version for this demo, use the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git clone git@github.com:draptik/angulardemorestful.git
</span><span class='line'><span class="nb">cd </span>angulardemorestful
</span><span class='line'>git checkout -f step7-aspnet-webapi-backend
</span></code></pre></td></tr></table></div></figure>


<p>In case you are not using git you can also download the project as ZIP or tar.gz file here: <a href="https://github.com/draptik/angulardemorestful/releases/tag/step7-aspnet-webapi-backend">https://github.com/draptik/angulardemorestful/releases/tag/step7-aspnet-webapi-backend</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/21/link-collection-number-4/">Link Collection #4</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-21T01:24:32+00:00" pubdate data-updated="true">Apr 21<span>st</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;m a bit behind on this section, I know. Here&rsquo;s the first batch:</p>

<p>currently reading:</p>

<ul>
<li><a href="http://www.amazon.com/Growing-Object-Oriented-Software-Guided-Tests/dp/0321503627/ref=la_B002O21DQW_1_1?s=books&amp;ie=UTF8&amp;qid=1398046597&amp;sr=1-1">Growing Object-Oriented Software, Guided by Tests</a></li>
<li><a href="http://www.amazon.com/Implementing-Domain-Driven-Design-Vaughn-Vernon-ebook/dp/B00BCLEBN8/ref=la_B0096T71SA_1_1?s=books&amp;ie=UTF8&amp;qid=1398046585&amp;sr=1-1">Implementing Domain-Driven Design</a></li>
</ul>


<p>c# stuff:</p>

<ul>
<li><a href="http://stackoverflow.com/questions/21389283/mark-seemanns-conflicting-statements-about-bastard-injection-need-some-clarifi/21428909?stw=2#21428909">Mark Seemann&rsquo;s on Bastard Injection</a></li>
<li><a href="http://blogs.msdn.com/b/ericlippert/archive/2009/05/18/foreach-vs-foreach.aspx">foreach vs ForEach</a></li>
</ul>


<p>sql stuff:</p>

<ul>
<li><a href="http://blog.codinghorror.com/a-visual-explanation-of-sql-joins/?utm_content=bufferaf1ce&amp;utm_medium=social&amp;utm_source=twitter.com&amp;utm_campaign=buffer">SQL Joins explained</a></li>
<li><a href="http://security.stackexchange.com/questions/25684/how-can-i-explain-sql-injection-without-technical-jargon/25710#25710">SQL explained</a></li>
</ul>


<p>meta:</p>

<ul>
<li><a href="http://highscalability.com/blog/2014/3/17/intuitively-showing-how-to-scale-a-web-application-using-a-c.html">scaling web apps (decribed as comic)</a></li>
<li><a href="http://carnotaurus.philipcarney.com/post/3010984357/classes-versus-prototypes-some-philosophical-and">Classes versus Prototypes: A &lsquo;nerd&rsquo; paper from 1997</a></li>
</ul>


<p>&lsquo;Important&rsquo; images/quotes:</p>

<ul>
<li><a href="http://pbs.twimg.com/media/BhWAOVoIgAA_Tjb.jpg">Askhole</a></li>
<li><a href="http://pbs.twimg.com/media/BhFyrJbIQAAt2Wb.png">Bugfixing</a></li>
<li><a href="http://cultureby.com/2011/05/douglas-adams-on-generational-rhythms-in-the-adoption-of-tech.html">Douglas Adams on generations and technology</a></li>
</ul>


<p>other fun stuff:</p>

<ul>
<li><a href="http://www.mymodernmet.com/profiles/blogs/3d-gifs">Incredible 3D GIFs Created with a Simple Visual Effect</a></li>
</ul>


<p>not so fun:</p>

<ul>
<li><a href="http://pando.com/2013/10/26/i-challenged-hackers-to-investigate-me-and-what-they-found-out-is-chilling/?utm_content=buffer3a5a4&amp;utm_medium=social&amp;utm_source=twitter.com&amp;utm_campaign=buffer">I challenged hackers to investigate me and what they found out is chilling</a></li>
</ul>


<p>And the best tv show I&rsquo;ve seen in ages is called <a href="http://www.imdb.com/title/tt2356777/">True Detective</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/21/installing-seafile-on-raspberry-pi/">Installing Seafile on Raspberry Pi</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-21T00:23:00+00:00" pubdate data-updated="true">Apr 21<span>st</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>With all the security issues in the past relating to privacy I&rsquo;ve been wanting to install a private cloud service similar to <a href="http://www.dropbox.com">Dropbox</a> for some time now. So, here&rsquo;s a post on how to install Seafile on the Raspberry Pi.</p>

<p>I choose <a href="http://seafile.com/en/home/">Seafile</a> over <a href="http://owncloud.org/">Owncloud</a> because I have read multiple posts that (1) Owncloud is not very responsive an a Raspberry Pi and (2) Seafile has a better security model (see <a href="http://blog.kovah.de/private-cloud-owncloud-alternativen-teil-2">1</a>, <a href="http://stevenhickson.blogspot.de/2013/04/cloud-storage-on-raspberry-pi.html">2</a>, <a href="http://stevenhickson.blogspot.de/2013/04/cloud-storage-on-raspberry-pi.html">3</a>).</p>

<p>Using a <a href="http://www.raspberrypi.org">Raspberry Pi</a> for the server seems like a good choice, because it has very low power consumption, so you can have it running 24/7. Furthermore, the Rasperry Pi can be setup with Debian GNU/Linux (f. ex. <a href="http://www.raspbian.org">Raspbian</a>) running in server mode. As Debian is a widely used Linux distribution, most problems can be easily solved by searching the web.</p>

<p>Installing Seafile should be straightforward from following the instructions at the official <a href="https://github.com/haiwen/seafile/wiki/Download-and-setup-seafile-server">Seafile Wiki</a>. If you can read German, you can also follow the excellent instructions on Jan Karres&rsquo;s blog <a href="http://jankarres.de/2013/06/raspberry-pi-owncloud-alternative-seafile-server-installieren/">Raspberry Pi: Owncloud-Alternative Seafile Server installieren</a>.</p>

<p>As there are some pitfalls along the way, I&rsquo;ll describe how I installed Seafile with SSL support.</p>

<h2>Installation</h2>

<p>Note: This is mainly a merge of <a href="http://jankarres.de/2013/06/raspberry-pi-owncloud-alternative-seafile-server-installieren/">Jan Karres&rsquo;s blog post (in German)</a> and the <a href="https://github.com/haiwen/seafile/wiki/Download-and-setup-seafile-server">official wiki documentation from Seafile</a>.</p>

<h3>Demo values</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>domain: no-ip.org
</span><span class='line'>sub-domain: mycloud
</span><span class='line'>DDNS-domain: mycloud.no-ip.org
</span><span class='line'>internal server name: mycloud
</span><span class='line'>internal IP address of Raspberry Pi: 192.168.1.42</span></code></pre></td></tr></table></div></figure>


<h3>Prerequisites</h3>

<p>I&rsquo;ll assume you have a working Raspian installation on a Raspberry Pi.</p>

<p>If you want to reach your Seafile server from the internet and your ISP only provides you with a dynamic IP you will have to register with a <a href="http://en.wikipedia.org/wiki/Dynamic_DNS">DDNS</a> provider such as <a href="http://dyn.com/dns/">Dyn</a> or <a href="http://www.noip.com/">no-ip.com</a>.</p>

<h3>Step 0 Update</h3>

<p>Update Raspbian:</p>

<p><code>$ sudo aptitude update</code></p>

<h3>Step 1 Install dependencies</h3>

<p>Install dependencies required by Seafile:</p>

<p><code>$ sudo aptitude -y install python2.7 python-setuptools python-simplejson python-imaging sqlite3</code></p>

<h3>Step 2 Create seafile user</h3>

<p>For security reasons we&rsquo;ll create a separate user for running Seafile. The user will be called <code>seafile</code> and will not require a password, since we will never be accessing this user directly through SSH.</p>

<p><code>$ sudo adduser seafile --disabled-login</code> (CHANGE 2016-09-14 the parameter <code>--disable-password</code> was a typo: Thanks to Raphi111 for the pointer)</p>

<p>Switch to being <code>seafile</code> user:</p>

<p><code>$ sudo su seafile</code></p>

<p>Change to <code>seafile</code>&rsquo;s home directory:</p>

<p><code>$ cd</code></p>

<h3>Step 3 Download and unpack</h3>

<p>First we&rsquo;ll create a new folder <code>mycloud</code> in the seafile user&rsquo;s home directory:</p>

<p><code>$ mkdir mycloud &amp;&amp; cd mycloud</code></p>

<p>Download and unpack Seafile Server for Raspberry Pi from <a href="http://www.seafile.com/en/download/">http://www.seafile.com/en/download/</a>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>wget https://bitbucket.org/haiwen/seafile/downloads/seafile-server_2.1.5_pi.tar.gz
</span><span class='line'>tar -xvzf seafile-server_*
</span><span class='line'>mkdir installed
</span><span class='line'>mv seafile-server_* installed
</span></code></pre></td></tr></table></div></figure>


<p>You should have the following directory structure:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>tree /home/seafile/mycloud/ -L 2
</span><span class='line'>/home/seafile/mycloud/
</span><span class='line'>├── installed
</span><span class='line'>│   └── seafile-server_2.1.5_pi.tar.gz
</span><span class='line'>└── seafile-server-2.1.5
</span><span class='line'>    ├── reset-admin.sh
</span><span class='line'>    ├── runtime
</span><span class='line'>    ├── seaf-fuse.sh
</span><span class='line'>    ├── seafile
</span><span class='line'>    ├── seafile.sh
</span><span class='line'>    ├── seahub
</span><span class='line'>    ├── seahub.sh
</span><span class='line'>    ├── setup-seafile-mysql.py
</span><span class='line'>    ├── setup-seafile-mysql.sh
</span><span class='line'>    ├── setup-seafile.sh
</span><span class='line'>    └── upgrade
</span></code></pre></td></tr></table></div></figure>


<p>All config files are in the folder <code>mycloud</code> (currently there are no config files present yet).
New versions can be installed side by side without having to change the config files. The install process will create a soft link <code>seafile-server-latest</code> pointing the the most current installation.</p>

<h3>Step 4 Installation</h3>

<p><code>$ cd seafile-server-2.1.5</code></p>

<p>Before you start the install process you can have a look at the options being configured during installation <a href="https://github.com/haiwen/seafile/wiki/Download-and-setup-seafile-server#SSetup">here</a>.</p>

<p>For this example we&rsquo;ll assume your DDNS domain is <code>mycloud.no-ip.org</code> and that we&rsquo;ll use the default location for storing our data.
Furthermore, we&rsquo;ll use <code>mycloud</code> as our server name.</p>

<p>During the installation of Seahub (the web frontend for the Seafile server) you must enter an admin email address and provide a password (this password is your Seafile admin password and should not be the same as your email account password).</p>

<p>All other question can be answered by using the default values (press ENTER).</p>

<p><code>./setup-seafile.sh</code></p>

<p>Your directory tree should now look something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>tree . -L 2
</span><span class='line'>.
</span><span class='line'>├── ccnet <span class="c"># &lt;--------------------------- configuration files</span>
</span><span class='line'>│   ├── ccnet.conf
</span><span class='line'>│   ├── ccnet.conf.lan
</span><span class='line'>│   ├── ccnet.conf.wan
</span><span class='line'>│   ├── ccnet.db
</span><span class='line'>│   ├── GroupMgr
</span><span class='line'>│   ├── misc
</span><span class='line'>│   ├── mykey.peer
</span><span class='line'>│   ├── OrgMgr
</span><span class='line'>│   ├── PeerMgr
</span><span class='line'>│   └── seafile.ini
</span><span class='line'>├── conf
</span><span class='line'>│   └── seafdav.conf
</span><span class='line'>├── installed
</span><span class='line'>│   └── seafile-server_2.1.5_pi.tar.gz
</span><span class='line'>├── logs
</span><span class='line'>│   ├── ccnet.log
</span><span class='line'>│   ├── controller.log
</span><span class='line'>│   ├── http.log
</span><span class='line'>│   ├── seafile.log
</span><span class='line'>│   ├── seahub_django_request.log
</span><span class='line'>│   └── seahub.log
</span><span class='line'>├── seafile-server-2.1.5
</span><span class='line'>│   ├── reset-admin.sh
</span><span class='line'>│   ├── runtime
</span><span class='line'>│   ├── seaf-fuse.sh
</span><span class='line'>│   ├── seafile
</span><span class='line'>│   ├── seafile.sh
</span><span class='line'>│   ├── seahub
</span><span class='line'>│   ├── seahub.sh
</span><span class='line'>│   ├── setup-seafile-mysql.py
</span><span class='line'>│   ├── setup-seafile-mysql.sh
</span><span class='line'>│   ├── setup-seafile.sh
</span><span class='line'>│   └── upgrade
</span><span class='line'>├── seafile-server-latest -&gt; seafile-server-2.1.5
</span><span class='line'>├── seahub-data
</span><span class='line'>│   └── avatars
</span><span class='line'>├── seahub.db
</span><span class='line'>├── seahub_settings.py
</span><span class='line'>└── seahub_settings.pyc
</span></code></pre></td></tr></table></div></figure>


<h3>Step 5 Update URLs for Seahub</h3>

<p><code>nano /home/seafile/mycloud/ccnet/ccnet.conf</code></p>

<figure class='code'><figcaption><span>/home/seafile/mycloud/ccnet/ccnet.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">SERVICE_URL</span> <span class="o">=</span> https://mycloud.no-ip.org:8001
</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t forget replacing <code>http</code> with <code>https</code>&hellip;</p>

<p>Also add a line to <code>seahub_settings.py</code>.</p>

<p><code>nano /home/seafile/mycloud/seahub_settings.py</code></p>

<figure class='code'><figcaption><span>/home/seafile/mycloud/seahub_settings.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>SECRET_KEY ...
</span><span class='line'><span class="nv">HTTP_SERVER_ROOT</span> <span class="o">=</span> <span class="s1">&#39;https://mycloud.no-ip.org:8001/seafhttp&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Step 6 (Re)start Seahub in FastCGI mode</h3>

<p><code>/home/seafile/mycloud/seafile-server-latest/seahub.sh stop</code></p>

<p><code>/home/seafile/mycloud/seafile-server-latest/seahub.sh start-fastcgi</code></p>

<h3>Step 7 Install nginx (as admin)</h3>

<p>IMPORTANT: Do not run steps 7 to 11 as user <code>seafile</code>. Use the default <code>pi</code> user for admin stuff.</p>

<p><code>sudo aptitude install nginx</code></p>

<p>Patching nginx for Raspberry Pi:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo sed -i <span class="s2">&quot;s/worker_processes 4;/worker_processes 1;/g&quot;</span> /etc/nginx/nginx.conf
</span><span class='line'>sudo sed -i <span class="s2">&quot;s/worker_connections 768;/worker_connections 128;/g&quot;</span> /etc/nginx/nginx.conf
</span><span class='line'>sudo /etc/init.d/nginx start
</span></code></pre></td></tr></table></div></figure>


<h3>Step 8 Create a self certified SSL certificate (as admin)</h3>

<p>The following commands create a self certified SSL certificate. The second to last command is interactive and will ask a few questions. Provide <em>Country Name</em> (enter your two letter country code, i.e. DE for Germany, UK for United Kingdom) and <em>Common Name</em>. The later should be your DDNS name (<code>mycloud.no-ip.org</code> in this example).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>sudo mkdir /etc/nginx/ssl
</span><span class='line'><span class="nb">cd</span> /etc/nginx/ssl
</span><span class='line'>sudo openssl genrsa -out seahub.key 2048
</span><span class='line'>sudo openssl req -new -key seahub.key -out seahub.csr
</span><span class='line'>sudo openssl x509 -req -days 3650 -in seahub.csr -signkey seahub.key -out seahub.crt
</span></code></pre></td></tr></table></div></figure>


<h3>Step 9 Create nginx Seahub site (as admin)</h3>

<p><code>sudo nano /etc/nginx/sites-available/seahub</code></p>

<figure class='code'><figcaption><span>/etc/nginx/sites-available/seahub</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>server <span class="o">{</span>
</span><span class='line'>    listen 8001; <span class="c"># &lt;--------------------------------------- NGINX PORT</span>
</span><span class='line'>    ssl on; <span class="c"># &lt;-------------------------------------------- SSL</span>
</span><span class='line'>    ssl_certificate /etc/nginx/ssl/seahub.crt; <span class="c"># &lt;--------- SSL</span>
</span><span class='line'>    ssl_certificate_key /etc/nginx/ssl/seahub.key; <span class="c"># &lt;----- SSL</span>
</span><span class='line'>    server_name mycloud.no-ip.org.tld; <span class="c"># &lt;----------------- CHANGE THIS</span>
</span><span class='line'>    error_page 497  https://<span class="nv">$host</span>:<span class="nv">$server_port$request_uri</span>;
</span><span class='line'>
</span><span class='line'>    location / <span class="o">{</span>
</span><span class='line'>        fastcgi_pass    127.0.0.1:8000;
</span><span class='line'>        fastcgi_param   SCRIPT_FILENAME     <span class="nv">$document_root$fastcgi_script_name</span>;
</span><span class='line'>        fastcgi_param   PATH_INFO           <span class="nv">$fastcgi_script_name</span>;
</span><span class='line'>
</span><span class='line'>        fastcgi_param   SERVER_PROTOCOL <span class="nv">$server_protocol</span>;
</span><span class='line'>        fastcgi_param   QUERY_STRING        <span class="nv">$query_string</span>;
</span><span class='line'>        fastcgi_param   REQUEST_METHOD      <span class="nv">$request_method</span>;
</span><span class='line'>        fastcgi_param   CONTENT_TYPE        <span class="nv">$content_type</span>;
</span><span class='line'>        fastcgi_param   CONTENT_LENGTH      <span class="nv">$content_length</span>;
</span><span class='line'>        fastcgi_param   SERVER_ADDR         <span class="nv">$server_addr</span>;
</span><span class='line'>        fastcgi_param   SERVER_PORT         <span class="nv">$server_port</span>;
</span><span class='line'>        fastcgi_param   SERVER_NAME         <span class="nv">$server_name</span>;
</span><span class='line'>        fastcgi_param   HTTPS   on;
</span><span class='line'>        fastcgi_param HTTP_SCHEME https;
</span><span class='line'>
</span><span class='line'>        access_log      /var/log/nginx/seahub.access.log;
</span><span class='line'>        error_log       /var/log/nginx/seahub.error.log;
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    location /seafhttp <span class="o">{</span>
</span><span class='line'>        rewrite ^/seafhttp<span class="o">(</span>.*<span class="o">)</span><span class="nv">$ $1</span> <span class="nb">break</span>;
</span><span class='line'>        proxy_pass http://127.0.0.1:8082;
</span><span class='line'>        client_max_body_size 0;
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    location /media <span class="o">{</span>
</span><span class='line'>        root /home/seafile/mycloud/seafile-server-latest/seahub; <span class="c"># &lt;-- change: 2014-07-11</span>
</span><span class='line'>        <span class="c"># include /etc/nginx/mime.types; # &lt;--- UNCOMMENT THIS IF CSS FILES AREN&#39;T LOADED</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Step 10 Activate nginx Seahub site (as admin)</h3>

<p><code>sudo ln -s /etc/nginx/sites-available/seahub /etc/nginx/sites-enabled/seahub</code></p>

<h3>Step 11 Restart nginx (as admin)</h3>

<p><code>sudo /etc/init.d/nginx restart</code></p>

<h3>Step 12 Network: Setup port forwarding</h3>

<p>Depending on your router, the naming might differ. Some routers call it &ldquo;port mapping&rdquo;, some call it &ldquo;port forwarding&rdquo;. For what we are doing, it&rsquo;s all the same.</p>

<p>My ISP provided me with a combined dsl-modem/router called &ldquo;Easybox 904 xDSL&rdquo;, so YMMV:</p>

<p><img class="center" src="/images/posts/seafile_rpi/router_portmapping.png"></p>

<h3>Step 13 Test if everything works</h3>

<h4>LAN test using IP address</h4>

<p>Test if Seafile/Seahub is reachable from within your LAN using the <em>IP address</em> of your Raspberry Pi. Assuming the Raspberry Pi has the internal IP address 192.168.1.42, entering <code>https://192.168.1.42:8001</code> in your browser should render the Seahub page.</p>

<p>If this fails, go back and confirm that you don&rsquo;t have any typos in your config files.</p>

<h4>Internet test</h4>

<p>Test if Seafile/Seahub is reachable from the <em>internet</em>. You must use a device which is not connected to your LAN. If you have a smartphone, you can deactivate your WiFi, and try connecting to your newly setup server at <code>https://mycloud.no-ip.org:8001</code>. The Seahub page should be rendered correctly in your &lsquo;internet&rsquo; browser.</p>

<p>If this fails, go back and confirm that you don&rsquo;t have any typos in your config files.</p>

<h4>LAN test using DDNS</h4>

<p>Try connecting to Seafile/Seahub from within the LAN using the DDNS name: <code>https://mycloud.no-ip.org:8001</code>.</p>

<p>If this works out of the box, you can skip the rest of this article.</p>

<h3>Step 14</h3>

<p>I should probably mention that I am not a trained network admin. So everything below falls under the category &ldquo;works for my setup, sorry I can&rsquo;t provide support&rdquo;.</p>

<p>Here&rsquo;s an image of what has to be accomplished:</p>

<p><img class="center" src="/images/posts/seafile_rpi/nat-loopback.svg"></p>

<h3>Step 14a NAT loopback</h3>

<p>If trying to reach the IP of your DDNS from within your LAN fails, you should try to setup your NAT loopback (see your router documentation for details).</p>

<h3>Step 14b Workaround, in case NAT loopback doesn&rsquo;t work</h3>

<p>This is the tricky part. (Marko, thanks!)</p>

<p><em>BEWARE: This works with my setup, but it might ruin your setup.</em></p>

<ol>
<li><p>Rename internal LAN DNS zone to <code>no-ip.org</code> (replace with your domain)</p>

<p> <img class="center" src="/images/posts/seafile_rpi/router_rename_wan_domain.png" title="'Rename internal LAN DNS zone'" ></p></li>
<li><p>Rename internal LAN name (static DHCP lease) to <code>mycloud</code> (replace with your sub domain)</p>

<p> <img class="center" src="/images/posts/seafile_rpi/router_dhcp_static_leases.png" title="'Rename internal LAN name'" ></p></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/03/link-collection-number-3/">Link Collection #3</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-03T23:30:00+00:00" pubdate data-updated="true">Jan 3<span>rd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>JavaScript stuff:</p>

<ul>
<li>Basics of NodeJS and ExpressJS: <a href="http://blog.modulus.io/nodejs-and-express-create-rest-api">REST</a>, <a href="http://blog.modulus.io/nodejs-and-express-basic-authentication">Authentication</a>, <a href="http://blog.modulus.io/nodejs-and-express-sessions">Sessions</a></li>
<li>Another great tutorial on SPAs: <a href="https://vickev.com/#!/article/authentication-in-single-page-applications-node-js-passportjs-angularjs">Authentication in Single Page Applications</a></li>
<li>If you&rsquo;re in for using JavaScript for your complete stack, try MEAN: <a href="http://mean.io/">mean.io</a> (Template for MongoDB, ExpressJS, AngularJS and NodeJS)</li>
<li>and here&rsquo;s a great <a href="http://www.thinkster.io/pick/GUIDJbpIie/angularjs-tutorial-learn-to-build-modern-web-apps">Tutorial on MEAN</a></li>
</ul>


<p>c# stuff:</p>

<ul>
<li>This <a href="http://www.youtube.com/watch?v=9ZSbuwCmwuc">video by Roy Osherove</a> shows how to introduce seams into brownfield projects (start at approx. 45min into the video if you want to skip the book recommendations and the intro to the SOLID principle). I learned how to introduce seams into static c# classes and methods using virtual&hellip;</li>
<li>C# psychology <a href="http://de.slideshare.net/Coverity/the-psychology-of-c-analysis-24025354">by Eric Lippert&hellip;</a></li>
<li>NHibernate turbo? (untested, but from the man himself: <a href="http://ayende.com/blog/164353/nhibernate-runfaster-secret-toggle?Key=587fe66e-0bcb-4146-96a6-cdb6e2df7df5&amp;utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+AyendeRahien+%28Ayende+%40+Rahien%29">pimping NHibernate by Ayende</a>)</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/01/node-dot-js-backend-providing-rest/">Node.js Backend Providing REST</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-01T21:25:00+00:00" pubdate data-updated="true">Oct 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>TL;DR</h1>

<p>My <a href="https://github.com/draptik/angulardemorestful">AngularJS demo app</a> has a new backend implementation using <a href="http://nodejs.org/">node.js</a>.</p>

<h1>&hellip;</h1>

<p>After some reading I decided I&rsquo;ll stick with node&rsquo;s <code>express</code> module.</p>

<p>OK. Here is a &lsquo;minimal&rsquo; setup for a node.js server:</p>

<figure class='code'><figcaption><span>app.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//CORS middleware</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">allowCrossDomain</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Methods&#39;</span><span class="p">,</span> <span class="s1">&#39;GET,PUT,POST,DELETE&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Headers&#39;</span><span class="p">,</span> <span class="s1">&#39;Content-Type, X-XSRF-TOKEN&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">next</span><span class="p">();</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">allowCrossDomain</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* we&#39;ll use the same port as tomcat... */</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">MY_PORT</span> <span class="o">=</span> <span class="mi">8080</span><span class="p">;</span> <span class="c1">// default: 4730</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cm">/* REST API =========================================== */</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="s1">&#39;/ngdemo/web&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* GET ALL -------------------------------------------- */</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">baseUrl</span> <span class="o">+</span> <span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">userRepository</span><span class="p">.</span><span class="nx">getAll</span><span class="p">());</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* GET Dummy ------------------------------------------ */</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">baseUrl</span> <span class="o">+</span> <span class="s1">&#39;/dummy&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">firstName</span><span class="o">:</span> <span class="s1">&#39;JonFromREST&#39;</span><span class="p">,</span> <span class="nx">lastName</span><span class="o">:</span> <span class="s1">&#39;DoeFromREST&#39;</span><span class="p">});</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* GET By Id ------------------------------------------ */</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">baseUrl</span> <span class="o">+</span> <span class="s1">&#39;/users/:id&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;trying to retrieve user with id: &#39;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">userRepository</span><span class="p">.</span><span class="nx">getById</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cm">/* POST Create ---------------------------------------- */</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">baseUrl</span> <span class="o">+</span> <span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;firstName&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;lastName&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Error 400: POST syntax incorrect.&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">newUser</span> <span class="o">=</span> <span class="nx">userRepository</span><span class="p">.</span><span class="nx">addNewUser</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastName</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">newUser</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* PUT (Update) --------------------------------------- */</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">baseUrl</span> <span class="o">+</span> <span class="s1">&#39;/users/:id&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;firstName&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;lastName&#39;</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;Error 400: PUT syntax incorrect.&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">changedUser</span> <span class="o">=</span> <span class="nx">userRepository</span><span class="p">.</span><span class="nx">changeUser</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastName</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">changedUser</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* DELETE --------------------------------------------- */</span>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">baseUrl</span> <span class="o">+</span> <span class="s1">&#39;/users/:id&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;trying to delete user with id: &#39;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">userRepository</span><span class="p">.</span><span class="nx">deleteUser</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* ==================================================== */</span>
</span><span class='line'>
</span><span class='line'><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="nx">MY_PORT</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* Mmmhh... how can I place the code below into a seperate file and load it here? */</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">User</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">=</span> <span class="nx">firstName</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">=</span> <span class="nx">lastName</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">UserRepository</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">users</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">createUsers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">numberOfUsers</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">numberOfUsers</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;Foo&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">,</span> <span class="s1">&#39;Bar&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">));</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">getMaxUserId</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nb">Math</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}));</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">getNumberOfUsers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">getAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">getById</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">foundUser</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;...checking user.id &#39;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">foundUser</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">user</span><span class="p">;</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">foundUser</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Could not find user with id: &#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="s1">&#39;user with id &#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; not found.&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">addNewUser</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">newUser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getMaxUserId</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">);</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">newUser</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getById</span><span class="p">(</span><span class="nx">newUser</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">changeUser</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">firstName</span><span class="p">,</span> <span class="nx">lastName</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">user</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">=</span> <span class="nx">firstName</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">user</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">=</span> <span class="nx">lastName</span><span class="p">;</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">user</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">deleteUser</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// sorry, i&#39;m tired and don&#39;t know javascript that well...</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">indexToDelete</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">indexToDelete</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
</span><span class='line'>        <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="p">};</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">indexToDelete</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">indexToDelete</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see I am just dabbling with JS&hellip;</p>

<p>But hey: It works! ;&ndash;)</p>

<h2>Source code for this post</h2>

<p>You can clone a copy of this project here: <a href="https://github.com/draptik/angulardemorestful">https://github.com/draptik/angulardemorestful</a>.</p>

<p>To checkout the correct version for this demo, use the following code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>git clone git@github.com:draptik/angulardemorestful.git
</span><span class='line'><span class="nb">cd </span>angulardemorestful
</span><span class='line'>git checkout -f step6-nodejs-backend
</span></code></pre></td></tr></table></div></figure>


<p>In case you are not using git you can also download the project as ZIP or tar.gz file here: <a href="https://github.com/draptik/angulardemorestful/releases/tag/step6-nodejs-backend">https://github.com/draptik/angulardemorestful/releases/tag/step6-nodejs-backend</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/09/16/link-collection-2/">Link Collection #2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-16T21:58:00+00:00" pubdate data-updated="true">Sep 16<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I attended the <a href="http://www.herbstcampus.de/">Herbstcampus 2013</a> this month. As usual, a very good conference.</p>

<p>Here is some fun stuff I learned:</p>

<ul>
<li><a href="http://nancyfx.org/">NancyFx</a> is to <a href="http://www.asp.net/">ASP.NET</a> as <a href="http://www.sinatrarb.com/">Sinatra</a> is to <a href="http://rubyonrails.org/">Ruby-on-Rails</a>.</li>
<li><a href="https://github.com/markrendle/Simple.Data">Simple.Data</a> is a leightweight, convention-based database access abstraction for prototyping</li>
<li><a href="http://signalr.net/">SignalR</a> is cool</li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/11/29/fsharp-linux-mixed-feelings/">Fsharp-linux-mixed-feelings</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/08/21/intellij-gnome-keyboard-shortcut-conflict-ctrl-alt-s/">IntelliJ and Gnome Keyboard Shortcut Conflict: Ctrl Alt S</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/03/15/that-moment/">Rewarding Moments During Lunch & Learn&#8230;</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/20/visual-studios-default-path-for-new-projects/">Visual Studio&#8217;s Default Path for New Projects</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/07/fsharp-test-setup-for-fizzbuzz/">F# Test Setup for FizzBuzz</a>
      </li>
    
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2009 - 2018 - Patrick Drechsler  
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'draptik';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
