<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: java | draptik]]></title>
  <link href="http://draptik.github.io/blog/categories/java/atom.xml" rel="self"/>
  <link href="http://draptik.github.io/"/>
  <updated>2013-07-18T23:13:37+02:00</updated>
  <id>http://draptik.github.io/</id>
  <author>
    <name><![CDATA[Patrick Drechsler]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Guice in Java Web Application]]></title>
    <link href="http://draptik.github.io/blog/2013/07/18/guice-in-java-web-application/"/>
    <updated>2013-07-18T21:36:00+02:00</updated>
    <id>http://draptik.github.io/blog/2013/07/18/guice-in-java-web-application</id>
    <content type="html"><![CDATA[<p><a href="http://en.wikipedia.org/wiki/Google_Guice">Google&rsquo;s Guice framework</a> promises to be a lightweight(!) <a href="http://en.wikipedia.org/wiki/Inversion_of_control">Inversion-of-Control</a> (IoC) container.</p>

<p>Advantages compared to <a href="http://en.wikipedia.org/wiki/Spring_Framework">Spring</a>:</p>

<ul>
<li>Spring is much more than an IoC container, and therefore overkill for many projects.</li>
<li>Configuration by code. <em>NO XML</em>.</li>
</ul>


<p>Based on my <a href="http://draptik.github.io/blog/2013/07/13/angularjs-example-using-a-java-restful-web-service/">previous post showing how to use AngularJS with a Java RESTful backend</a> I extended the simple demo application to use Guice.</p>

<p>Let&rsquo;s say we have a <code>UserServiceImpl</code> class which depends on a <code>UserFactory</code> interface. The <code>UserFactory</code> interface is injected into the constructor of the <code>UserServiceImpl</code> class.</p>

<p>The only thing we have to do is add the <code>@Inject</code> annotation to the constructor so that Guice can do its job.</p>

<p>``` java UserServiceImpl.java
package ngdemo.service.impl;</p>

<p>import com.google.inject.Inject;
import com.google.inject.Singleton;
import ngdemo.domain.User;
import ngdemo.service.contract.UserFactory;
import ngdemo.service.contract.UserService;</p>

<p>import java.util.List;</p>

<p>public class UserServiceImpl implements UserService {</p>

<pre><code>private final UserFactory userFactory;

@Inject
public UserServiceImpl(UserFactory userFactory) {
    this.userFactory = userFactory;
}

@Override
public List&lt;User&gt; getDefaultUsers() {
    return this.userFactory.createUsers();
}

@Override
public User getDefaultUser() {
    return this.userFactory.createUser();
}
</code></pre>

<p>}
<code>``
For the IoC container to know which implementation to inject we have to create a Guice *Module* which derives from</code>AbstractModule`:</p>

<p>``` java UserModule.java
package ngdemo.infrastructure;</p>

<p>import com.google.inject.AbstractModule;
import ngdemo.service.contract.UserFactory;
import ngdemo.service.contract.UserService;
import ngdemo.service.impl.UserFactoryImpl;
import ngdemo.service.impl.UserServiceImpl;</p>

<p>public class UserModule extends AbstractModule {</p>

<pre><code>@Override
protected void configure() {
    bind(UserFactory.class).to(UserFactoryImpl.class);
    bind(UserService.class).to(UserServiceImpl.class);
}
</code></pre>

<p>}
```</p>

<p>The <code>UserModule</code> class demonstrates the advantage of Guice vs. Spring: <em>NO XML</em>. When using Spring you normally would have to create Spring beans in an XML file like this:</p>

<p>``` xml applicationContext.xml (pseudo code)
&lt;?xml version=&ldquo;1.0&rdquo; encoding=&ldquo;UTF-8&rdquo;?>
&lt;beans xmlns=&ldquo;<a href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>&rdquo;</p>

<pre><code>xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"&gt;

&lt;bean id="userService" class="ngdemo.service.impl.UserServiceImpl"&gt;
    &lt;constructor-arg ref="userFactory"/&gt;
&lt;/bean&gt;

&lt;bean id="userFactory" class="ngdemo.service.impl.UserFactoryImpl" /&gt;
</code></pre>

<p></beans>
```</p>

<p>Next we have to create a replacement for the servlets required by the servlet container:</p>

<p>``` java ngdemo.infrastructure.NgDemoApplicationSetup.java
package ngdemo.infrastructure;</p>

<p>import com.google.inject.Guice;
import com.google.inject.Injector;
import com.google.inject.servlet.GuiceServletContextListener;
import com.google.inject.servlet.ServletModule;
import com.sun.jersey.api.core.PackagesResourceConfig;
import com.sun.jersey.api.core.ResourceConfig;
import com.sun.jersey.guice.spi.container.servlet.GuiceContainer;</p>

<p>public class NgDemoApplicationSetup extends GuiceServletContextListener {</p>

<pre><code>@Override
protected Injector getInjector() {

    return Guice.createInjector(new ServletModule() {

        @Override
        protected void configureServlets() {

            super.configureServlets();

            // Configuring Jersey via Guice:
            ResourceConfig resourceConfig = new PackagesResourceConfig("ngdemo/rest");
            for (Class&lt;?&gt; resource : resourceConfig.getClasses()) {
                bind(resource);
            }
            serve("/rest/*").with(GuiceContainer.class);
        }
    }, new UserModule()); // &lt;-- Adding other Guice Dependency Injection Modules
}
</code></pre>

<p>}
```</p>

<p>And finally the file <code>web.xml</code>:</p>

<p>``` xml web.xml
&lt;!DOCTYPE web-app PUBLIC</p>

<pre><code>    "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
    "http://java.sun.com/dtd/web-app_2_3.dtd" &gt;
</code></pre>

<p>&lt;web-app id=&ldquo;WebApp_ID&rdquo; version=&ldquo;2.4&rdquo;</p>

<pre><code>     xmlns="http://java.sun.com/xml/ns/j2ee"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee
http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"&gt;

&lt;display-name&gt;Restful Web Application&lt;/display-name&gt;

&lt;filter&gt;
    &lt;filter-name&gt;guiceFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;com.google.inject.servlet.GuiceFilter&lt;/filter-class&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;guiceFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;listener&gt;
    &lt;listener-class&gt;ngdemo.infrastructure.NgDemoApplicationSetup&lt;/listener-class&gt;
&lt;/listener&gt;
</code></pre>

<p>&lt;/web-app>
<code>``
The file</code>web.xml<code>is now free of any</code><servlet><code>tags. The only thing that has to be configured in XML is the</code>&lt;listener-class><code>. The value of the</code>&lt;listener-class><code>is our Java class</code>NgDemoApplicationSetup`, so all further configuration can be defined in a type safe manner.</p>

<p>You can clone a copy of this project here: <a href="https://github.com/draptik/angulardemorestful">https://github.com/draptik/angulardemorestful</a>.</p>

<p>To checkout the correct version for this demo, use the following code:</p>

<p><code>sh
git clone git@github.com:draptik/angulardemorestful.git
cd angulardemorestful
git checkout -f step2-guice
</code></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AngularJS example using a Java RESTful web service]]></title>
    <link href="http://draptik.github.io/blog/2013/07/13/angularjs-example-using-a-java-restful-web-service/"/>
    <updated>2013-07-13T20:12:00+02:00</updated>
    <id>http://draptik.github.io/blog/2013/07/13/angularjs-example-using-a-java-restful-web-service</id>
    <content type="html"><![CDATA[<p><a href="http://angularjs.org/">AngularJS</a> is the current MVV-Whatever JavaScript framework by Google.
Among other things, it provides bidirectional data binding.</p>

<p>Although I&rsquo;m neither a Java nor a JavaScript expert, I choose the following scenario for my &lsquo;Hello-World&rsquo; example:</p>

<ol>
<li><p>Java backend provides a RESTful web service.</p></li>
<li><p>AngularJS consumes the web service.</p></li>
</ol>


<p>That&rsquo;s it.</p>

<h1>Project structure</h1>

<p>I intentionally put the backend and frontend code in the same project to simplify the example. In a real project you probably want to have seperate projects for front- and backend.</p>

<p><code>sh
+---------------------------------------------------+
| demo project                                      |
|                                                   |
| +----------------+              +---------------+ |
| | backend (Java) | &lt; -(REST)- &gt; | frontend (JS) | |
| +----------------+              +---------------+ |
|                                                   |
+---------------------------------------------------+
</code></p>

<p>Since the backend is Java based, I used a Maven default structure (<code>maven-archetype-site-simple</code>):</p>

<p>``` sh project structure
├── _documentation
│   └── readme.txt
├── ngdemo.iml
├── pom.xml
└── src</p>

<pre><code>└── main
    ├── java
    │   └── ngdemo
    │       ├── domain
    │       │   └── User.java
    │       ├── rest
    │       │   └── UserRestService.java
    │       └── service
    │           └── UserService.java
    └── webapp
        ├── css
        │   └── app.css
        ├── img
        ├── index-async.html
        ├── index.html
        ├── index.jsp
        ├── js
        │   ├── app.js
        │   ├── controllers.js
        │   ├── directives.js
        │   ├── filters.js
        │   └── services.js
        ├── lib
        │   └── angular
        │       ├── angular-cookies.js
        │       ├── angular-cookies.min.js
        │       ├── angular.js
        │       ├── angular-loader.js
        │       ├── angular-loader.min.js
        │       ├── angular.min.js
        │       ├── angular-resource.js
        │       ├── angular-resource.min.js
        │       ├── angular-sanitize.js
        │       ├── angular-sanitize.min.js
        │       └── version.txt
        ├── partials
        │   └── partial1.html
        └── WEB-INF
            └── web.xml
</code></pre>

<p>```</p>

<p><code>src/main/java</code> is the backend.</p>

<p><code>src/main/webapp/js</code> is the frontend.</p>

<p><code>src/main/webapp/</code> also includes a copy of angular-seed.</p>

<h1>RESTful web service (backend)</h1>

<p><a href="https://jersey.java.net/">Jersey</a> is the Java reference implementation for providing REST.</p>

<p>Install the following dependencies in your <code>pom.xml</code>:</p>

<p>``` xml pom.xml</p>

<!-- .. -->


<!-- RESTful web service: Jersey -->


<p><dependency></p>

<pre><code>&lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
&lt;artifactId&gt;jersey-server&lt;/artifactId&gt;
&lt;version&gt;1.17.1&lt;/version&gt;
</code></pre>

<p></dependency>
<dependency></p>

<pre><code>&lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
&lt;artifactId&gt;jersey-servlet&lt;/artifactId&gt;
&lt;version&gt;1.17.1&lt;/version&gt;
</code></pre>

<p></dependency>
<dependency></p>

<pre><code>&lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
&lt;artifactId&gt;jersey-json&lt;/artifactId&gt;
&lt;version&gt;1.17.1&lt;/version&gt;
</code></pre>

<p></dependency></p>

<!-- .. -->


<p>```</p>

<p>Add the following servlet snippet to your <code>web.xml</code>:</p>

<p>``` html web.xml</p>

<!-- .. -->


<p><servlet></p>

<pre><code>&lt;servlet-name&gt;jersey-serlvet&lt;/servlet-name&gt;

&lt;servlet-class&gt;
    com.sun.jersey.spi.container.servlet.ServletContainer
&lt;/servlet-class&gt;

&lt;init-param&gt;
    &lt;param-name&gt;com.sun.jersey.config.property.packages&lt;/param-name&gt;
    &lt;param-value&gt;ngdemo.rest&lt;/param-value&gt;
&lt;/init-param&gt;

&lt;init-param&gt;
    &lt;param-name&gt;com.sun.jersey.api.json.POJOMappingFeature&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/init-param&gt;

&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
</code></pre>

<p></servlet></p>

<p>&lt;servlet-mapping></p>

<pre><code>&lt;servlet-name&gt;jersey-serlvet&lt;/servlet-name&gt;
&lt;url-pattern&gt;/rest/*&lt;/url-pattern&gt;
</code></pre>

<p>&lt;/servlet-mapping></p>

<!-- .. -->


<p>```</p>

<p>Enough configuration for now: Create a simple <code>User</code> object&hellip;</p>

<p>``` java User.java
package ngdemo.domain;</p>

<p>import javax.xml.bind.annotation.XmlRootElement;</p>

<p>@XmlRootElement
public class User {</p>

<pre><code>private String firstName;
private String lastName;

public String getFirstName() {
    return firstName;
}

public void setFirstName(String firstName) {
    this.firstName = firstName;
}

public String getLastName() {
    return lastName;
}

public void setLastName(String lastName) {
    this.lastName = lastName;
}
</code></pre>

<p>}
```</p>

<p>&hellip;and a service class&hellip;</p>

<p>``` java UserService.java
package ngdemo.service;</p>

<p>import ngdemo.domain.User;</p>

<p>public class UserService {</p>

<pre><code>public User getDefaultUser() {
    User user = new User();
    user.setFirstName("JonFromREST");
    user.setLastName("DoeFromREST");
    return user;
}
</code></pre>

<p>}
```</p>

<p>&hellip;and finally the RESTful Service&hellip;:</p>

<p>``` java UserRestService.java
package ngdemo.rest;</p>

<p>import ngdemo.domain.User;
import ngdemo.service.UserService;
import ngdemo.service.UserServiceImpl;</p>

<p>import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;</p>

<p>@Path(&ldquo;/users&rdquo;)
public class UserRestService {</p>

<pre><code>@GET
@Produces(MediaType.APPLICATION_JSON)
public User getDefaultUserInJSON() {
    UserService userService = new UserServiceImpl();
    return userService.getDefaultUser();
}
</code></pre>

<p>}
```</p>

<p>Converting the <code>User</code> object to JSON via <code>@Produces(MediaType.APPLICATION_JSON)</code> requires jersey-json in <code>web.xml</code> (<code>POJOMappingFeature</code>).</p>

<h1>Consuming web service from AngularJS (frontend)</h1>

<p>Don&rsquo;t forget to add <code>angular-resources.js</code> to your <code>index.html</code>&hellip;</p>

<p>Consuming the web service:</p>

<p>``` javascript services.js
var services = angular.module(&lsquo;ngdemo.services&rsquo;, [&lsquo;ngResource&rsquo;]);</p>

<p>services.factory(&lsquo;UserFactory&rsquo;, function ($resource) {</p>

<pre><code>return $resource('/ngdemo/rest/users', {}, {
    query: {
        method: 'GET',
        params: {},
        isArray: false
    }
})
</code></pre>

<p>});
```</p>

<p>Usage in controller:</p>

<p>``` javascript controller.js
var app = angular.module(&lsquo;ngdemo.controllers&rsquo;, []);</p>

<p>app.controller(&lsquo;MyCtrl1&rsquo;, [&lsquo;$scope&rsquo;, &lsquo;UserFactory&rsquo;, function ($scope, UserFactory) {</p>

<pre><code>UserFactory.get({}, function (userFactory) {
    $scope.firstname = userFactory.firstName;
})
</code></pre>

<p>}]);
```</p>

<p>Usage in view:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;div>
</span><span class='line'>    &lt;p>
</span><span class='line'>        Result from RESTful service is: {{ firstname }}
</span><span class='line'>    &lt;/p>
</span><span class='line'>&lt;/div>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Et voila:</p>

<p><img src="/images/posts/angular/browser_screenshot.png"></p>

<p>Update (2013-07-18):</p>

<p>You can clone a copy of this project here: <a href="https://github.com/draptik/angulardemorestful">https://github.com/draptik/angulardemorestful</a>.</p>

<p>To checkout the correct version for this demo, use the following code:</p>

<p><code>sh
git clone git@github.com:draptik/angulardemorestful.git
cd angulardemorestful
git checkout -f step1
</code></p>
]]></content>
  </entry>
  
</feed>
